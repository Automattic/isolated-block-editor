{"version":3,"file":"index.js","names":["BlockEditorToolbar","props","ref","useRef","settings","editorMode","renderMoreMenu","isHugeViewport","useViewportMatch","iso","toolbar","inspector","moreMenu","inspectorInSidebar","sidebar","useDispatch","openGeneralSidebar","closeGeneralSidebar","setIsInserterOpened","useSelect","select","isEditing","isEditorSidebarOpened","isBlockSelected","getBlockSelectionStart","hasBlockSelected","isInserterOpened","toggleSidebar","isOpen","useEffect","cog","__"],"sources":["../../../src/components/block-editor-toolbar/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect, useRef } from '@wordpress/element';\nimport { Button } from '@wordpress/components';\nimport { cog } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useViewportMatch } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport MoreMenu from './more-menu';\nimport HeaderToolbar from './header-toolbar';\nimport Inspector from './inspector';\nimport ToolbarSlot from './slot';\nimport './style.scss';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Block editor toolbar\n *\n * @param {Object} props - Component props\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n */\nconst BlockEditorToolbar = ( props ) => {\n\tconst ref = useRef( null );\n\tconst { settings, editorMode, renderMoreMenu } = props;\n\tconst isHugeViewport = useViewportMatch( 'huge', '>=' );\n\tconst { inspector } = settings.iso?.toolbar || {};\n\tconst { moreMenu } = settings.iso || {};\n\tconst inspectorInSidebar = settings?.iso?.sidebar?.inspector || false;\n\tconst { openGeneralSidebar, closeGeneralSidebar } = useDispatch( 'isolated/editor' );\n\tconst { setIsInserterOpened } = useDispatch( 'isolated/editor' );\n\tconst { isEditorSidebarOpened, isBlockSelected, hasBlockSelected, isInserterOpened, isEditing } = useSelect(\n\t\t( select ) => ( {\n\t\t\tisEditing: select( 'isolated/editor' ),\n\t\t\t// @ts-ignore\n\t\t\tisEditorSidebarOpened: select( 'isolated/editor' ).isEditorSidebarOpened(),\n\t\t\t// @ts-ignore\n\t\t\tisBlockSelected: !! select( 'core/block-editor' ).getBlockSelectionStart(),\n\t\t\t// @ts-ignore\n\t\t\thasBlockSelected: !! select( 'core/block-editor' ).getBlockSelectionStart(),\n\t\t\t// @ts-ignore\n\t\t\tisInserterOpened: select( 'isolated/editor' ).isInserterOpened(),\n\t\t} ),\n\t\t[]\n\t);\n\n\tfunction toggleSidebar( isOpen ) {\n\t\tif ( ! isOpen ) {\n\t\t\tcloseGeneralSidebar();\n\t\t} else {\n\t\t\topenGeneralSidebar( hasBlockSelected ? 'edit-post/block' : 'edit-post/document' );\n\t\t}\n\t}\n\n\t// If in popover mode then ensure the sidebar is closed when the editor is first started. This is because the complimentary area status\n\t// is saved to localStorage, and it might have been left open when in sidebar mode.\n\tuseEffect( () => {\n\t\tif ( ! inspectorInSidebar ) {\n\t\t\tcloseGeneralSidebar();\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Close the block inspector when no block is selected. Gutenberg gets a bit crashy otherwise\n\t\tif ( ! inspectorInSidebar && ! isEditing && ! isBlockSelected && isEditorSidebarOpened ) {\n\t\t\tcloseGeneralSidebar();\n\t\t}\n\t}, [ isEditing ] );\n\n\t// Inserter and Sidebars are mutually exclusive\n\tuseEffect( () => {\n\t\tif ( isEditorSidebarOpened && ! isHugeViewport ) {\n\t\t\tsetIsInserterOpened( false );\n\t\t}\n\t}, [ isEditorSidebarOpened, isHugeViewport ] );\n\tuseEffect( () => {\n\t\tif ( isInserterOpened && ( ! isHugeViewport || ! inspectorInSidebar ) ) {\n\t\t\tcloseGeneralSidebar();\n\t\t}\n\t}, [ isInserterOpened, isHugeViewport ] );\n\n\treturn (\n\t\t<div className=\"edit-post-editor-regions__header\" role=\"region\" tabIndex={ -1 }>\n\t\t\t<div className=\"edit-post-header\">\n\t\t\t\t<div className=\"edit-post-header__toolbar\">\n\t\t\t\t\t<HeaderToolbar settings={ settings } />\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"edit-post-header__settings\" ref={ ref }>\n\t\t\t\t\t<ToolbarSlot.Slot />\n\n\t\t\t\t\t{ inspector && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ticon={ cog }\n\t\t\t\t\t\t\tlabel={ __( 'Settings' ) }\n\t\t\t\t\t\t\tonClick={ () => toggleSidebar( ! isEditorSidebarOpened ) }\n\t\t\t\t\t\t\tisPressed={ isEditorSidebarOpened }\n\t\t\t\t\t\t\taria-expanded={ isEditorSidebarOpened }\n\t\t\t\t\t\t\tdisabled={ editorMode === 'text' }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ isEditorSidebarOpened && ! inspectorInSidebar && (\n\t\t\t\t\t\t<Inspector button={ ref } onToggle={ toggleSidebar } />\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ moreMenu && (\n\t\t\t\t\t\t<MoreMenu\n\t\t\t\t\t\t\tsettings={ settings }\n\t\t\t\t\t\t\tonClick={ () => closeGeneralSidebar() }\n\t\t\t\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport default BlockEditorToolbar;\n"],"mappings":"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"}