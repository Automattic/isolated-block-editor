{"version":3,"file":"index.js","names":["ContentSaver","props","onSaveBlocks","onSaveContent","firstTime","useRef","useDispatch","setReady","useSelect","select","blocks","getBlocks","ignoredContent","getIgnoredContent","saveBlocks","serialize","useEffect","current","length"],"sources":["../../../src/components/content-saver/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect, useRef } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { serialize } from '@wordpress/blocks';\n\n/** @typedef {import('../../index').OnSaveBlocks} OnSaveBlocks */\n/** @typedef {import('../../index').OnSaveContent} OnSaveContent */\n\n/**\n * Content saver\n *\n * @param {Object} props - Component props\n * @param {OnSaveBlocks} [props.onSaveBlocks] - Save blocks callback\n * @param {OnSaveContent} [props.onSaveContent] - Save content callback\n */\nfunction ContentSaver( props ) {\n\tconst { onSaveBlocks, onSaveContent } = props;\n\tconst firstTime = useRef( true );\n\tconst { setReady } = useDispatch( 'isolated/editor' );\n\tconst { blocks, ignoredContent } = useSelect(\n\t\t( select ) => ( {\n\t\t\tblocks: select( 'isolated/editor' ).getBlocks(),\n\t\t\tignoredContent: select( 'isolated/editor' ).getIgnoredContent(),\n\t\t} ),\n\t\t[]\n\t);\n\n\tfunction saveBlocks() {\n\t\t// Save the content in the format wanted by the user\n\t\tonSaveBlocks?.( blocks, ignoredContent );\n\t\tonSaveContent?.( serialize( blocks ) );\n\t}\n\n\tuseEffect( () => {\n\t\tif ( ! blocks ) {\n\t\t\tsetReady( true );\n\t\t\treturn;\n\t\t}\n\n\t\t// Try and avoid an initial first save if no content\n\t\tif ( firstTime.current ) {\n\t\t\tfirstTime.current = false;\n\t\t\tsetReady( true );\n\n\t\t\t// The editor has initial content - save it\n\t\t\tif ( blocks && blocks.length > 1 ) {\n\t\t\t\tsaveBlocks();\n\t\t\t}\n\t\t} else {\n\t\t\tsaveBlocks();\n\t\t}\n\t}, [ blocks ] );\n\n\treturn null;\n}\n\nexport default ContentSaver;\n"],"mappings":";;;;;;;AAIA;;AACA;;AACA;;AANA;AACA;AACA;;AAMA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,YAAT,CAAuBC,KAAvB,EAA+B;EAC9B,IAAQC,YAAR,GAAwCD,KAAxC,CAAQC,YAAR;EAAA,IAAsBC,aAAtB,GAAwCF,KAAxC,CAAsBE,aAAtB;EACA,IAAMC,SAAS,GAAG,IAAAC,eAAA,EAAQ,IAAR,CAAlB;;EACA,mBAAqB,IAAAC,iBAAA,EAAa,iBAAb,CAArB;EAAA,IAAQC,QAAR,gBAAQA,QAAR;;EACA,iBAAmC,IAAAC,eAAA,EAClC,UAAEC,MAAF;IAAA,OAAgB;MACfC,MAAM,EAAED,MAAM,CAAE,iBAAF,CAAN,CAA4BE,SAA5B,EADO;MAEfC,cAAc,EAAEH,MAAM,CAAE,iBAAF,CAAN,CAA4BI,iBAA5B;IAFD,CAAhB;EAAA,CADkC,EAKlC,EALkC,CAAnC;EAAA,IAAQH,MAAR,cAAQA,MAAR;EAAA,IAAgBE,cAAhB,cAAgBA,cAAhB;;EAQA,SAASE,UAAT,GAAsB;IACrB;IACAZ,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAIQ,MAAJ,EAAYE,cAAZ,CAAZ;IACAT,aAAa,SAAb,IAAAA,aAAa,WAAb,YAAAA,aAAa,CAAI,IAAAY,iBAAA,EAAWL,MAAX,CAAJ,CAAb;EACA;;EAED,IAAAM,kBAAA,EAAW,YAAM;IAChB,IAAK,CAAEN,MAAP,EAAgB;MACfH,QAAQ,CAAE,IAAF,CAAR;MACA;IACA,CAJe,CAMhB;;;IACA,IAAKH,SAAS,CAACa,OAAf,EAAyB;MACxBb,SAAS,CAACa,OAAV,GAAoB,KAApB;MACAV,QAAQ,CAAE,IAAF,CAAR,CAFwB,CAIxB;;MACA,IAAKG,MAAM,IAAIA,MAAM,CAACQ,MAAP,GAAgB,CAA/B,EAAmC;QAClCJ,UAAU;MACV;IACD,CARD,MAQO;MACNA,UAAU;IACV;EACD,CAlBD,EAkBG,CAAEJ,MAAF,CAlBH;EAoBA,OAAO,IAAP;AACA;;eAEcV,Y"}