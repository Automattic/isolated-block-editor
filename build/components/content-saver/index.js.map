{"version":3,"file":"index.js","names":["_element","require","_data","_blocks","ContentSaver","props","onSaveBlocks","onSaveContent","firstTime","useRef","_useDispatch","useDispatch","setReady","_useSelect","useSelect","select","blocks","getBlocks","ignoredContent","getIgnoredContent","saveBlocks","serialize","useEffect","current","length","_default","exports"],"sources":["../../../src/components/content-saver/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect, useRef } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { serialize } from '@wordpress/blocks';\n\n/** @typedef {import('../../index').OnSaveBlocks} OnSaveBlocks */\n/** @typedef {import('../../index').OnSaveContent} OnSaveContent */\n\n/**\n * Content saver\n *\n * @param {Object} props - Component props\n * @param {OnSaveBlocks} [props.onSaveBlocks] - Save blocks callback\n * @param {OnSaveContent} [props.onSaveContent] - Save content callback\n */\nfunction ContentSaver( props ) {\n\tconst { onSaveBlocks, onSaveContent } = props;\n\tconst firstTime = useRef( true );\n\tconst { setReady } = useDispatch( 'isolated/editor' );\n\tconst { blocks, ignoredContent } = useSelect(\n\t\t( select ) => ( {\n\t\t\t// @ts-ignore\n\t\t\tblocks: select( 'isolated/editor' ).getBlocks(),\n\t\t\t// @ts-ignore\n\t\t\tignoredContent: select( 'isolated/editor' ).getIgnoredContent(),\n\t\t} ),\n\t\t[]\n\t);\n\n\tfunction saveBlocks() {\n\t\t// Save the content in the format wanted by the user\n\t\tonSaveBlocks?.( blocks, ignoredContent );\n\t\tonSaveContent?.( serialize( blocks ) );\n\t}\n\n\tuseEffect( () => {\n\t\tif ( ! blocks ) {\n\t\t\tsetReady( true );\n\t\t\treturn;\n\t\t}\n\n\t\t// Try and avoid an initial first save if no content\n\t\tif ( firstTime.current ) {\n\t\t\tfirstTime.current = false;\n\t\t\tsetReady( true );\n\n\t\t\t// The editor has initial content - save it\n\t\t\tif ( blocks && blocks.length > 1 ) {\n\t\t\t\tsaveBlocks();\n\t\t\t}\n\t\t} else {\n\t\t\tsaveBlocks();\n\t\t}\n\t}, [ blocks ] );\n\n\treturn null;\n}\n\nexport default ContentSaver;\n"],"mappings":";;;;;;AAIA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AANA;AACA;AACA;;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASG,YAAYA,CAAEC,KAAK,EAAG;EAC9B,IAAQC,YAAY,GAAoBD,KAAK,CAArCC,YAAY;IAAEC,aAAa,GAAKF,KAAK,CAAvBE,aAAa;EACnC,IAAMC,SAAS,GAAG,IAAAC,eAAM,EAAE,IAAK,CAAC;EAChC,IAAAC,YAAA,GAAqB,IAAAC,iBAAW,EAAE,iBAAkB,CAAC;IAA7CC,QAAQ,GAAAF,YAAA,CAARE,QAAQ;EAChB,IAAAC,UAAA,GAAmC,IAAAC,eAAS,EAC3C,UAAEC,MAAM;MAAA,OAAQ;QACf;QACAC,MAAM,EAAED,MAAM,CAAE,iBAAkB,CAAC,CAACE,SAAS,CAAC,CAAC;QAC/C;QACAC,cAAc,EAAEH,MAAM,CAAE,iBAAkB,CAAC,CAACI,iBAAiB,CAAC;MAC/D,CAAC;IAAA,CAAE,EACH,EACD,CAAC;IAROH,MAAM,GAAAH,UAAA,CAANG,MAAM;IAAEE,cAAc,GAAAL,UAAA,CAAdK,cAAc;EAU9B,SAASE,UAAUA,CAAA,EAAG;IACrB;IACAd,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAIU,MAAM,EAAEE,cAAe,CAAC;IACxCX,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAI,IAAAc,iBAAS,EAAEL,MAAO,CAAE,CAAC;EACvC;EAEA,IAAAM,kBAAS,EAAE,YAAM;IAChB,IAAK,CAAEN,MAAM,EAAG;MACfJ,QAAQ,CAAE,IAAK,CAAC;MAChB;IACD;;IAEA;IACA,IAAKJ,SAAS,CAACe,OAAO,EAAG;MACxBf,SAAS,CAACe,OAAO,GAAG,KAAK;MACzBX,QAAQ,CAAE,IAAK,CAAC;;MAEhB;MACA,IAAKI,MAAM,IAAIA,MAAM,CAACQ,MAAM,GAAG,CAAC,EAAG;QAClCJ,UAAU,CAAC,CAAC;MACb;IACD,CAAC,MAAM;MACNA,UAAU,CAAC,CAAC;IACb;EACD,CAAC,EAAE,CAAEJ,MAAM,CAAG,CAAC;EAEf,OAAO,IAAI;AACZ;AAAC,IAAAS,QAAA,GAEcrB,YAAY;AAAAsB,OAAA,cAAAD,QAAA"}