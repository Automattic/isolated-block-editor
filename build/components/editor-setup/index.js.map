{"version":3,"file":"index.js","names":["_element","require","_data","_blocks","_editorSettings","_interopRequireDefault","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","useEditorSetup","settings","_currentSettings$edit","_useDispatch","useDispatch","undo","setupEditor","_useDispatch2","updateEditorSettings","setupCoreEditor","setupEditorState","_useDispatch3","updateSettings","_useSelect","useSelect","select","_settings$iso","_settings$iso2","_select","isEditingSelect","isEditing","isFeatureActive","_select2","blocksStore","getBlockTypes","blockTypes","hasFixedToolbar","editor","topToolbar","currentSettings","getEditorSettings","iso","defaultPreferences","fixedToolbar","undefined","__experimentalReusableBlocks","__experimentalFetchReusableBlocks","__experimentalUndo","updateAllSettings","newSettings","useEffect","window","__editorAssets","styles","scripts","id","type","reusableBlocks"],"sources":["../../../src/components/editor-setup/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blocksStore } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\n\nimport getEditorSettings from './editor-settings';\n\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n\n/**\n * Settings callback\n *\n * @callback OnSettings\n * @param {BlockEditorSettings} settings\n */\n\n/**\n * Sets up Gutenberg and the Isolated Block Editor\n *\n * An initial setup is performed, and is then reset each time the editor is focussed. This ensures we are applying the right\n * settings for this particular editor.\n *\n * @param {BlockEditorSettings} settings - Settings\n */\nexport default function useEditorSetup( settings ) {\n\t// @ts-ignore\n\tconst { undo, setupEditor } = useDispatch( 'isolated/editor' );\n\tconst { updateEditorSettings, setupEditorState: setupCoreEditor } = useDispatch( 'core/editor' );\n\tconst { updateSettings } = useDispatch( 'core/block-editor' );\n\tconst { isEditing, topToolbar, currentSettings } = useSelect( ( select ) => {\n\t\tconst { isEditing: isEditingSelect, isFeatureActive } = select( 'isolated/editor' );\n\t\t// @ts-ignore\n\t\tconst { getBlockTypes } = select( blocksStore );\n\t\tconst blockTypes = getBlockTypes();\n\t\t// @ts-ignore\n\t\tconst hasFixedToolbar = isFeatureActive( 'fixedToolbar', settings?.editor.hasFixedToolbar );\n\n\t\treturn {\n\t\t\t// @ts-ignore\n\t\t\tisEditing: isEditingSelect(),\n\t\t\ttopToolbar: hasFixedToolbar,\n\t\t\tcurrentSettings: {\n\t\t\t\t...settings,\n\n\t\t\t\teditor: {\n\t\t\t\t\t...getEditorSettings(\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tsettings.editor,\n\t\t\t\t\t\tsettings.iso,\n\t\t\t\t\t\tblockTypes,\n\t\t\t\t\t\t// Use the default preference, if set, otherwise use the feature\n\t\t\t\t\t\tsettings.iso?.defaultPreferences?.fixedToolbar !== undefined\n\t\t\t\t\t\t\t? settings.iso?.defaultPreferences?.fixedToolbar\n\t\t\t\t\t\t\t: hasFixedToolbar\n\t\t\t\t\t),\n\n\t\t\t\t\t// Reusable blocks\n\t\t\t\t\t__experimentalReusableBlocks: [],\n\t\t\t\t\t__experimentalFetchReusableBlocks: false,\n\n\t\t\t\t\t// Experimental undo, to do some experimental things\n\t\t\t\t\t__experimentalUndo: undo\n\t\t\t\t},\n\t\t\t}\n\t\t};\n\t}, [ settings ] );\n\n\tfunction updateAllSettings( newSettings ) {\n\t\tupdateSettings( newSettings.editor );\n\t\tupdateEditorSettings( newSettings.editor );\n\t}\n\n\t// This is the initial setup\n\tuseEffect( () => {\n\t\t// Ensure we always have a __editorAssets value - Gutenberg hardcoded assets\n\t\t// @ts-ignore\n\t\tif ( window.__editorAssets === undefined ) {\n\t\t\t// @ts-ignore\n\t\t\twindow.__editorAssets = { styles: '', scripts: '' };\n\t\t}\n\n\t\t// Setup the Isolated Editor & Gutenberg\n\t\tsetupEditor( currentSettings );\n\n\t\t// And Gutenberg\n\t\tupdateAllSettings( currentSettings );\n\n\t\t// Set up the post entities with some dummy data, ensuring that anything that uses post entities can work\n\t\tsetupCoreEditor(\n\t\t\t{\n\t\t\t\tid: 0,\n\t\t\t\ttype: 'post',\n\t\t\t},\n\t\t\t[]\n\t\t);\n\t}, [] );\n\n\t// Run whenever the editor is focussed, or the topToolbar setting or reusable blocks change\n\tuseEffect( () => {\n\t\tif ( !isEditing ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Setup Gutenberg for this editor, but only when focussed. This swaps allowed blocks and other capabilities\n\t\tupdateSettings( currentSettings );\n\t}, [ isEditing, topToolbar, currentSettings?.editor?.reusableBlocks ] );\n\n\treturn settings;\n}\n"],"mappings":"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"}