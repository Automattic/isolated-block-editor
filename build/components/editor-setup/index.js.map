{"version":3,"file":"index.js","names":["useEditorSetup","settings","useDispatch","undo","setupEditor","updateEditorSettings","setupCoreEditor","setupEditorState","updateSettings","useSelect","select","isEditingSelect","isEditing","isFeatureActive","blocksStore","getBlockTypes","blockTypes","hasFixedToolbar","topToolbar","currentSettings","editor","getEditorSettings","iso","defaultPreferences","fixedToolbar","undefined","__experimentalReusableBlocks","__experimentalFetchReusableBlocks","__experimentalUndo","updateAllSettings","newSettings","useEffect","window","__editorAssets","styles","scripts","id","type","reusableBlocks"],"sources":["../../../src/components/editor-setup/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { store as blocksStore } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\n\nimport getEditorSettings from './editor-settings';\n\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n\n/**\n * Settings callback\n *\n * @callback OnSettings\n * @param {BlockEditorSettings} settings\n */\n\n/**\n * Sets up Gutenberg and the Isolated Block Editor\n *\n * An initial setup is performed, and is then reset each time the editor is focussed. This ensures we are applying the right\n * settings for this particular editor.\n *\n * @param {BlockEditorSettings} settings - Settings\n */\nexport default function useEditorSetup( settings ) {\n\t// @ts-ignore\n\tconst { undo, setupEditor } = useDispatch( 'isolated/editor' );\n\tconst { updateEditorSettings, setupEditorState: setupCoreEditor } = useDispatch( 'core/editor' );\n\tconst { updateSettings } = useDispatch( 'core/block-editor' );\n\tconst { isEditing, topToolbar, currentSettings } = useSelect( ( select ) => {\n\t\tconst { isEditing: isEditingSelect, isFeatureActive } = select( 'isolated/editor' );\n\t\t// @ts-ignore\n\t\tconst { getBlockTypes } = select( blocksStore );\n\t\tconst blockTypes = getBlockTypes();\n\t\t// @ts-ignore\n\t\tconst hasFixedToolbar = isFeatureActive( 'fixedToolbar' );\n\n\t\treturn {\n\t\t\t// @ts-ignore\n\t\t\tisEditing: isEditingSelect(),\n\t\t\ttopToolbar: hasFixedToolbar,\n\t\t\tcurrentSettings: {\n\t\t\t\t...settings,\n\n\t\t\t\teditor: {\n\t\t\t\t\t...getEditorSettings(\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tsettings.editor,\n\t\t\t\t\t\tsettings.iso,\n\t\t\t\t\t\tblockTypes,\n\t\t\t\t\t\t// Use the default preference, if set, otherwise use the feature\n\t\t\t\t\t\tsettings.iso?.defaultPreferences?.fixedToolbar !== undefined\n\t\t\t\t\t\t\t? settings.iso?.defaultPreferences?.fixedToolbar\n\t\t\t\t\t\t\t: hasFixedToolbar\n\t\t\t\t\t),\n\n\t\t\t\t\t// Reusable blocks\n\t\t\t\t\t__experimentalReusableBlocks: [],\n\t\t\t\t\t__experimentalFetchReusableBlocks: false,\n\n\t\t\t\t\t// Experimental undo, to do some experimental things\n\t\t\t\t\t__experimentalUndo: undo\n\t\t\t\t},\n\t\t\t}\n\t\t};\n\t}, [ settings ] );\n\n\tfunction updateAllSettings( newSettings ) {\n\t\tupdateSettings( newSettings.editor );\n\t\tupdateEditorSettings( newSettings.editor );\n\t}\n\n\t// This is the initial setup\n\tuseEffect( () => {\n\t\t// Ensure we always have a __editorAssets value - Gutenberg hardcoded assets\n\t\t// @ts-ignore\n\t\tif ( window.__editorAssets === undefined ) {\n\t\t\t// @ts-ignore\n\t\t\twindow.__editorAssets = { styles: '', scripts: '' };\n\t\t}\n\n\t\t// Setup the Isolated Editor & Gutenberg\n\t\tsetupEditor( currentSettings );\n\n\t\t// And Gutenberg\n\t\tupdateAllSettings( currentSettings );\n\n\t\t// Set up the post entities with some dummy data, ensuring that anything that uses post entities can work\n\t\tsetupCoreEditor(\n\t\t\t{\n\t\t\t\tid: 0,\n\t\t\t\ttype: 'post',\n\t\t\t},\n\t\t\t[]\n\t\t);\n\t}, [] );\n\n\t// Run whenever the editor is focussed, or the topToolbar setting or reusable blocks change\n\tuseEffect( () => {\n\t\tif ( !isEditing ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Setup Gutenberg for this editor, but only when focussed. This swaps allowed blocks and other capabilities\n\t\tupdateSettings( currentSettings );\n\t}, [ isEditing, topToolbar, currentSettings?.editor?.reusableBlocks ] );\n\n\treturn settings;\n}\n"],"mappings":"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"}