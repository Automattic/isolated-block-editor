{"version":3,"file":"listview-sidebar.js","names":["_blockEditor","require","_components","_compose","_data","_dom","_element","_i18n","_icons","_keyboardShortcuts","_keycodes","_listViewOutline","_interopRequireDefault","_unlock2","createElement","_unlock","unlock","componentsPrivateApis","Tabs","ListViewSidebar","_ref","_ref$canClose","canClose","_useDispatch","useDispatch","setIsListViewOpened","focusOnMountRef","useFocusOnMount","closeListView","useCallback","closeOnEscape","event","keyCode","ESCAPE","defaultPrevented","preventDefault","_useState","useState","_useState2","_slicedToArray2","dropZoneElement","setDropZoneElement","_useState3","_useState4","tab","setTab","sidebarRef","useRef","tabsRef","listViewRef","listViewContainerRef","useMergeRefs","handleSidebarFocus","currentTab","tabPanelFocus","focus","tabbable","find","current","listViewApplicationFocus","listViewFocusArea","contains","handleToggleListViewShortcut","ownerDocument","activeElement","useShortcut","className","onKeyDown","ref","onSelect","tabName","selectOnMove","initialTabId","Button","icon","closeSmall","label","__","onClick","TabList","Tab","tabId","_x","TabPanel","focusable","__experimentalListView"],"sources":["../../../src/components/block-editor/listview-sidebar.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __experimentalListView as ListView } from '@wordpress/block-editor';\nimport { Button, privateApis as componentsPrivateApis } from '@wordpress/components';\nimport {\n\tuseFocusOnMount,\n\tuseMergeRefs,\n} from '@wordpress/compose';\nimport { useDispatch } from '@wordpress/data';\nimport { focus } from '@wordpress/dom';\nimport { useRef, useState, useCallback } from '@wordpress/element';\nimport { __, _x } from '@wordpress/i18n';\nimport { closeSmall } from '@wordpress/icons';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\nimport { ESCAPE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport ListViewOutline from './list-view-outline';\n\nimport { unlock } from './unlock';\n\nconst { Tabs } = unlock( componentsPrivateApis );\n\n\nexport default function ListViewSidebar( { canClose = true } ) {\n\tconst { setIsListViewOpened } = useDispatch( 'isolated/editor' );\n\n\t// This hook handles focus when the sidebar first renders.\n\tconst focusOnMountRef = useFocusOnMount( 'firstElement' );\n\n\t// When closing the list view, focus should return to the toggle button.\n\tconst closeListView = useCallback( () => {\n\t\tsetIsListViewOpened( false );\n\t}, [ setIsListViewOpened ] );\n\n\tconst closeOnEscape = useCallback(\n\t\t( event ) => {\n\t\t\tif ( event.keyCode === ESCAPE && ! event.defaultPrevented ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcloseListView();\n\t\t\t}\n\t\t},\n\t\t[ closeListView ]\n\t);\n\n\t// Use internal state instead of a ref to make sure that the component\n\t// re-renders when the dropZoneElement updates.\n\tconst [ dropZoneElement, setDropZoneElement ] = useState( null );\n\t// Tracks our current tab.\n\tconst [ tab, setTab ] = useState( 'list-view' );\n\n\t// This ref refers to the sidebar as a whole.\n\tconst sidebarRef = useRef();\n\t// This ref refers to the tab panel.\n\tconst tabsRef = useRef();\n\t// This ref refers to the list view application area.\n\tconst listViewRef = useRef();\n\n\t// Must merge the refs together so focus can be handled properly in the next function.\n\tconst listViewContainerRef = useMergeRefs( [\n\t\tfocusOnMountRef,\n\t\tlistViewRef,\n\t\tsetDropZoneElement,\n\t] );\n\n\t/*\n\t * Callback function to handle list view or outline focus.\n\t *\n\t * @param {string} currentTab The current tab. Either list view or outline.\n\t *\n\t * @return void\n\t */\n\tfunction handleSidebarFocus( currentTab ) {\n\t\t// Tab panel focus.\n\t\t// @ts-ignore\n\t\tconst tabPanelFocus = focus.tabbable.find( tabsRef.current )[ 0 ];\n\t\t// List view tab is selected.\n\t\tif ( currentTab === 'list-view' ) {\n\t\t\t// Either focus the list view or the tab panel. Must have a fallback because the list view does not render when there are no blocks.\n\t\t\tconst listViewApplicationFocus = focus.tabbable.find(\n\t\t\t\t// @ts-ignore\n\t\t\t\tlistViewRef.current\n\t\t\t)[ 0 ];\n\t\t\t// @ts-ignore\n\t\t\tconst listViewFocusArea = sidebarRef.current.contains(\n\t\t\t\tlistViewApplicationFocus\n\t\t\t)\n\t\t\t\t? listViewApplicationFocus\n\t\t\t\t: tabPanelFocus;\n\t\t\t// @ts-ignore\n\t\t\tlistViewFocusArea.focus();\n\t\t\t// Outline tab is selected.\n\t\t} else {\n\t\t\t// @ts-ignore\n\t\t\ttabPanelFocus.focus();\n\t\t}\n\t}\n\n\tconst handleToggleListViewShortcut = useCallback( () => {\n\t\t// If the sidebar has focus, it is safe to close.\n\t\tif (\n\t\t\t// @ts-ignore\n\t\t\tsidebarRef.current.contains(\n\t\t\t\t// @ts-ignore\n\t\t\t\tsidebarRef.current.ownerDocument.activeElement\n\t\t\t)\n\t\t) {\n\t\t\tcloseListView();\n\t\t} else {\n\t\t\t// If the list view or outline does not have focus, focus should be moved to it.\n\t\t\thandleSidebarFocus( tab );\n\t\t}\n\t}, [ closeListView, tab ] );\n\n\t// This only fires when the sidebar is open because of the conditional rendering. It is the same shortcut to open but that is defined as a global shortcut and only fires when the sidebar is closed.\n\tuseShortcut( 'core/edit-post/toggle-list-view', handleToggleListViewShortcut );\n\n\treturn (\n\t\t// eslint-disable-next-line jsx-a11y/no-static-element-interactions\n\t\t<div\n\t\t\tclassName=\"editor-list-view-sidebar\"\n\t\t\tonKeyDown={ closeOnEscape }\n\t\t\t// @ts-ignore\n\t\t\tref={ sidebarRef }\n\t\t>\n\t\t\t<Tabs\n\t\t\t\tonSelect={(tabName) => setTab(tabName)}\n\t\t\t\tselectOnMove={false}\n\t\t\t\t// The initial tab value is set explicitly to avoid an initial\n\t\t\t\t// render where no tab is selected. This ensures that the\n\t\t\t\t// tabpanel height is correct so the relevant scroll container\n\t\t\t\t// can be rendered internally.\n\t\t\t\tinitialTabId=\"list-view\"\n\t\t\t>\n\t\t\t\t<div className=\"edit-post-editor__document-overview-panel__header\">\n\t\t\t\t\t{canClose && <Button\n\t\t\t\t\t\tclassName=\"editor-list-view-sidebar__close-button\"\n\t\t\t\t\t\ticon={ closeSmall }\n\t\t\t\t\t\tlabel={ __( 'Close' ) }\n\t\t\t\t\t\tonClick={ closeListView }\n\t\t\t\t\t/>}\n\t\t\t\t\t<Tabs.TabList\n\t\t\t\t\t\tclassName=\"editor-list-view-sidebar__tabs-tablist\"\n\t\t\t\t\t\tref={ tabsRef }\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tabs.Tab className=\"editor-list-view-sidebar__tabs-tab\" tabId='list-view'>\n\t\t\t\t\t\t\t{_x('List View', 'Post overview')}\n\t\t\t\t\t\t</Tabs.Tab>\n\t\t\t\t\t\t<Tabs.Tab className=\"editor-list-view-sidebar__tabs-tab\" tabId='outline'>\n\t\t\t\t\t\t\t{_x('Outline', 'Post overview')}\n\t\t\t\t\t\t</Tabs.Tab>\n\t\t\t\t\t</Tabs.TabList>\n\t\t\t\t</div>\n\t\t\t\t<Tabs.TabPanel\n\t\t\t\t\tref={listViewContainerRef}\n\t\t\t\t\tclassName=\"editor-list-view-sidebar__tabs-tabpanel\"\n\t\t\t\t\ttabId=\"list-view\"\n\t\t\t\t\tfocusable={false}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"editor-list-view-sidebar__list-view-container\">\n\t\t\t\t\t\t<div className=\"editor-list-view-sidebar__list-view-panel-content\">\n\t\t\t\t\t\t\t<ListView dropZoneElement={dropZoneElement}/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Tabs.TabPanel>\n\t\t\t\t<Tabs.TabPanel\n\t\t\t\t\tclassName=\"editor-list-view-sidebar__tabs-tabpanel\"\n\t\t\t\t\ttabId=\"outline\"\n\t\t\t\t\tfocusable={false}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"editor-list-view-sidebar__list-view-container\">\n\t\t\t\t\t\t<ListViewOutline/>\n\t\t\t\t\t</div>\n\t\t\t\t</Tabs.TabPanel>\n\t\t\t</Tabs>\n\t\t</div>\n\t);\n}\n"],"mappings":"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"}