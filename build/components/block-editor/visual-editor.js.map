{"version":3,"file":"visual-editor.js","names":["MaybeIframe","children","contentRef","shouldIframe","styles","style","ref","useMouseMoveTypingReset","useSelect","select","settings","getSettings","assets","__unstableResolvedAssets","flex","width","height","display","PreviewWrapper","disableAnimations","initialStyle","currentStyle","props","VisualEditor","themeSupportsLayout","blockEditorStore","supportsLayout","getCanvasStyles","getPreviewDeviceType","getEditorSettings","isIframePreview","canvasStyles","deviceType","disableCanvasAnimations","resizedCanvasStyles","useResizeCanvas","defaultLayout","useSetting","previewMode","toLowerCase","desktopCanvasStyles","margin","flexFlow","background","animatedStyles","blockSelectionClearerRef","useBlockSelectionClearer","useRef","useMergeRefs","useClipboardHandler","useTypewriter","useTypingObserver","layout","useMemo","undefined","usedLayout","definitions","type","padding"],"sources":["../../../src/components/block-editor/visual-editor.js"],"sourcesContent":["// @ts-nocheck\n/**\n * WordPress dependencies\n */\nimport {\n\tBlockList,\n\tWritingFlow,\n\tstore as blockEditorStore,\n\tuseSetting,\n\t__unstableEditorStyles as EditorStyles,\n\t__experimentalLayoutStyle as LayoutStyle,\n\t__unstableUseBlockSelectionClearer as useBlockSelectionClearer,\n\t__unstableUseTypewriter as useTypewriter,\n\t__unstableUseClipboardHandler as useClipboardHandler,\n\t__unstableUseTypingObserver as useTypingObserver,\n\t__experimentalUseResizeCanvas as useResizeCanvas,\n\t__unstableUseMouseMoveTypingReset as useMouseMoveTypingReset,\n\t__unstableIframe as Iframe,\n\tBlockTools,\n} from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useRef, useMemo } from '@wordpress/element';\nimport { useMergeRefs } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport EditorHeading from '../editor-heading-slot';\nimport FooterSlot from '../footer-slot';\n\nfunction MaybeIframe( { children, contentRef, shouldIframe, styles, style } ) {\n\tconst ref = useMouseMoveTypingReset();\n\n\tconst { assets } = useSelect( ( select ) => {\n\t\tconst settings = select( 'core/block-editor' ).getSettings();\n\t\treturn {\n\t\t\tassets: settings.__unstableResolvedAssets,\n\t\t};\n\t}, [] );\n\n\tif ( !shouldIframe ) {\n\t\t// TODO: this will add an EditorStyles for each editor on the page, which includes adding a <style> element. probably harmless but something to keep an eye on\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorStyles styles={ styles } />\n\t\t\t\t<WritingFlow\n\t\t\t\t\tref={ contentRef }\n\t\t\t\t\tclassName=\"editor-styles-wrapper\"\n\t\t\t\t\tstyle={ { flex: '1', ...style } }\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</WritingFlow>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Iframe\n\t\t\thead={ <EditorStyles styles={ styles } /> }\n\t\t\tassets={ assets }\n\t\t\tref={ ref }\n\t\t\tcontentRef={ contentRef }\n\t\t\tstyle={ { width: '100%', height: '100%', display: 'block' } }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t{ children }\n\t\t</Iframe>\n\t);\n}\n\nconst PreviewWrapper = ( { children, disableAnimations, initialStyle, currentStyle, ...props } ) => {\n\tif ( disableAnimations ) {\n\t\treturn <div style={ currentStyle } { ...props }>{ children }</div>;\n\t}\n\n\treturn (\n\t\t<motion.div animate={ currentStyle } initial={ initialStyle } { ...props }>\n\t\t\t{ children }\n\t\t</motion.div>\n\t);\n};\n\n/**\n * This is a copy of packages/edit-post/src/components/visual-editor/index.js\n *\n * The original is not exported, and contains code for post titles\n *\n * @param {Object} args\n * @param args.styles\n */\nconst VisualEditor = ( { styles } ) => {\n\tconst themeSupportsLayout = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().supportsLayout;\n\t}, [] );\n\tconst { canvasStyles, deviceType, disableCanvasAnimations, isIframePreview } = useSelect( ( select ) => {\n\t\tconst { getCanvasStyles, getPreviewDeviceType, getEditorSettings, isIframePreview } =\n\t\t\tselect( 'isolated/editor' );\n\n\t\treturn {\n\t\t\tcanvasStyles: getCanvasStyles(),\n\t\t\tdeviceType: getPreviewDeviceType(),\n\t\t\tdisableCanvasAnimations: getEditorSettings().disableCanvasAnimations,\n\t\t\tisIframePreview: isIframePreview(),\n\t\t};\n\t}, [] );\n\tconst resizedCanvasStyles = useResizeCanvas( deviceType, false );\n\tconst defaultLayout = useSetting( 'layout' );\n\tconst previewMode = 'is-' + deviceType.toLowerCase() + '-preview';\n\n\tconst desktopCanvasStyles = {\n\t\t// We intentionally omit a 100% height here. The container is a flex item, so the 100% height is granted by default.\n\t\t// If a percentage height is present, older browsers such as Safari 13 apply that, but do so incorrectly as the inheritance is buggy.\n\t\twidth: '100%',\n\t\tmargin: 0,\n\t\tdisplay: 'flex',\n\t\tflexFlow: 'column',\n\t\t// Default background color so that grey\n\t\t// .edit-post-editor-regions__content color doesn't show through.\n\t\tbackground: 'white',\n\t};\n\tlet animatedStyles = desktopCanvasStyles;\n\n\tif ( resizedCanvasStyles ) {\n\t\tanimatedStyles = resizedCanvasStyles;\n\t}\n\n\tif ( canvasStyles ) {\n\t\tanimatedStyles = {\n\t\t\t...animatedStyles,\n\t\t\t...canvasStyles,\n\t\t};\n\t}\n\n\tconst blockSelectionClearerRef = useBlockSelectionClearer();\n\tconst ref = useRef();\n\tconst contentRef = useMergeRefs( [\n\t\tref,\n\t\tuseClipboardHandler(),\n\t\tuseTypewriter(),\n\t\tuseBlockSelectionClearer(),\n\t\tuseTypingObserver(),\n\t] );\n\n\tconst layout = useMemo( () => {\n\t\tif ( themeSupportsLayout ) {\n\t\t\treturn defaultLayout;\n\t\t}\n\n\t\treturn undefined;\n\t}, [ themeSupportsLayout, defaultLayout ] );\n\n\t// If there is a layout definition, then we're on Gutenberg > v14, which requires us to pass the\n\t// 'constrained' type\n\tconst usedLayout = layout?.definitions ? { ...layout, type: 'constrained' } : layout;\n\n\treturn (\n\t\t<BlockTools __unstableContentRef={ ref } className=\"edit-post-visual-editor\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"edit-post-visual-editor__content-area\"\n\t\t\t\tanimate={ {\n\t\t\t\t\tpadding: '0',\n\t\t\t\t} }\n\t\t\t\tref={ blockSelectionClearerRef }\n\t\t\t>\n\t\t\t\t<PreviewWrapper\n\t\t\t\t\tclassName={ previewMode }\n\t\t\t\t\tcurrentStyle={ animatedStyles }\n\t\t\t\t\tdisableAnimations={ disableCanvasAnimations }\n\t\t\t\t\tinitialStyle={ desktopCanvasStyles }\n\t\t\t\t>\n\t\t\t\t\t<MaybeIframe\n\t\t\t\t\t\tshouldIframe={ isIframePreview }\n\t\t\t\t\t\tcontentRef={ contentRef }\n\t\t\t\t\t\tstyles={ styles }\n\t\t\t\t\t\tstyle={ {} }\n\t\t\t\t\t>\n\t\t\t\t\t\t<LayoutStyle\n\t\t\t\t\t\t\tselector=\".edit-post-visual-editor__post-title-wrapper, .block-editor-block-list__layout.is-root-container\"\n\t\t\t\t\t\t\tlayout={ usedLayout }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<EditorHeading.Slot mode=\"visual\" />\n\t\t\t\t\t\t<BlockList className={ undefined } __experimentalLayout={ layout } />\n\t\t\t\t\t\t<FooterSlot.Slot mode=\"visual\" />\n\t\t\t\t\t</MaybeIframe>\n\t\t\t\t</PreviewWrapper>\n\t\t\t</motion.div>\n\t\t</BlockTools>\n\t);\n};\n\nexport default VisualEditor;\n"],"mappings":"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"}