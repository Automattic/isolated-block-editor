{"version":3,"file":"visual-editor.js","names":["MaybeIframe","children","contentRef","shouldIframe","styles","style","ref","useMouseMoveTypingReset","flex","width","height","display","VisualEditor","themeSupportsLayout","useSelect","select","blockEditorStore","getSettings","supportsLayout","deviceType","getPreviewDeviceType","resizedCanvasStyles","useResizeCanvas","defaultLayout","useSetting","previewMode","toLowerCase","desktopCanvasStyles","margin","flexFlow","background","animatedStyles","blockSelectionClearerRef","useBlockSelectionClearer","useRef","useMergeRefs","useClipboardHandler","useTypewriter","useTypingObserver","layout","useMemo","undefined","padding"],"sources":["../../../src/components/block-editor/visual-editor.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tBlockList,\n\tWritingFlow,\n\tstore as blockEditorStore,\n\tuseSetting,\n\t__unstableEditorStyles as EditorStyles,\n\t__experimentalLayoutStyle as LayoutStyle,\n\t__unstableUseBlockSelectionClearer as useBlockSelectionClearer,\n\t__unstableUseTypewriter as useTypewriter,\n\t__unstableUseClipboardHandler as useClipboardHandler,\n\t__unstableUseTypingObserver as useTypingObserver,\n\t__experimentalBlockSettingsMenuFirstItem,\n\t__experimentalUseResizeCanvas as useResizeCanvas,\n\t__unstableUseMouseMoveTypingReset as useMouseMoveTypingReset,\n\t__unstableIframe as Iframe,\n\tBlockTools,\n} from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useRef, useMemo } from '@wordpress/element';\nimport { useMergeRefs } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport EditorHeading from '../editor-heading-slot';\n\nfunction MaybeIframe( { children, contentRef, shouldIframe, styles, style } ) {\n\tconst ref = useMouseMoveTypingReset();\n\n\tif ( ! shouldIframe ) {\n\t\t// TODO: this will add an EditorStyles for each editor on the page, which includes adding a <style> element. probably harmless but something to keep an eye on\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorStyles styles={ styles } />\n\t\t\t\t<WritingFlow\n\t\t\t\t\tref={ contentRef }\n\t\t\t\t\tclassName=\"editor-styles-wrapper\"\n\t\t\t\t\tstyle={ { flex: '1', ...style } }\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</WritingFlow>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Iframe\n\t\t\thead={ <EditorStyles styles={ styles } /> }\n\t\t\tref={ ref }\n\t\t\tcontentRef={ contentRef }\n\t\t\tstyle={ { width: '100%', height: '100%', display: 'block' } }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t{ children }\n\t\t</Iframe>\n\t);\n}\n\n/**\n * This is a copy of packages/edit-post/src/components/visual-editor/index.js\n *\n * The original is not exported, and contains code for post titles\n *\n * @param {Object} args\n * @param args.styles\n */\nconst VisualEditor = ( { styles } ) => {\n\tconst themeSupportsLayout = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().supportsLayout;\n\t}, [] );\n\tconst { deviceType } = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tdeviceType: select( 'isolated/editor' ).getPreviewDeviceType(),\n\t\t};\n\t} );\n\tconst resizedCanvasStyles = useResizeCanvas( deviceType, false );\n\tconst defaultLayout = useSetting( 'layout' );\n\tconst previewMode = 'is-' + deviceType.toLowerCase() + '-preview';\n\n\tconst desktopCanvasStyles = {\n\t\t// We intentionally omit a 100% height here. The container is a flex item, so the 100% height is granted by default.\n\t\t// If a percentage height is present, older browsers such as Safari 13 apply that, but do so incorrectly as the inheritance is buggy.\n\t\twidth: '100%',\n\t\tmargin: 0,\n\t\tdisplay: 'flex',\n\t\tflexFlow: 'column',\n\t\t// Default background color so that grey\n\t\t// .edit-post-editor-regions__content color doesn't show through.\n\t\tbackground: 'white',\n\t};\n\tlet animatedStyles = desktopCanvasStyles;\n\tif ( resizedCanvasStyles ) {\n\t\tanimatedStyles = resizedCanvasStyles;\n\t}\n\n\tconst blockSelectionClearerRef = useBlockSelectionClearer();\n\tconst ref = useRef();\n\tconst contentRef = useMergeRefs( [\n\t\tref,\n\t\tuseClipboardHandler(),\n\t\tuseTypewriter(),\n\t\tuseBlockSelectionClearer(),\n\t\tuseTypingObserver(),\n\t] );\n\n\tconst layout = useMemo( () => {\n\t\tif ( themeSupportsLayout ) {\n\t\t\treturn defaultLayout;\n\t\t}\n\n\t\treturn undefined;\n\t}, [ themeSupportsLayout, defaultLayout ] );\n\n\treturn (\n\t\t<BlockTools __unstableContentRef={ ref } className=\"edit-post-visual-editor\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"edit-post-visual-editor__content-area\"\n\t\t\t\tanimate={ {\n\t\t\t\t\tpadding: '0',\n\t\t\t\t} }\n\t\t\t\tref={ blockSelectionClearerRef }\n\t\t\t>\n\t\t\t\t<motion.div animate={ animatedStyles } initial={ desktopCanvasStyles } className={ previewMode }>\n\t\t\t\t\t<MaybeIframe\n\t\t\t\t\t\tshouldIframe={ deviceType === 'Tablet' || deviceType === 'Mobile' }\n\t\t\t\t\t\tcontentRef={ contentRef }\n\t\t\t\t\t\tstyles={ styles }\n\t\t\t\t\t\tstyle={ {} }\n\t\t\t\t\t>\n\t\t\t\t\t\t<LayoutStyle\n\t\t\t\t\t\t\tselector=\".edit-post-visual-editor__post-title-wrapper, .block-editor-block-list__layout.is-root-container\"\n\t\t\t\t\t\t\tlayout={ defaultLayout }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<EditorHeading.Slot mode=\"visual\" />\n\t\t\t\t\t\t<BlockList className={ undefined } __experimentalLayout={ layout } />\n\t\t\t\t\t</MaybeIframe>\n\t\t\t\t</motion.div>\n\t\t\t</motion.div>\n\t\t</BlockTools>\n\t);\n};\n\nexport default VisualEditor;\n"],"mappings":"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"}