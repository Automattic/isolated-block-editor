{"version":3,"file":"visual-editor.js","names":["MaybeIframe","children","contentRef","shouldIframe","styles","style","ref","useMouseMoveTypingReset","useSelect","select","settings","getSettings","assets","__unstableResolvedAssets","flex","width","height","display","PreviewWrapper","disableAnimations","initialStyle","currentStyle","props","VisualEditor","themeSupportsLayout","blockEditorStore","supportsLayout","getCanvasStyles","getPreviewDeviceType","getEditorSettings","isIframePreview","canvasStyles","deviceType","disableCanvasAnimations","resizedCanvasStyles","useResizeCanvas","defaultLayout","useSetting","previewMode","toLowerCase","desktopCanvasStyles","margin","flexFlow","background","animatedStyles","blockSelectionClearerRef","useBlockSelectionClearer","useRef","useMergeRefs","useClipboardHandler","useTypewriter","useTypingObserver","layout","useMemo","undefined","usedLayout","definitions","type","padding"],"sources":["../../../src/components/block-editor/visual-editor.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tBlockList,\n\tWritingFlow,\n\tstore as blockEditorStore,\n\tuseSetting,\n\t__unstableEditorStyles as EditorStyles,\n\t__experimentalLayoutStyle as LayoutStyle,\n\t__unstableUseBlockSelectionClearer as useBlockSelectionClearer,\n\t__unstableUseTypewriter as useTypewriter,\n\t__unstableUseClipboardHandler as useClipboardHandler,\n\t__unstableUseTypingObserver as useTypingObserver,\n\t__experimentalBlockSettingsMenuFirstItem,\n\t__experimentalUseResizeCanvas as useResizeCanvas,\n\t__unstableUseMouseMoveTypingReset as useMouseMoveTypingReset,\n\t__unstableIframe as Iframe,\n\tBlockTools,\n} from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useRef, useMemo } from '@wordpress/element';\nimport { useMergeRefs } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport EditorHeading from '../editor-heading-slot';\nimport FooterSlot from '../footer-slot';\n\nfunction MaybeIframe( { children, contentRef, shouldIframe, styles, style } ) {\n\tconst ref = useMouseMoveTypingReset();\n\n\tconst { assets } = useSelect( ( select ) => {\n\t\tconst settings = select( 'core/block-editor' ).getSettings();\n\t\treturn {\n\t\t\tassets: settings.__unstableResolvedAssets,\n\t\t};\n\t}, [] );\n\n\tif ( ! shouldIframe ) {\n\t\t// TODO: this will add an EditorStyles for each editor on the page, which includes adding a <style> element. probably harmless but something to keep an eye on\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorStyles styles={ styles } />\n\t\t\t\t<WritingFlow\n\t\t\t\t\tref={ contentRef }\n\t\t\t\t\tclassName=\"editor-styles-wrapper\"\n\t\t\t\t\tstyle={ { flex: '1', ...style } }\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</WritingFlow>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Iframe\n\t\t\thead={ <EditorStyles styles={ styles } /> }\n\t\t\tassets={ assets }\n\t\t\tref={ ref }\n\t\t\tcontentRef={ contentRef }\n\t\t\tstyle={ { width: '100%', height: '100%', display: 'block' } }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t{ children }\n\t\t</Iframe>\n\t);\n}\n\nconst PreviewWrapper = ( { children, disableAnimations, initialStyle, currentStyle, ...props } ) => {\n\tif ( disableAnimations ) {\n\t\treturn <div style={ currentStyle } { ...props }>{ children }</div>;\n\t}\n\n\treturn (\n\t\t<motion.div animate={ currentStyle } initial={ initialStyle } { ...props }>\n\t\t\t{ children }\n\t\t</motion.div>\n\t);\n};\n\n/**\n * This is a copy of packages/edit-post/src/components/visual-editor/index.js\n *\n * The original is not exported, and contains code for post titles\n *\n * @param {Object} args\n * @param args.styles\n */\nconst VisualEditor = ( { styles } ) => {\n\tconst themeSupportsLayout = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().supportsLayout;\n\t}, [] );\n\tconst { canvasStyles, deviceType, disableCanvasAnimations, isIframePreview } = useSelect( ( select ) => {\n\t\tconst { getCanvasStyles, getPreviewDeviceType, getEditorSettings, isIframePreview } =\n\t\t\tselect( 'isolated/editor' );\n\n\t\treturn {\n\t\t\tcanvasStyles: getCanvasStyles(),\n\t\t\tdeviceType: getPreviewDeviceType(),\n\t\t\tdisableCanvasAnimations: getEditorSettings().disableCanvasAnimations,\n\t\t\tisIframePreview: isIframePreview(),\n\t\t};\n\t} );\n\tconst resizedCanvasStyles = useResizeCanvas( deviceType, false );\n\tconst defaultLayout = useSetting( 'layout' );\n\tconst previewMode = 'is-' + deviceType.toLowerCase() + '-preview';\n\n\tconst desktopCanvasStyles = {\n\t\t// We intentionally omit a 100% height here. The container is a flex item, so the 100% height is granted by default.\n\t\t// If a percentage height is present, older browsers such as Safari 13 apply that, but do so incorrectly as the inheritance is buggy.\n\t\twidth: '100%',\n\t\tmargin: 0,\n\t\tdisplay: 'flex',\n\t\tflexFlow: 'column',\n\t\t// Default background color so that grey\n\t\t// .edit-post-editor-regions__content color doesn't show through.\n\t\tbackground: 'white',\n\t};\n\tlet animatedStyles = desktopCanvasStyles;\n\n\tif ( resizedCanvasStyles ) {\n\t\tanimatedStyles = resizedCanvasStyles;\n\t}\n\n\tif ( canvasStyles ) {\n\t\tanimatedStyles = {\n\t\t\t...animatedStyles,\n\t\t\t...canvasStyles,\n\t\t};\n\t}\n\n\tconst blockSelectionClearerRef = useBlockSelectionClearer();\n\tconst ref = useRef();\n\tconst contentRef = useMergeRefs( [\n\t\tref,\n\t\tuseClipboardHandler(),\n\t\tuseTypewriter(),\n\t\tuseBlockSelectionClearer(),\n\t\tuseTypingObserver(),\n\t] );\n\n\tconst layout = useMemo( () => {\n\t\tif ( themeSupportsLayout ) {\n\t\t\treturn defaultLayout;\n\t\t}\n\n\t\treturn undefined;\n\t}, [ themeSupportsLayout, defaultLayout ] );\n\n\t// If there is a layout definition, then we're on Gutenberg > v14, which requires us to pass the\n\t// 'constrained' type\n\tconst usedLayout = layout?.definitions ? { ...layout, type: 'constrained' } : layout;\n\n\treturn (\n\t\t<BlockTools __unstableContentRef={ ref } className=\"edit-post-visual-editor\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"edit-post-visual-editor__content-area\"\n\t\t\t\tanimate={ {\n\t\t\t\t\tpadding: '0',\n\t\t\t\t} }\n\t\t\t\tref={ blockSelectionClearerRef }\n\t\t\t>\n\t\t\t\t<PreviewWrapper\n\t\t\t\t\tclassName={ previewMode }\n\t\t\t\t\tcurrentStyle={ animatedStyles }\n\t\t\t\t\tdisableAnimations={ disableCanvasAnimations }\n\t\t\t\t\tinitialStyle={ desktopCanvasStyles }\n\t\t\t\t>\n\t\t\t\t\t<MaybeIframe\n\t\t\t\t\t\tshouldIframe={ isIframePreview }\n\t\t\t\t\t\tcontentRef={ contentRef }\n\t\t\t\t\t\tstyles={ styles }\n\t\t\t\t\t\tstyle={ {} }\n\t\t\t\t\t>\n\t\t\t\t\t\t<LayoutStyle\n\t\t\t\t\t\t\tselector=\".edit-post-visual-editor__post-title-wrapper, .block-editor-block-list__layout.is-root-container\"\n\t\t\t\t\t\t\tlayout={ usedLayout }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<EditorHeading.Slot mode=\"visual\" />\n\t\t\t\t\t\t<BlockList className={ undefined } __experimentalLayout={ layout } />\n\t\t\t\t\t\t<FooterSlot.Slot mode=\"visual\" />\n\t\t\t\t\t</MaybeIframe>\n\t\t\t\t</PreviewWrapper>\n\t\t\t</motion.div>\n\t\t</BlockTools>\n\t);\n};\n\nexport default VisualEditor;\n"],"mappings":"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"}