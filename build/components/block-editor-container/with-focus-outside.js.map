{"version":3,"file":"with-focus-outside.js","names":["_lodash","require","_element","_compose","createElement","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","result","NewTarget","constructor","Reflect","construct","_possibleConstructorReturn2","sham","Proxy","Boolean","prototype","valueOf","call","e","INPUT_BUTTON_TYPES","isFocusNormalizedButton","element","nodeName","includes","type","_default","createHigherOrderComponent","WrappedComponent","_Component","_inherits2","_class","_super","_this","_classCallCheck2","bindNode","bind","_assertThisInitialized2","cancelBlurCheck","queueBlurCheck","normalizeButtonFocus","_createClass2","value","componentWillUnmount","clearTimeout","blurCheckTimeout","node","event","_this2","persist","preventBlurCheck","setTimeout","document","hasFocus","preventDefault","handleFocusOutside","handleFocus","isInteractionEnd","render","onFocus","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onBlur","ref","props","Component","exports"],"sources":["../../../src/components/block-editor-container/with-focus-outside.js"],"sourcesContent":["// @ts-nocheck\n/**\n * External dependencies\n */\nimport { includes } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { createHigherOrderComponent } from '@wordpress/compose';\n\n/**\n * Input types which are classified as button types, for use in considering\n * whether element is a (focus-normalized) button.\n *\n * @type {string[]}\n */\nconst INPUT_BUTTON_TYPES = [ 'button', 'submit' ];\n\n/**\n * Returns true if the given element is a button element subject to focus\n * normalization, or false otherwise.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n *\n * @param {Element} element Element to test.\n *\n * @return {boolean} Whether element is a button.\n */\nfunction isFocusNormalizedButton( element ) {\n\tswitch ( element.nodeName ) {\n\t\tcase 'A':\n\t\tcase 'BUTTON':\n\t\t\treturn true;\n\n\t\tcase 'INPUT':\n\t\t\treturn includes( INPUT_BUTTON_TYPES, element.type );\n\t}\n\n\treturn false;\n}\n\nexport default createHigherOrderComponent( ( WrappedComponent ) => {\n\treturn class extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\n\t\t\tthis.bindNode = this.bindNode.bind( this );\n\t\t\tthis.cancelBlurCheck = this.cancelBlurCheck.bind( this );\n\t\t\tthis.queueBlurCheck = this.queueBlurCheck.bind( this );\n\t\t\tthis.normalizeButtonFocus = this.normalizeButtonFocus.bind( this );\n\t\t}\n\n\t\tcomponentWillUnmount() {\n\t\t\tclearTimeout( this.blurCheckTimeout );\n\t\t}\n\n\t\tbindNode( node ) {\n\t\t\tif ( node ) {\n\t\t\t\tthis.node = node;\n\t\t\t} else {\n\t\t\t\tdelete this.node;\n\t\t\t\tthis.cancelBlurCheck();\n\t\t\t}\n\t\t}\n\n\t\tqueueBlurCheck( event ) {\n\t\t\t// React does not allow using an event reference asynchronously\n\t\t\t// due to recycling behavior, except when explicitly persisted.\n\t\t\tevent.persist();\n\n\t\t\t// Skip blur check if clicking button. See `normalizeButtonFocus`.\n\t\t\tif ( this.preventBlurCheck ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.blurCheckTimeout = setTimeout( () => {\n\t\t\t\t// If document is not focused then focus should remain\n\t\t\t\t// inside the wrapped component and therefore we cancel\n\t\t\t\t// this blur event thereby leaving focus in place.\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Document/hasFocus.\n\t\t\t\tif ( ! document.hasFocus() ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( 'function' === typeof this.node.handleFocusOutside ) {\n\t\t\t\t\tthis.node.handleFocusOutside( event );\n\t\t\t\t}\n\t\t\t}, 0 );\n\t\t}\n\n\t\tcancelBlurCheck() {\n\t\t\tclearTimeout( this.blurCheckTimeout );\n\t\t\tif ( typeof this.node !== 'undefined' && 'function' === typeof this.node.handleFocus ) {\n\t\t\t\tthis.node.handleFocus( event );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handles a mousedown or mouseup event to respectively assign and\n\t\t * unassign a flag for preventing blur check on button elements. Some\n\t\t * browsers, namely Firefox and Safari, do not emit a focus event on\n\t\t * button elements when clicked, while others do. The logic here\n\t\t * intends to normalize this as treating click on buttons as focus.\n\t\t *\n\t\t * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t *\n\t\t * @param {MouseEvent} event Event for mousedown or mouseup.\n\t\t */\n\t\tnormalizeButtonFocus( event ) {\n\t\t\tconst { type, target } = event;\n\n\t\t\tconst isInteractionEnd = includes( [ 'mouseup', 'touchend' ], type );\n\n\t\t\tif ( isInteractionEnd ) {\n\t\t\t\tthis.preventBlurCheck = false;\n\t\t\t} else if ( isFocusNormalizedButton( target ) ) {\n\t\t\t\tthis.preventBlurCheck = true;\n\t\t\t}\n\t\t}\n\n\t\trender() {\n\t\t\t// Disable reason: See `normalizeButtonFocus` for browser-specific\n\t\t\t// focus event normalization.\n\n\t\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tonFocus={ this.cancelBlurCheck }\n\t\t\t\t\tonMouseDown={ this.normalizeButtonFocus }\n\t\t\t\t\tonMouseUp={ this.normalizeButtonFocus }\n\t\t\t\t\tonTouchStart={ this.normalizeButtonFocus }\n\t\t\t\t\tonTouchEnd={ this.normalizeButtonFocus }\n\t\t\t\t\tonBlur={ this.queueBlurCheck }\n\t\t\t\t>\n\t\t\t\t\t<WrappedComponent ref={ this.bindNode } { ...this.props } />\n\t\t\t\t</div>\n\t\t\t);\n\t\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t\t}\n\t};\n}, 'withFocusOutside' );\n"],"mappings":"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"}