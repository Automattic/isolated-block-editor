{"version":3,"file":"with-focus-outside.js","names":["INPUT_BUTTON_TYPES","isFocusNormalizedButton","element","nodeName","includes","type","createHigherOrderComponent","WrappedComponent","arguments","bindNode","bind","cancelBlurCheck","queueBlurCheck","normalizeButtonFocus","clearTimeout","blurCheckTimeout","node","event","persist","preventBlurCheck","setTimeout","document","hasFocus","preventDefault","handleFocusOutside","handleFocus","target","isInteractionEnd","props","Component"],"sources":["../../../src/components/block-editor-container/with-focus-outside.js"],"sourcesContent":["// @ts-nocheck\n/**\n * External dependencies\n */\nimport { includes } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { createHigherOrderComponent } from '@wordpress/compose';\n\n/**\n * Input types which are classified as button types, for use in considering\n * whether element is a (focus-normalized) button.\n *\n * @type {string[]}\n */\nconst INPUT_BUTTON_TYPES = [ 'button', 'submit' ];\n\n/**\n * Returns true if the given element is a button element subject to focus\n * normalization, or false otherwise.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n *\n * @param {Element} element Element to test.\n *\n * @return {boolean} Whether element is a button.\n */\nfunction isFocusNormalizedButton( element ) {\n\tswitch ( element.nodeName ) {\n\t\tcase 'A':\n\t\tcase 'BUTTON':\n\t\t\treturn true;\n\n\t\tcase 'INPUT':\n\t\t\treturn includes( INPUT_BUTTON_TYPES, element.type );\n\t}\n\n\treturn false;\n}\n\nexport default createHigherOrderComponent( ( WrappedComponent ) => {\n\treturn class extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\n\t\t\tthis.bindNode = this.bindNode.bind( this );\n\t\t\tthis.cancelBlurCheck = this.cancelBlurCheck.bind( this );\n\t\t\tthis.queueBlurCheck = this.queueBlurCheck.bind( this );\n\t\t\tthis.normalizeButtonFocus = this.normalizeButtonFocus.bind( this );\n\t\t}\n\n\t\tcomponentWillUnmount() {\n\t\t\tclearTimeout( this.blurCheckTimeout );\n\t\t}\n\n\t\tbindNode( node ) {\n\t\t\tif ( node ) {\n\t\t\t\tthis.node = node;\n\t\t\t} else {\n\t\t\t\tdelete this.node;\n\t\t\t\tthis.cancelBlurCheck();\n\t\t\t}\n\t\t}\n\n\t\tqueueBlurCheck( event ) {\n\t\t\t// React does not allow using an event reference asynchronously\n\t\t\t// due to recycling behavior, except when explicitly persisted.\n\t\t\tevent.persist();\n\n\t\t\t// Skip blur check if clicking button. See `normalizeButtonFocus`.\n\t\t\tif ( this.preventBlurCheck ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.blurCheckTimeout = setTimeout( () => {\n\t\t\t\t// If document is not focused then focus should remain\n\t\t\t\t// inside the wrapped component and therefore we cancel\n\t\t\t\t// this blur event thereby leaving focus in place.\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Document/hasFocus.\n\t\t\t\tif ( ! document.hasFocus() ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( 'function' === typeof this.node.handleFocusOutside ) {\n\t\t\t\t\tthis.node.handleFocusOutside( event );\n\t\t\t\t}\n\t\t\t}, 0 );\n\t\t}\n\n\t\tcancelBlurCheck() {\n\t\t\tclearTimeout( this.blurCheckTimeout );\n\t\t\tif ( typeof this.node !== 'undefined' && 'function' === typeof this.node.handleFocus ) {\n\t\t\t\tthis.node.handleFocus( event );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handles a mousedown or mouseup event to respectively assign and\n\t\t * unassign a flag for preventing blur check on button elements. Some\n\t\t * browsers, namely Firefox and Safari, do not emit a focus event on\n\t\t * button elements when clicked, while others do. The logic here\n\t\t * intends to normalize this as treating click on buttons as focus.\n\t\t *\n\t\t * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t *\n\t\t * @param {MouseEvent} event Event for mousedown or mouseup.\n\t\t */\n\t\tnormalizeButtonFocus( event ) {\n\t\t\tconst { type, target } = event;\n\n\t\t\tconst isInteractionEnd = includes( [ 'mouseup', 'touchend' ], type );\n\n\t\t\tif ( isInteractionEnd ) {\n\t\t\t\tthis.preventBlurCheck = false;\n\t\t\t} else if ( isFocusNormalizedButton( target ) ) {\n\t\t\t\tthis.preventBlurCheck = true;\n\t\t\t}\n\t\t}\n\n\t\trender() {\n\t\t\t// Disable reason: See `normalizeButtonFocus` for browser-specific\n\t\t\t// focus event normalization.\n\n\t\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tonFocus={ this.cancelBlurCheck }\n\t\t\t\t\tonMouseDown={ this.normalizeButtonFocus }\n\t\t\t\t\tonMouseUp={ this.normalizeButtonFocus }\n\t\t\t\t\tonTouchStart={ this.normalizeButtonFocus }\n\t\t\t\t\tonTouchEnd={ this.normalizeButtonFocus }\n\t\t\t\t\tonBlur={ this.queueBlurCheck }\n\t\t\t\t>\n\t\t\t\t\t<WrappedComponent ref={ this.bindNode } { ...this.props } />\n\t\t\t\t</div>\n\t\t\t);\n\t\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t\t}\n\t};\n}, 'withFocusOutside' );\n"],"mappings":"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"}