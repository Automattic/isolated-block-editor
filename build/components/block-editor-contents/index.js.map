{"version":3,"file":"index.js","names":["getInitialContent","settings","loader","contentLoader","isPromise","Promise","resolve","parse","rawHandler","then","content","getInitialEditorContent","iso","patterns","currentPattern","editor","template","BlockEditorContents","props","blocks","onInput","onChange","selection","isEditing","editorMode","children","renderMoreMenu","onLoad","useEffect","loadData","initialContent","length","isInitialContent","compose","withSelect","select","ownProps","getBlocks","getEditorSelection","getEditorMode","withDispatch","dispatch","updateBlocksWithUndo","updateBlocksWithoutUndo","args"],"sources":["../../../src/components/block-editor-contents/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport isPromise from 'is-promise';\n\n/**\n * WordPress dependencies\n */\nimport { Popover } from '@wordpress/components';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { useEffect } from '@wordpress/element';\nimport { parse, rawHandler } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { BlockEditorProvider } from '@wordpress/block-editor';\nimport BlockEditor from '../block-editor';\nimport getInitialEditorContent from './editor-content';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnLoad} OnLoad */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Get editor selection\n *\n * @callback OnSelection\n */\n\n/**\n * Update callback\n *\n * @callback OnUpdate\n * @param {object[]} blocks - Editor content to save\n * @param settings\n * @param [loader]\n * @param {Object} [options]\n */\nasync function getInitialContent( settings, loader ) {\n\tconst contentLoader = isPromise( loader )\n\t\t? loader\n\t\t: new Promise( ( resolve ) => {\n\t\t\t\tresolve( loader ? loader( parse, rawHandler ) : [] );\n\t\t  } );\n\n\treturn contentLoader.then( ( content ) => {\n\t\treturn getInitialEditorContent(\n\t\t\tsettings.iso.patterns,\n\t\t\tsettings.iso.currentPattern,\n\t\t\tsettings.editor.template,\n\t\t\tcontent\n\t\t);\n\t} );\n}\n\n/**\n * The editor itself, including toolbar\n *\n * @param {Object} props - Component props\n * @param {object[]} props.blocks\n * @param {OnUpdate} props.onInput - Callback to update blocks\n * @param {OnUpdate} props.onChange - Callback to update blocks\n * @param {boolean} props.isEditing - Are we editing in this editor?\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {Object} props.children - Child components\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n * @param {OnSelection} props.selection\n * @param {OnLoad} props.onLoad - Load initial blocks\n */\n\nfunction BlockEditorContents( props ) {\n\tconst { blocks, onInput, onChange, selection, isEditing, editorMode } = props;\n\tconst { children, settings, renderMoreMenu, onLoad } = props;\n\n\t// Set initial content, if we have any, but only if there is no existing data in the editor (from elsewhere)\n\tuseEffect( () => {\n\t\tconst loadData = async () => {\n\t\t\tconst initialContent = await getInitialContent( settings, onLoad );\n\n\t\t\tif ( initialContent.length > 0 && ( ! blocks || blocks.length === 0 ) ) {\n\t\t\t\tonInput( initialContent, { isInitialContent: true } );\n\t\t\t}\n\t\t};\n\n\t\tloadData();\n\t}, [] );\n\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tvalue={ blocks || [] }\n\t\t\tonInput={ onInput }\n\t\t\tonChange={ onChange }\n\t\t\tuseSubRegistry={ false }\n\t\t\tselection={ selection }\n\t\t\tsettings={ settings.editor }\n\t\t>\n\t\t\t<BlockEditor\n\t\t\t\tisEditing={ isEditing }\n\t\t\t\teditorMode={ editorMode }\n\t\t\t\tsettings={ settings }\n\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</BlockEditor>\n\n\t\t\t<Popover.Slot />\n\t\t</BlockEditorProvider>\n\t);\n}\n\n// @ts-ignore\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getBlocks, getEditorSelection, getEditorMode, isEditing } = select( 'isolated/editor' );\n\t\treturn {\n\t\t\tblocks: ownProps.blocks ?? getBlocks(),\n\t\t\tselection: getEditorSelection(),\n\t\t\tisEditing: isEditing(),\n\t\t\teditorMode: getEditorMode(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst { updateBlocksWithUndo, updateBlocksWithoutUndo } = dispatch( 'isolated/editor' );\n\t\tconst { onInput, onChange } = ownProps;\n\n\t\treturn {\n\t\t\tonChange: ( ...args ) => {\n\t\t\t\tonChange?.( ...args );\n\t\t\t\tupdateBlocksWithUndo( ...args );\n\t\t\t},\n\t\t\tonInput: ( ...args ) => {\n\t\t\t\tonInput?.( ...args );\n\t\t\t\tupdateBlocksWithoutUndo( ...args );\n\t\t\t},\n\t\t};\n\t} ),\n] )( BlockEditorContents );\n"],"mappings":"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"}