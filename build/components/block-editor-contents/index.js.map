{"version":3,"file":"index.js","names":["getInitialContent","settings","loader","contentLoader","isPromise","Promise","resolve","parse","rawHandler","then","content","getInitialEditorContent","iso","patterns","currentPattern","editor","template","BlockEditorContents","props","blocks","onInput","onChange","selection","isEditing","editorMode","children","renderMoreMenu","onLoad","useEffect","loadData","initialContent","length","isInitialContent","compose","withSelect","select","ownProps","getBlocks","getEditorSelection","getEditorMode","withDispatch","dispatch","updateBlocksWithUndo","updateBlocksWithoutUndo","args"],"sources":["../../../src/components/block-editor-contents/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport isPromise from 'is-promise';\n\n/**\n * WordPress dependencies\n */\nimport { Popover } from '@wordpress/components';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { useEffect } from '@wordpress/element';\nimport { parse, rawHandler } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { BlockEditorProvider } from '@wordpress/block-editor';\nimport BlockEditor from '../block-editor';\nimport getInitialEditorContent from './editor-content';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnLoad} OnLoad */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Get editor selection\n *\n * @callback OnSelection\n */\n\n/**\n * Update callback\n *\n * @callback OnUpdate\n * @param {object[]} blocks - Editor content to save\n * @param settings\n * @param [loader]\n * @param {Object} [options]\n */\nasync function getInitialContent( settings, loader ) {\n\tconst contentLoader = isPromise( loader )\n\t\t? loader\n\t\t: new Promise( ( resolve ) => {\n\t\t\t\tresolve( loader ? loader( parse, rawHandler ) : [] );\n\t\t  } );\n\n\treturn contentLoader.then( ( content ) => {\n\t\treturn getInitialEditorContent(\n\t\t\tsettings.iso.patterns,\n\t\t\tsettings.iso.currentPattern,\n\t\t\tsettings.editor.template,\n\t\t\tcontent\n\t\t);\n\t} );\n}\n\n/**\n * The editor itself, including toolbar\n *\n * @param {Object} props - Component props\n * @param {object[]} props.blocks\n * @param {OnUpdate} props.onInput - Callback to update blocks\n * @param {OnUpdate} props.onChange - Callback to update blocks\n * @param {boolean} props.isEditing - Are we editing in this editor?\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {Object} props.children - Child components\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n * @param {OnSelection} props.selection\n * @param {OnLoad} props.onLoad - Load initial blocks\n */\n\nfunction BlockEditorContents( props ) {\n\tconst { blocks, onInput, onChange, selection, isEditing, editorMode } = props;\n\tconst { children, settings, renderMoreMenu, onLoad } = props;\n\n\t// Set initial content, if we have any, but only if there is no existing data in the editor (from elsewhere)\n\tuseEffect( () => {\n\t\tconst loadData = async () => {\n\t\t\tconst initialContent = await getInitialContent( settings, onLoad );\n\n\t\t\tif ( initialContent.length > 0 && ( ! blocks || blocks.length === 0 ) ) {\n\t\t\t\tonInput( initialContent, { isInitialContent: true } );\n\t\t\t}\n\t\t};\n\n\t\tloadData();\n\t}, [] );\n\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tvalue={ blocks || [] }\n\t\t\tonInput={ onInput }\n\t\t\tonChange={ onChange }\n\t\t\tuseSubRegistry={ false }\n\t\t\tselection={ selection }\n\t\t\tsettings={ settings.editor }\n\t\t>\n\t\t\t<BlockEditor\n\t\t\t\tisEditing={ isEditing }\n\t\t\t\teditorMode={ editorMode }\n\t\t\t\tsettings={ settings }\n\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</BlockEditor>\n\n\t\t\t<Popover.Slot />\n\t\t</BlockEditorProvider>\n\t);\n}\n\n// @ts-ignore\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getBlocks, getEditorSelection, getEditorMode, isEditing } = select( 'isolated/editor' );\n\t\treturn {\n\t\t\tblocks: ownProps.blocks ?? getBlocks(),\n\t\t\tselection: getEditorSelection(),\n\t\t\tisEditing: isEditing(),\n\t\t\teditorMode: getEditorMode(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst { updateBlocksWithUndo, updateBlocksWithoutUndo } = dispatch( 'isolated/editor' );\n\t\tconst { onInput, onChange } = ownProps;\n\n\t\treturn {\n\t\t\tonChange: ( ...args ) => {\n\t\t\t\tonChange?.( ...args );\n\t\t\t\tupdateBlocksWithUndo( ...args );\n\t\t\t},\n\t\t\tonInput: ( ...args ) => {\n\t\t\t\tonInput?.( ...args );\n\t\t\t\tupdateBlocksWithoutUndo( ...args );\n\t\t\t},\n\t\t};\n\t} ),\n] )( BlockEditorContents );\n"],"mappings":"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"}