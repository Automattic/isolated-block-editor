{"version":3,"file":"index.js","names":["_element","require","_data","_compose","_blockEditor","_editor","_store","_interopRequireDefault","_reusableStore","_defaultSettings","_coreEditor","_interfaceStore","_excluded","createElement","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","registries","STORE_NAME","withRegistryProvider","createHigherOrderComponent","WrappedComponent","withRegistry","props","registry","settings","additionalProps","_objectWithoutProperties2","defaultSettings","applyDefaultSettings","_ref","iso","persistenceKey","preferencesKey","defaultPreferences","_ref$customStores","customStores","_useState","useState","_useState2","_slicedToArray2","subRegistry","setSubRegistry","useEffect","newRegistry","createRegistry","reusableStore","interfaceStore","use","plugins","persistence","store","registerStore","storeConfig","blockEditorStore","blockEditorStoreConfig","persist","editorStore","coreEditorStoreConfig","selectors","decoratedEditor","select","map","name","config","cleanup","item","RegistryProvider","value","_extends2","_default","exports"],"sources":["../../../src/components/with-registry-provider/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useEffect } from '@wordpress/element';\nimport { withRegistry, createRegistry, RegistryProvider, plugins } from '@wordpress/data';\nimport { createHigherOrderComponent } from '@wordpress/compose';\nimport { storeConfig as blockEditorStoreConfig } from '@wordpress/block-editor';\nimport { storeConfig as coreEditorStoreConfig } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport storeConfig from '../../store';\nimport reusableStore from './reusable-store';\nimport applyDefaultSettings from '../default-settings';\nimport decoratedEditor from '../../store/core-editor';\nimport interfaceStore from './interface-store';\n\n// Keep track of the registries we create so we can release them after the editor instance is removed\nlet registries = [];\n\nconst STORE_NAME = 'isolated/editor';\n\n/**\n * This is the core of having a multi-editor Gutenberg experience.\n *\n * We create a sub registry that contains copies of `core/block-editor`, `core/editor`, and STORE_NAME. These are specific to the editor instance and\n * provide the content for each editor, as well as overriding some core functions\n *\n * The key `persistenceKey` from the settings is used as the `localStorage` key to save Gutenberg preferences\n */\nconst withRegistryProvider = createHigherOrderComponent(\n\t/**\n\t *\n\t * @param {import(\"react\").FC } WrappedComponent\n\t */\n\t( WrappedComponent ) =>\n\t\twithRegistry( ( props ) => {\n\t\t\tconst { registry, settings, ...additionalProps } = props;\n\t\t\tconst defaultSettings = applyDefaultSettings( settings );\n\t\t\tconst { persistenceKey, preferencesKey, defaultPreferences, customStores = [] } = defaultSettings.iso || {};\n\t\t\tconst [ subRegistry, setSubRegistry ] = useState( null );\n\n\t\t\tuseEffect( () => {\n\t\t\t\t// Create a new registry for this editor. We have the STORE_NAME for storing blocks and other data\n\t\t\t\t// and a duplicate of `core/block-editor` for storing block selections\n\t\t\t\tconst newRegistry = createRegistry(\n\t\t\t\t\t{\n\t\t\t\t\t\t'core/reusable-blocks': reusableStore,\n\t\t\t\t\t\t'core/interface': interfaceStore,\n\t\t\t\t\t},\n\t\t\t\t\tregistry\n\t\t\t\t);\n\n\t\t\t\t// Enable the persistence plugin so we use settings in `localStorage`\n\t\t\t\tif ( persistenceKey ) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tnewRegistry.use( plugins.persistence, {\n\t\t\t\t\t\tpersistenceKey,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Create our custom store\n\t\t\t\tconst store = newRegistry.registerStore(\n\t\t\t\t\tSTORE_NAME,\n\t\t\t\t\tstoreConfig( preferencesKey, defaultPreferences )\n\t\t\t\t);\n\n\t\t\t\t// Create the core/block-editor store separatley as we need the persistence plugin to be active\n\t\t\t\tconst blockEditorStore = newRegistry.registerStore( 'core/block-editor', {\n\t\t\t\t\t...blockEditorStoreConfig,\n\t\t\t\t\tpersist: [ 'preferences' ],\n\t\t\t\t} );\n\n\t\t\t\t// Duplicate the core/editor store so we can decorate it\n\t\t\t\tconst editorStore = newRegistry.registerStore( 'core/editor', {\n\t\t\t\t\t...coreEditorStoreConfig,\n\t\t\t\t\tselectors: {\n\t\t\t\t\t\t...coreEditorStoreConfig.selectors,\n\t\t\t\t\t\t...decoratedEditor( coreEditorStoreConfig.selectors, newRegistry.select ),\n\t\t\t\t\t},\n\t\t\t\t\tpersist: [ 'preferences' ],\n\t\t\t\t} );\n\n\t\t\t\t// Create any custom stores inside our registry\n\t\t\t\tcustomStores.map( ( store ) => {\n\t\t\t\t\tregistries.push( newRegistry.registerStore( store.name, store.config ) );\n\t\t\t\t} );\n\n\t\t\t\tregistries.push( store );\n\t\t\t\tregistries.push( blockEditorStore );\n\t\t\t\tregistries.push( editorStore );\n\n\t\t\t\t// @ts-ignore\n\t\t\t\tsetSubRegistry( newRegistry );\n\n\t\t\t\treturn function cleanup() {\n\t\t\t\t\tregistries = registries.filter( ( item ) => item !== store );\n\t\t\t\t};\n\t\t\t}, [ registry ] );\n\n\t\t\tif ( ! subRegistry ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<RegistryProvider value={ subRegistry }>\n\t\t\t\t\t{ /* @ts-ignore */ }\n\t\t\t\t\t<WrappedComponent { ...additionalProps } settings={ defaultSettings } />\n\t\t\t\t</RegistryProvider>\n\t\t\t);\n\t\t} ),\n\t'withRegistryProvider'\n);\n\nexport default withRegistryProvider;\n"],"mappings":";;;;;;;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AACA,IAAAG,YAAA,GAAAH,OAAA;AACA,IAAAI,OAAA,GAAAJ,OAAA;AAKA,IAAAK,MAAA,GAAAC,sBAAA,CAAAN,OAAA;AACA,IAAAO,cAAA,GAAAD,sBAAA,CAAAN,OAAA;AACA,IAAAQ,gBAAA,GAAAF,sBAAA,CAAAN,OAAA;AACA,IAAAS,WAAA,GAAAH,sBAAA,CAAAN,OAAA;AACA,IAAAU,eAAA,GAAAJ,sBAAA,CAAAN,OAAA;AAA+C,IAAAW,SAAA;AAhB/C;AACA;AACA;AAOA;AACA;AACA;AAFA,SAAAC,aAAA;AAAA,SAAAC,QAAAC,MAAA,EAAAC,cAAA,QAAAC,IAAA,GAAAC,MAAA,CAAAD,IAAA,CAAAF,MAAA,OAAAG,MAAA,CAAAC,qBAAA,QAAAC,OAAA,GAAAF,MAAA,CAAAC,qBAAA,CAAAJ,MAAA,GAAAC,cAAA,KAAAI,OAAA,GAAAA,OAAA,CAAAC,MAAA,WAAAC,GAAA,WAAAJ,MAAA,CAAAK,wBAAA,CAAAR,MAAA,EAAAO,GAAA,EAAAE,UAAA,OAAAP,IAAA,CAAAQ,IAAA,CAAAC,KAAA,CAAAT,IAAA,EAAAG,OAAA,YAAAH,IAAA;AAAA,SAAAU,cAAAC,MAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAF,CAAA,UAAAG,MAAA,WAAAF,SAAA,CAAAD,CAAA,IAAAC,SAAA,CAAAD,CAAA,QAAAA,CAAA,OAAAf,OAAA,CAAAI,MAAA,CAAAc,MAAA,OAAAC,OAAA,WAAAC,GAAA,QAAAC,gBAAA,aAAAP,MAAA,EAAAM,GAAA,EAAAF,MAAA,CAAAE,GAAA,SAAAhB,MAAA,CAAAkB,yBAAA,GAAAlB,MAAA,CAAAmB,gBAAA,CAAAT,MAAA,EAAAV,MAAA,CAAAkB,yBAAA,CAAAJ,MAAA,KAAAlB,OAAA,CAAAI,MAAA,CAAAc,MAAA,GAAAC,OAAA,WAAAC,GAAA,IAAAhB,MAAA,CAAAoB,cAAA,CAAAV,MAAA,EAAAM,GAAA,EAAAhB,MAAA,CAAAK,wBAAA,CAAAS,MAAA,EAAAE,GAAA,iBAAAN,MAAA;AASA;AACA,IAAIW,UAAU,GAAG,EAAE;AAEnB,IAAMC,UAAU,GAAG,iBAAiB;;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMC,oBAAoB,GAAG,IAAAC,mCAA0B;AACtD;AACD;AACA;AACA;AACC,UAAEC,gBAAgB;EAAA,OACjB,IAAAC,kBAAY,EAAE,UAAEC,KAAK,EAAM;IAC1B,IAAQC,QAAQ,GAAmCD,KAAK,CAAhDC,QAAQ;MAAEC,QAAQ,GAAyBF,KAAK,CAAtCE,QAAQ;MAAKC,eAAe,OAAAC,yBAAA,aAAKJ,KAAK,EAAAjC,SAAA;IACxD,IAAMsC,eAAe,GAAG,IAAAC,2BAAoB,EAAEJ,QAAQ,CAAE;IACxD,IAAAK,IAAA,GAAkFF,eAAe,CAACG,GAAG,IAAI,CAAC,CAAC;MAAnGC,cAAc,GAAAF,IAAA,CAAdE,cAAc;MAAEC,cAAc,GAAAH,IAAA,CAAdG,cAAc;MAAEC,kBAAkB,GAAAJ,IAAA,CAAlBI,kBAAkB;MAAAC,iBAAA,GAAAL,IAAA,CAAEM,YAAY;MAAZA,YAAY,GAAAD,iBAAA,cAAG,EAAE,GAAAA,iBAAA;IAC7E,IAAAE,SAAA,GAAwC,IAAAC,iBAAQ,EAAE,IAAI,CAAE;MAAAC,UAAA,OAAAC,eAAA,aAAAH,SAAA;MAAhDI,WAAW,GAAAF,UAAA;MAAEG,cAAc,GAAAH,UAAA;IAEnC,IAAAI,kBAAS,EAAE,YAAM;MAChB;MACA;MACA,IAAMC,WAAW,GAAG,IAAAC,oBAAc,EACjC;QACC,sBAAsB,EAAEC,yBAAa;QACrC,gBAAgB,EAAEC;MACnB,CAAC,EACDvB,QAAQ,CACR;;MAED;MACA,IAAKQ,cAAc,EAAG;QACrB;QACAY,WAAW,CAACI,GAAG,CAAEC,aAAO,CAACC,WAAW,EAAE;UACrClB,cAAc,EAAdA;QACD,CAAC,CAAE;MACJ;;MAEA;MACA,IAAMmB,KAAK,GAAGP,WAAW,CAACQ,aAAa,CACtClC,UAAU,EACV,IAAAmC,iBAAW,EAAEpB,cAAc,EAAEC,kBAAkB,CAAE,CACjD;;MAED;MACA,IAAMoB,gBAAgB,GAAGV,WAAW,CAACQ,aAAa,CAAE,mBAAmB,EAAA/C,aAAA,CAAAA,aAAA,KACnEkD,wBAAsB;QACzBC,OAAO,EAAE,CAAE,aAAa;MAAE,GACxB;;MAEH;MACA,IAAMC,WAAW,GAAGb,WAAW,CAACQ,aAAa,CAAE,aAAa,EAAA/C,aAAA,CAAAA,aAAA,KACxDqD,mBAAqB;QACxBC,SAAS,EAAAtD,aAAA,CAAAA,aAAA,KACLqD,mBAAqB,CAACC,SAAS,GAC/B,IAAAC,sBAAe,EAAEF,mBAAqB,CAACC,SAAS,EAAEf,WAAW,CAACiB,MAAM,CAAE,CACzE;QACDL,OAAO,EAAE,CAAE,aAAa;MAAE,GACxB;;MAEH;MACApB,YAAY,CAAC0B,GAAG,CAAE,UAAEX,KAAK,EAAM;QAC9BlC,UAAU,CAACd,IAAI,CAAEyC,WAAW,CAACQ,aAAa,CAAED,KAAK,CAACY,IAAI,EAAEZ,KAAK,CAACa,MAAM,CAAE,CAAE;MACzE,CAAC,CAAE;MAEH/C,UAAU,CAACd,IAAI,CAAEgD,KAAK,CAAE;MACxBlC,UAAU,CAACd,IAAI,CAAEmD,gBAAgB,CAAE;MACnCrC,UAAU,CAACd,IAAI,CAAEsD,WAAW,CAAE;;MAE9B;MACAf,cAAc,CAAEE,WAAW,CAAE;MAE7B,OAAO,SAASqB,OAAOA,CAAA,EAAG;QACzBhD,UAAU,GAAGA,UAAU,CAAClB,MAAM,CAAE,UAAEmE,IAAI;UAAA,OAAMA,IAAI,KAAKf,KAAK;QAAA,EAAE;MAC7D,CAAC;IACF,CAAC,EAAE,CAAE3B,QAAQ,CAAE,CAAE;IAEjB,IAAK,CAAEiB,WAAW,EAAG;MACpB,OAAO,IAAI;IACZ;IAEA,OACClD,aAAA,CAACX,KAAA,CAAAuF,gBAAgB;MAACC,KAAK,EAAG3B;IAAa,GAEtClD,aAAA,CAAC8B,gBAAgB,MAAAgD,SAAA,iBAAM3C,eAAe;MAAGD,QAAQ,EAAGG;IAAiB,GAAG,CACtD;EAErB,CAAC,CAAE;AAAA,GACJ,sBAAsB,CACtB;AAAC,IAAA0C,QAAA,GAEanD,oBAAoB;AAAAoD,OAAA,cAAAD,QAAA"}