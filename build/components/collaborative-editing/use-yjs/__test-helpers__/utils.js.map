{"version":3,"file":"utils.js","names":["_react","require","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","getTransports","count","peers","getAvailablePeers","excludeId","values","reduce","acc","p","user","id","concat","_toConsumableArray2","mockTransport","transport","_identity","undefined","connect","jest","fn","_ref","onReceiveMessage","setAvailablePeers","identity","Promise","resolve","isFirstInChannel","sendMessage","data","disconnect","Array","fill","map","pauseTyping","_x","_pauseTyping","_asyncToGenerator2","_regenerator","mark","_callee","screen","wrap","_callee$","_context","prev","next","getAllByRole","el","blur","waitFor","setTimeout","stop"],"sources":["../../../../../src/components/collaborative-editing/use-yjs/__test-helpers__/utils.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { waitFor } from '@testing-library/react';\n\n/**\n * Helper to generate mock transport modules for an isolated channel.\n *\n * @param {number} count - Number of transport modules to generate.\n * @return {Object[]} - Array of transport modules.\n */\nexport function getTransports( count ) {\n\tconst peers = {};\n\n\tconst getAvailablePeers = ( excludeId ) =>\n\t\tObject.values( peers ).reduce( ( acc, p ) => {\n\t\t\tif ( p.user.id === excludeId ) return acc;\n\t\t\treturn [ ...acc, p.user ];\n\t\t}, [] );\n\n\tconst mockTransport = () => {\n\t\tconst transport = {\n\t\t\t_identity: undefined,\n\t\t\tconnect: jest.fn( ( { onReceiveMessage, setAvailablePeers, user } ) => {\n\t\t\t\ttransport._identity = user.identity;\n\t\t\t\tpeers[ user.identity ] = { onReceiveMessage, setAvailablePeers, user: { ...user, id: user.identity } };\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tpeers[ identity ].setAvailablePeers( getAvailablePeers( identity ) );\n\t\t\t\t} );\n\t\t\t\treturn Promise.resolve( { isFirstInChannel: Object.keys( peers ).length === 1 } );\n\t\t\t} ),\n\t\t\tsendMessage: jest.fn( ( data ) => {\n\t\t\t\t// console.log( data.message.messageType, data.identity.substring( 0, 4 ) );\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tif ( identity !== data.identity ) {\n\t\t\t\t\t\tpeers[ identity ].onReceiveMessage( data );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} ),\n\t\t\tdisconnect: jest.fn( () => {\n\t\t\t\tdelete peers[ transport._identity ];\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tpeers[ identity ].setAvailablePeers( getAvailablePeers( identity ) );\n\t\t\t\t} );\n\t\t\t} ),\n\t\t};\n\n\t\treturn transport;\n\t};\n\n\treturn Array( count )\n\t\t.fill( null )\n\t\t.map( () => mockTransport() );\n}\n\n/**\n * Emulate a pause between typing events for Yjs to make a new undo stack item.\n *\n * Requires jest.useRealTimers().\n *\n * @param {import('@testing-library/dom').Screen} screen\n */\nexport async function pauseTyping( screen ) {\n\tscreen.getAllByRole( 'document' ).forEach( ( el ) => el.blur() );\n\tawait waitFor( () => new Promise( ( resolve ) => setTimeout( resolve, 550 ) ) );\n}\n"],"mappings":"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"}