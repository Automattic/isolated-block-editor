{"version":3,"file":"index.js","names":["CollaborativeEditingAvatars","peers","onAvatarClick","MAX_AVATAR_COUNT","shouldOverflow","length","actualAvatarCount","slice","map","peer","id","CollaborativeEditingAvatar","useState","isVisible","setIsVisible","name","borderColor","color","background","avatarUrl","charAt","CollaborativeEditingAvatarsOverflow","MAX_NAME_COUNT","NameList","sprintf","__","compose","withSelect","select","getCollabPeers","Object","keys","withDispatch","dispatch","selectBlock","start","clientId"],"sources":["../../../../../src/components/collaborative-editing/components/avatars/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Popover, VisuallyHidden } from '@wordpress/components';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { useState } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\n\n/**\n * @param {Object} props\n * @param {import(\"../..\").AvailablePeer[]} props.peers\n * @param {Function} props.onAvatarClick\n */\nexport function CollaborativeEditingAvatars( { peers, onAvatarClick } ) {\n\tconst MAX_AVATAR_COUNT = 4;\n\tconst shouldOverflow = peers.length > MAX_AVATAR_COUNT;\n\tconst actualAvatarCount = shouldOverflow ? MAX_AVATAR_COUNT - 1 : MAX_AVATAR_COUNT;\n\n\treturn (\n\t\t<div className=\"iso-editor-collab-avatars\">\n\t\t\t<VisuallyHidden>Currently editing:</VisuallyHidden>\n\n\t\t\t{ peers.slice( 0, actualAvatarCount ).map( ( peer ) => (\n\t\t\t\t<CollaborativeEditingAvatar key={ peer.id } peer={ peer } onAvatarClick={ onAvatarClick } />\n\t\t\t) ) }\n\n\t\t\t{ shouldOverflow && <CollaborativeEditingAvatarsOverflow peers={ peers?.slice( actualAvatarCount ) } /> }\n\t\t</div>\n\t);\n}\n\nexport function CollaborativeEditingAvatar( { peer, onAvatarClick } ) {\n\tconst [ isVisible, setIsVisible ] = useState( false );\n\n\treturn (\n\t\t<button\n\t\t\tclassName=\"iso-editor-collab-avatars__avatar-btn\"\n\t\t\taria-label={ peer.name }\n\t\t\tonMouseEnter={ () => setIsVisible( true ) }\n\t\t\tonMouseLeave={ () => setIsVisible( false ) }\n\t\t\tonClick={ () => onAvatarClick( peer ) }\n\t\t\tstyle={ {\n\t\t\t\tborderColor: peer.color,\n\t\t\t\tbackground: peer.color,\n\t\t\t} }\n\t\t>\n\t\t\t{ isVisible && (\n\t\t\t\t<Popover className=\"iso-editor-collab-avatars__popover\" animate={ false }>\n\t\t\t\t\t{ peer.name }\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t{ peer.avatarUrl ? (\n\t\t\t\t<img className=\"iso-editor-collab-avatars__image\" src={ peer.avatarUrl } alt=\"\" />\n\t\t\t) : (\n\t\t\t\t<span className=\"iso-editor-collab-avatars__name-initial\">{ peer.name.charAt( 0 ) }</span>\n\t\t\t) }\n\t\t</button>\n\t);\n}\n\nexport function CollaborativeEditingAvatarsOverflow( { peers } ) {\n\tconst MAX_NAME_COUNT = 20;\n\tconst [ isVisible, setIsVisible ] = useState( false );\n\n\tconst NameList = () => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ul className=\"iso-editor-collab-avatars__overflow-list\">\n\t\t\t\t\t{ peers.slice( 0, MAX_NAME_COUNT ).map( ( peer ) => (\n\t\t\t\t\t\t<li className=\"iso-editor-collab-avatars__overflow-list-item\" key={ peer.id }>\n\t\t\t\t\t\t\t{ peer.name }\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) ) }\n\t\t\t\t</ul>\n\t\t\t\t{ peers.length > MAX_NAME_COUNT && (\n\t\t\t\t\t<p className=\"iso-editor-collab-avatars__overflow-more\">\n\t\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t\t/* translators: %s: number of how many more users there are */\n\t\t\t\t\t\t\t__( 'and %s more' ),\n\t\t\t\t\t\t\tpeers.length - MAX_NAME_COUNT\n\t\t\t\t\t\t) }\n\t\t\t\t\t</p>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t};\n\n\treturn (\n\t\t<div className=\"iso-editor-collab-avatars__overflow\">\n\t\t\t{ isVisible && (\n\t\t\t\t<Popover className=\"iso-editor-collab-avatars__popover\" animate={ false }>\n\t\t\t\t\t<NameList />\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t<span\n\t\t\t\taria-hidden=\"true\"\n\t\t\t\tonMouseEnter={ () => setIsVisible( true ) }\n\t\t\t\tonMouseLeave={ () => setIsVisible( false ) }\n\t\t\t>\n\t\t\t\t{ `+${ peers.length }` }\n\t\t\t</span>\n\t\t\t<VisuallyHidden>\n\t\t\t\t<NameList />\n\t\t\t</VisuallyHidden>\n\t\t</div>\n\t);\n}\n\n// @ts-ignore\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst peers = select( 'isolated/editor' ).getCollabPeers();\n\n\t\treturn {\n\t\t\tpeers: Object.keys( peers ).map( ( id ) => {\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\t...peers[ id ],\n\t\t\t\t};\n\t\t\t} ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { selectBlock } = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tonAvatarClick( peer ) {\n\t\t\t\tif ( peer?.start?.clientId ) {\n\t\t\t\t\tselectBlock( peer.start.clientId );\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t} ),\n] )( CollaborativeEditingAvatars );\n"],"mappings":"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"}