{"version":3,"file":"reducer.js","names":["getPattern","patterns","currentPattern","find","item","name","DEFAULT_STATE","editorMode","isInserterOpened","isEditing","isListViewOpened","isReady","gutenbergTemplate","ignoredContent","deviceType","settings","preferencesKey","persistenceKey","blocks","allowBlocks","disallowBlocks","disallowEmbed","customStores","toolbar","inserter","toc","undo","inspector","navigation","documentInspector","selectorTool","sidebar","moreMenu","editor","fullscreen","preview","topToolbar","linkMenu","defaultPreferences","allowApi","getIgnoredContent","ignored","serialize","createBlock","className","found","push","parse","content","synchronizeBlocksWithTemplate","reducer","state","action","type","iso","template","pattern","isOpen","isInspectorOpened"],"sources":["../../../src/store/editor/reducer.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { serialize, parse, createBlock, synchronizeBlocksWithTemplate } from '@wordpress/blocks';\n\nconst getPattern = ( patterns, currentPattern ) =>\n\tpatterns && patterns.find( ( item ) => item.name === currentPattern );\n\n/** @typedef {import('../../index').IsoSettings} IsoSettings */\n\n/**\n * Pattern type.\n *\n * @typedef Pattern\n * @property {string} name - Name of the pattern.\n * @property {string} content - Content for the pattern.\n */\n\n/**\n * Editor mode\n *\n * @typedef {('visual'|'text')} EditorMode\n */\n\n/**\n * The editor state object\n *\n * @typedef EditorState\n * @property {EditorMode} editorMode - whether in visual or code editing mode.\n * @property {boolean} isInserterOpened - whether the inserter is open.\n * @property {boolean} isListViewOpened - whether the list view is open.\n * @property {Pattern[]} patterns - array of patterns.\n * @property {string|null} currentPattern - current pattern name.\n * @property {string[]} ignoredContent - content to ignore when saving.\n * @property {object|null} gutenbergTemplate - the Gutenberg template\n * @property {boolean} isEditing - is this editor being used?\n * @property {boolean} isReady - is the editor ready?\n * @property {IsoSettings} settings - editor settings\n * @property {string} deviceType - current device type\n */\n\n/** @type EditorState */\nconst DEFAULT_STATE = {\n\t// Editor state\n\teditorMode: 'visual',\n\tisInserterOpened: false,\n\tisEditing: false,\n\tisListViewOpened: false,\n\tisReady: false,\n\n\tpatterns: [],\n\tcurrentPattern: null,\n\tgutenbergTemplate: null,\n\n\tignoredContent: [],\n\tdeviceType: 'Desktop',\n\n\tsettings: {\n\t\tpreferencesKey: null,\n\t\tpersistenceKey: null,\n\t\tblocks: {\n\t\t\tallowBlocks: [],\n\t\t\tdisallowBlocks: [],\n\t\t},\n\t\tdisallowEmbed: [],\n\t\tcustomStores: [],\n\t\ttoolbar: {\n\t\t\tinserter: true,\n\t\t\ttoc: false,\n\t\t\tundo: true,\n\t\t\tinspector: true,\n\t\t\tnavigation: false,\n\t\t\tdocumentInspector: false,\n\t\t\tselectorTool: false,\n\t\t},\n\t\tsidebar: {\n\t\t\tinspector: false,\n\t\t\tinserter: false,\n\t\t},\n\t\tmoreMenu: {\n\t\t\teditor: false,\n\t\t\tfullscreen: false,\n\t\t\tpreview: false,\n\t\t\ttopToolbar: false,\n\t\t},\n\t\tlinkMenu: [],\n\t\tcurrentPattern: null,\n\t\tpatterns: [],\n\t\tdefaultPreferences: {},\n\t\tallowApi: false,\n\t},\n};\n\n/**\n * Ignored content are pieces of HTML that we don't need to save. This could be, for example, an empty pattern.\n *\n * @param {Pattern[]} patterns - Array of patterns.\n * @param {string} currentPattern - Selected pattern name.\n * @param {object|null} gutenbergTemplate - Gutenberg template.\n * @return {string[]} Array of ignored HTML strings.\n */\nfunction getIgnoredContent( patterns, currentPattern, gutenbergTemplate ) {\n\tconst ignored = [\n\t\tserialize( createBlock( 'core/paragraph' ) ),\n\t\tserialize( createBlock( 'core/paragraph', { className: '' } ) ),\n\t];\n\tconst found = getPattern( patterns, currentPattern );\n\n\t// If we're using a starter pattern then add the empty pattern to our ignored content list\n\tif ( found ) {\n\t\t// We parse and then serialize so it will better match the formatting from Gutenberg when saving content\n\t\tignored.push( serialize( parse( found.content ) ) );\n\t}\n\n\t// If we're using a Gutenberg template then add that to the ignored list\n\tif ( gutenbergTemplate ) {\n\t\tignored.push( serialize( synchronizeBlocksWithTemplate( [], gutenbergTemplate ) ) );\n\t}\n\n\treturn ignored;\n}\n\nconst reducer = ( state = DEFAULT_STATE, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'SETUP_EDITOR': {\n\t\t\tconst { currentPattern, patterns } = action.settings.iso;\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpatterns,\n\t\t\t\tcurrentPattern,\n\t\t\t\tignoredContent: getIgnoredContent( patterns, currentPattern, action.settings.editor.template ),\n\t\t\t\tgutenbergTemplate: action.settings.editor.template,\n\t\t\t\tsettings: {\n\t\t\t\t\t...state.settings,\n\t\t\t\t\t...action.settings.iso,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tcase 'SET_CURRENT_PATTERN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentPattern: action.pattern,\n\t\t\t\tignoredContent: getIgnoredContent( state.patterns, action.pattern, state.gutenbergTemplate ),\n\t\t\t};\n\n\t\tcase 'SET_EDITOR_MODE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\teditorMode: action.editorMode,\n\t\t\t};\n\n\t\tcase 'SET_INSERTER_OPEN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisInserterOpened: action.isOpen,\n\t\t\t\tisInspectorOpened: false,\n\t\t\t\tisListViewOpened: false,\n\t\t\t};\n\n\t\tcase 'SET_INSPECTOR_OPEN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisInspectorOpened: action.isOpen,\n\t\t\t\tisListViewOpened: false,\n\t\t\t};\n\n\t\tcase 'SET_LISTVIEW_OPEN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisInserterOpened: false,\n\t\t\t\tisInspectorOpened: false,\n\t\t\t\tisListViewOpened: action.isOpen,\n\t\t\t};\n\n\t\tcase 'SET_EDITING':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisEditing: action.isEditing,\n\t\t\t};\n\n\t\tcase 'SET_EDITOR_READY':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisReady: action.isReady,\n\t\t\t};\n\n\t\tcase 'SET_DEVICE_TYPE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdeviceType: action.deviceType,\n\t\t\t};\n\t}\n\n\treturn state;\n};\n\nexport default reducer;\n"],"mappings":"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"}