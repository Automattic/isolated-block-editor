{"version":3,"file":"reducer.js","names":["_blocks","require","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","getPattern","patterns","currentPattern","find","item","name","DEFAULT_STATE","editorMode","isInserterOpened","isEditing","isListViewOpened","isReady","gutenbergTemplate","ignoredContent","deviceType","canvasStyles","isIframePreview","settings","preferencesKey","persistenceKey","blocks","allowBlocks","disallowBlocks","disallowEmbed","customStores","toolbar","inserter","undo","inspector","navigation","documentInspector","selectorTool","sidebar","moreMenu","editor","fullscreen","preview","topToolbar","linkMenu","defaultPreferences","allowApi","disableCanvasAnimations","getIgnoredContent","ignored","serialize","createBlock","className","found","parse","content","synchronizeBlocksWithTemplate","reducer","state","undefined","action","type","_action$settings$iso","iso","template","pattern","isOpen","isInspectorOpened","_default","exports"],"sources":["../../../src/store/editor/reducer.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { serialize, parse, createBlock, synchronizeBlocksWithTemplate } from '@wordpress/blocks';\n\nconst getPattern = ( patterns, currentPattern ) =>\n\tpatterns && patterns.find( ( item ) => item.name === currentPattern );\n\n/** @typedef {import('../../index').IsoSettings} IsoSettings */\n\n/**\n * Pattern type.\n *\n * @typedef Pattern\n * @property {string} name - Name of the pattern.\n * @property {string} content - Content for the pattern.\n */\n\n/**\n * Editor mode\n *\n * @typedef {('visual'|'text')} EditorMode\n */\n\n/**\n * The editor state object\n *\n * @typedef EditorState\n * @property {EditorMode} editorMode - whether in visual or code editing mode.\n * @property {boolean} isInserterOpened - whether the inserter is open.\n * @property {boolean} isListViewOpened - whether the list view is open.\n * @property {Pattern[]} patterns - array of patterns.\n * @property {string|null} currentPattern - current pattern name.\n * @property {string[]} ignoredContent - content to ignore when saving.\n * @property {object|null} gutenbergTemplate - the Gutenberg template\n * @property {boolean} isEditing - is this editor being used?\n * @property {boolean} isReady - is the editor ready?\n * @property {IsoSettings} settings - editor settings\n * @property {string} deviceType - current device type\n * @property {Object} canvasStyles - editor canvas styles\n * @property {boolean} isIframePreview - whether the editor canvas is an iframe\n */\n\n/** @type EditorState */\nconst DEFAULT_STATE = {\n\t// Editor state\n\teditorMode: 'visual',\n\tisInserterOpened: false,\n\tisEditing: false,\n\tisListViewOpened: false,\n\tisReady: false,\n\n\tpatterns: [],\n\tcurrentPattern: null,\n\tgutenbergTemplate: null,\n\n\tignoredContent: [],\n\tdeviceType: 'Desktop',\n\tcanvasStyles: null,\n\tisIframePreview: false,\n\n\tsettings: {\n\t\tpreferencesKey: null,\n\t\tpersistenceKey: null,\n\t\tblocks: {\n\t\t\tallowBlocks: [],\n\t\t\tdisallowBlocks: [],\n\t\t},\n\t\tdisallowEmbed: [],\n\t\tcustomStores: [],\n\t\ttoolbar: {\n\t\t\tinserter: true,\n\t\t\tundo: true,\n\t\t\tinspector: true,\n\t\t\tnavigation: false,\n\t\t\tdocumentInspector: false,\n\t\t\tselectorTool: false,\n\t\t},\n\t\tsidebar: {\n\t\t\tinspector: false,\n\t\t\tinserter: false,\n\t\t},\n\t\tmoreMenu: {\n\t\t\teditor: false,\n\t\t\tfullscreen: false,\n\t\t\tpreview: false,\n\t\t\ttopToolbar: false,\n\t\t},\n\t\tlinkMenu: [],\n\t\tcurrentPattern: null,\n\t\tpatterns: [],\n\t\tdefaultPreferences: {},\n\t\tallowApi: false,\n\t\tdisableCanvasAnimations: false,\n\t},\n};\n\n/**\n * Ignored content are pieces of HTML that we don't need to save. This could be, for example, an empty pattern.\n *\n * @param {Pattern[]} patterns - Array of patterns.\n * @param {string} currentPattern - Selected pattern name.\n * @param {object|null} gutenbergTemplate - Gutenberg template.\n * @return {string[]} Array of ignored HTML strings.\n */\nfunction getIgnoredContent( patterns, currentPattern, gutenbergTemplate ) {\n\tconst ignored = [\n\t\tserialize( createBlock( 'core/paragraph' ) ),\n\t\tserialize( createBlock( 'core/paragraph', { className: '' } ) ),\n\t];\n\tconst found = getPattern( patterns, currentPattern );\n\n\t// If we're using a starter pattern then add the empty pattern to our ignored content list\n\tif ( found ) {\n\t\t// We parse and then serialize so it will better match the formatting from Gutenberg when saving content\n\t\tignored.push( serialize( parse( found.content ) ) );\n\t}\n\n\t// If we're using a Gutenberg template then add that to the ignored list\n\tif ( gutenbergTemplate ) {\n\t\tignored.push( serialize( synchronizeBlocksWithTemplate( [], gutenbergTemplate ) ) );\n\t}\n\n\treturn ignored;\n}\n\nconst reducer = ( state = DEFAULT_STATE, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'SETUP_EDITOR': {\n\t\t\tconst { currentPattern, patterns } = action.settings.iso;\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpatterns,\n\t\t\t\tcurrentPattern,\n\t\t\t\tignoredContent: getIgnoredContent( patterns, currentPattern, action.settings.editor.template ),\n\t\t\t\tgutenbergTemplate: action.settings.editor.template,\n\t\t\t\tsettings: {\n\t\t\t\t\t...state.settings,\n\t\t\t\t\t...action.settings.iso,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tcase 'SET_CURRENT_PATTERN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcurrentPattern: action.pattern,\n\t\t\t\tignoredContent: getIgnoredContent( state.patterns, action.pattern, state.gutenbergTemplate ),\n\t\t\t};\n\n\t\tcase 'SET_EDITOR_MODE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\teditorMode: action.editorMode,\n\t\t\t};\n\n\t\tcase 'SET_INSERTER_OPEN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisInserterOpened: action.isOpen,\n\t\t\t\tisInspectorOpened: false,\n\t\t\t\tisListViewOpened: false,\n\t\t\t};\n\n\t\tcase 'SET_INSPECTOR_OPEN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisInspectorOpened: action.isOpen,\n\t\t\t\tisListViewOpened: false,\n\t\t\t};\n\n\t\tcase 'SET_LISTVIEW_OPEN':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisInserterOpened: false,\n\t\t\t\tisInspectorOpened: false,\n\t\t\t\tisListViewOpened: action.isOpen,\n\t\t\t};\n\n\t\tcase 'SET_EDITING':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisEditing: action.isEditing,\n\t\t\t};\n\n\t\tcase 'SET_EDITOR_READY':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisReady: action.isReady,\n\t\t\t};\n\n\t\tcase 'SET_DEVICE_TYPE':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdeviceType: action.deviceType,\n\t\t\t};\n\n\t\tcase 'SET_CANVAS_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcanvasStyles: action.canvasStyles,\n\t\t\t};\n\n\t\tcase 'SET_IFRAME_PREVIEW':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisIframePreview: action.isIframePreview,\n\t\t\t};\n\t}\n\n\treturn state;\n};\n\nexport default reducer;\n"],"mappings":"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"}