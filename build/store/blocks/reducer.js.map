{"version":3,"file":"reducer.js","names":["_reduxUndo","_interopRequireDefault","require","_isShallowEqual","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","DEFAULT_STATE","editCount","selection","blocks","groupBy","action","currentState","previousHistory","getSelectedBlock","find","block","clientId","isNewUndo","state","type","isShallowEqual","previousBlock","selectionStart","currentBlock","attributes","reducer","undefined","_default","undoable","exports"],"sources":["../../../src/store/blocks/reducer.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport undoable from 'redux-undo';\n\n/**\n * WordPress dependencies\n */\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\nconst DEFAULT_STATE = {\n\teditCount: 0,\n\tselection: null,\n\tblocks: null,\n};\n\nconst groupBy = ( action, currentState, previousHistory ) => {\n\treturn currentState.editCount;\n};\n\nfunction getSelectedBlock( blocks, selection ) {\n\treturn blocks.find( ( block ) => block.clientId === selection.clientId );\n}\n\n// Gutenberg triggers a UPDATE_BLOCKS_WITH_UNDO one second after typing. Try and group this with the previous edits\nfunction isNewUndo( action, state ) {\n\tconst { type, selection } = action;\n\n\t// Don't create a new undo when flagged as no undo\n\tif ( type === 'UPDATE_BLOCKS_WITHOUT_UNDO' ) {\n\t\treturn false;\n\t}\n\n\tif ( ! selection ) {\n\t\treturn true;\n\t}\n\n\t// Not new if selection is same\n\tif ( isShallowEqual( selection, state.selection ) ) {\n\t\tconst previousBlock = getSelectedBlock( state.blocks, selection.selectionStart );\n\t\tconst currentBlock = getSelectedBlock( action.blocks, selection.selectionStart );\n\n\t\t// Check if any attributes have changed in the selected block\n\t\tif ( previousBlock && currentBlock && isShallowEqual( previousBlock.attributes, currentBlock.attributes ) ) {\n\t\t\t// Nothing has changed - not a new undo level\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// Yes, a new undo level\n\treturn true;\n}\n\nconst reducer = ( state = DEFAULT_STATE, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'UPDATE_BLOCKS_WITHOUT_UNDO':\n\t\tcase 'UPDATE_BLOCKS_WITH_UNDO':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\teditCount: isNewUndo( action, state ) ? state.editCount + 1 : state.editCount,\n\t\t\t\tblocks: action.blocks,\n\t\t\t\tselection: action.selection,\n\t\t\t};\n\t}\n\n\treturn state;\n};\n\nexport default undoable( reducer, {\n\tgroupBy,\n} );\n"],"mappings":"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"}