{"version":3,"file":"reducer.js","names":["DEFAULT_STATE","editCount","selection","blocks","groupBy","action","currentState","previousHistory","getSelectedBlock","find","block","clientId","isNewUndo","state","type","isShallowEqual","previousBlock","selectionStart","currentBlock","attributes","reducer","undoable"],"sources":["../../../src/store/blocks/reducer.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport undoable from 'redux-undo';\n\n/**\n * WordPress dependencies\n */\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\nconst DEFAULT_STATE = {\n\teditCount: 0,\n\tselection: null,\n\tblocks: null,\n};\n\nconst groupBy = ( action, currentState, previousHistory ) => {\n\treturn currentState.editCount;\n};\n\nfunction getSelectedBlock( blocks, selection ) {\n\treturn blocks.find( ( block ) => block.clientId === selection.clientId );\n}\n\n// Gutenberg triggers a UPDATE_BLOCKS_WITH_UNDO one second after typing. Try and group this with the previous edits\nfunction isNewUndo( action, state ) {\n\tconst { type, selection } = action;\n\n\t// Don't create a new undo when flagged as no undo\n\tif ( type === 'UPDATE_BLOCKS_WITHOUT_UNDO' ) {\n\t\treturn false;\n\t}\n\n\tif ( ! selection ) {\n\t\treturn true;\n\t}\n\n\t// Not new if selection is same\n\tif ( isShallowEqual( selection, state.selection ) ) {\n\t\tconst previousBlock = getSelectedBlock( state.blocks, selection.selectionStart );\n\t\tconst currentBlock = getSelectedBlock( action.blocks, selection.selectionStart );\n\n\t\t// Check if any attributes have changed in the selected block\n\t\tif ( previousBlock && currentBlock && isShallowEqual( previousBlock.attributes, currentBlock.attributes ) ) {\n\t\t\t// Nothing has changed - not a new undo level\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// Yes, a new undo level\n\treturn true;\n}\n\nconst reducer = ( state = DEFAULT_STATE, action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'UPDATE_BLOCKS_WITHOUT_UNDO':\n\t\tcase 'UPDATE_BLOCKS_WITH_UNDO':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\teditCount: isNewUndo( action, state ) ? state.editCount + 1 : state.editCount,\n\t\t\t\tblocks: action.blocks,\n\t\t\t\tselection: action.selection,\n\t\t\t};\n\t}\n\n\treturn state;\n};\n\nexport default undoable( reducer, {\n\tgroupBy,\n} );\n"],"mappings":";;;;;;;;;;;AAGA;;AAKA;;;;;;AAEA,IAAMA,aAAa,GAAG;EACrBC,SAAS,EAAE,CADU;EAErBC,SAAS,EAAE,IAFU;EAGrBC,MAAM,EAAE;AAHa,CAAtB;;AAMA,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAAEC,MAAF,EAAUC,YAAV,EAAwBC,eAAxB,EAA6C;EAC5D,OAAOD,YAAY,CAACL,SAApB;AACA,CAFD;;AAIA,SAASO,gBAAT,CAA2BL,MAA3B,EAAmCD,SAAnC,EAA+C;EAC9C,OAAOC,MAAM,CAACM,IAAP,CAAa,UAAEC,KAAF;IAAA,OAAaA,KAAK,CAACC,QAAN,KAAmBT,SAAS,CAACS,QAA1C;EAAA,CAAb,CAAP;AACA,C,CAED;;;AACA,SAASC,SAAT,CAAoBP,MAApB,EAA4BQ,KAA5B,EAAoC;EACnC,IAAQC,IAAR,GAA4BT,MAA5B,CAAQS,IAAR;EAAA,IAAcZ,SAAd,GAA4BG,MAA5B,CAAcH,SAAd,CADmC,CAGnC;;EACA,IAAKY,IAAI,KAAK,4BAAd,EAA6C;IAC5C,OAAO,KAAP;EACA;;EAED,IAAK,CAAEZ,SAAP,EAAmB;IAClB,OAAO,IAAP;EACA,CAVkC,CAYnC;;;EACA,IAAK,IAAAa,0BAAA,EAAgBb,SAAhB,EAA2BW,KAAK,CAACX,SAAjC,CAAL,EAAoD;IACnD,IAAMc,aAAa,GAAGR,gBAAgB,CAAEK,KAAK,CAACV,MAAR,EAAgBD,SAAS,CAACe,cAA1B,CAAtC;IACA,IAAMC,YAAY,GAAGV,gBAAgB,CAAEH,MAAM,CAACF,MAAT,EAAiBD,SAAS,CAACe,cAA3B,CAArC,CAFmD,CAInD;;IACA,IAAKD,aAAa,IAAIE,YAAjB,IAAiC,IAAAH,0BAAA,EAAgBC,aAAa,CAACG,UAA9B,EAA0CD,YAAY,CAACC,UAAvD,CAAtC,EAA4G;MAC3G;MACA,OAAO,KAAP;IACA;EACD,CAtBkC,CAwBnC;;;EACA,OAAO,IAAP;AACA;;AAED,IAAMC,OAAO,GAAG,SAAVA,OAAU,GAAqC;EAAA,IAAnCP,KAAmC,uEAA3Bb,aAA2B;EAAA,IAAZK,MAAY;;EACpD,QAASA,MAAM,CAACS,IAAhB;IACC,KAAK,4BAAL;IACA,KAAK,yBAAL;MACC,uCACID,KADJ;QAECZ,SAAS,EAAEW,SAAS,CAAEP,MAAF,EAAUQ,KAAV,CAAT,GAA6BA,KAAK,CAACZ,SAAN,GAAkB,CAA/C,GAAmDY,KAAK,CAACZ,SAFrE;QAGCE,MAAM,EAAEE,MAAM,CAACF,MAHhB;QAICD,SAAS,EAAEG,MAAM,CAACH;MAJnB;EAHF;;EAWA,OAAOW,KAAP;AACA,CAbD;;eAee,IAAAQ,qBAAA,EAAUD,OAAV,EAAmB;EACjChB,OAAO,EAAPA;AADiC,CAAnB,C"}