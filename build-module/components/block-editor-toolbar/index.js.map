{"version":3,"file":"index.js","names":["useEffect","useRef","Button","cog","__","useSelect","useDispatch","useViewportMatch","MoreMenu","HeaderToolbar","Inspector","ToolbarSlot","BlockEditorToolbar","props","ref","settings","editorMode","renderMoreMenu","isHugeViewport","inspector","iso","toolbar","moreMenu","inspectorInSidebar","sidebar","openGeneralSidebar","closeGeneralSidebar","setIsInserterOpened","isEditorSidebarOpened","isBlockSelected","hasBlockSelected","isInserterOpened","isEditing","select","getBlockSelectionStart","toggleSidebar"],"sources":["../../../src/components/block-editor-toolbar/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect, useRef } from '@wordpress/element';\nimport { Button } from '@wordpress/components';\nimport { cog } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useViewportMatch } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport MoreMenu from './more-menu';\nimport HeaderToolbar from './header-toolbar';\nimport Inspector from './inspector';\nimport ToolbarSlot from './slot';\nimport './style.scss';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Block editor toolbar\n *\n * @param {Object} props - Component props\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n */\nconst BlockEditorToolbar = ( props ) => {\n\tconst ref = useRef();\n\tconst { settings, editorMode, renderMoreMenu } = props;\n\tconst isHugeViewport = useViewportMatch( 'huge', '>=' );\n\tconst { inspector } = settings.iso?.toolbar || {};\n\tconst { moreMenu } = settings.iso || {};\n\tconst inspectorInSidebar = settings?.iso?.sidebar?.inspector || false;\n\tconst { openGeneralSidebar, closeGeneralSidebar } = useDispatch( 'isolated/editor' );\n\tconst { setIsInserterOpened } = useDispatch( 'isolated/editor' );\n\tconst { isEditorSidebarOpened, isBlockSelected, hasBlockSelected, isInserterOpened, isEditing } = useSelect(\n\t\t( select ) => ( {\n\t\t\tisEditing: select( 'isolated/editor' ),\n\t\t\tisEditorSidebarOpened: select( 'isolated/editor' ).isEditorSidebarOpened(),\n\t\t\tisBlockSelected: !! select( 'core/block-editor' ).getBlockSelectionStart(),\n\t\t\thasBlockSelected: !! select( 'core/block-editor' ).getBlockSelectionStart(),\n\t\t\tisInserterOpened: select( 'isolated/editor' ).isInserterOpened(),\n\t\t} ),\n\t\t[]\n\t);\n\n\tfunction toggleSidebar() {\n\t\tif ( isEditorSidebarOpened ) {\n\t\t\tcloseGeneralSidebar();\n\t\t} else {\n\t\t\topenGeneralSidebar( hasBlockSelected ? 'edit-post/block' : 'edit-post/document' );\n\t\t}\n\t}\n\n\t// If in popover mode then ensure the sidebar is closed when the editor is first started. This is because the complimentary area status\n\t// is saved to localStorage, and it might have been left open when in sidebar mode.\n\tuseEffect( () => {\n\t\tif ( ! inspectorInSidebar ) {\n\t\t\tcloseGeneralSidebar();\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Close the block inspector when no block is selected. Gutenberg gets a bit crashy otherwise\n\t\tif ( ! inspectorInSidebar && ! isEditing && ! isBlockSelected && isEditorSidebarOpened ) {\n\t\t\tcloseGeneralSidebar();\n\t\t}\n\t}, [ isEditing ] );\n\n\t// Inserter and Sidebars are mutually exclusive\n\tuseEffect( () => {\n\t\tif ( isEditorSidebarOpened && ! isHugeViewport ) {\n\t\t\tsetIsInserterOpened( false );\n\t\t}\n\t}, [ isEditorSidebarOpened, isHugeViewport ] );\n\tuseEffect( () => {\n\t\tif ( isInserterOpened && ( ! isHugeViewport || ! inspectorInSidebar ) ) {\n\t\t\tcloseGeneralSidebar();\n\t\t}\n\t}, [ isInserterOpened, isHugeViewport ] );\n\n\treturn (\n\t\t<div className=\"edit-post-editor-regions__header\" role=\"region\" tabIndex={ -1 }>\n\t\t\t<div className=\"edit-post-header\">\n\t\t\t\t<div className=\"edit-post-header__toolbar\">\n\t\t\t\t\t<HeaderToolbar settings={ settings } />\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"edit-post-header__settings\"\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tref={ ref }\n\t\t\t\t>\n\t\t\t\t\t<ToolbarSlot.Slot />\n\n\t\t\t\t\t{ inspector && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ticon={ cog }\n\t\t\t\t\t\t\tlabel={ __( 'Settings' ) }\n\t\t\t\t\t\t\tonClick={ toggleSidebar }\n\t\t\t\t\t\t\tisPressed={ isEditorSidebarOpened }\n\t\t\t\t\t\t\taria-expanded={ isEditorSidebarOpened }\n\t\t\t\t\t\t\tdisabled={ editorMode === 'text' }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ isEditorSidebarOpened && ! inspectorInSidebar && (\n\t\t\t\t\t\t<Inspector button={ ref } onToggle={ toggleSidebar } />\n\t\t\t\t\t) }\n\n\t\t\t\t\t{ moreMenu && (\n\t\t\t\t\t\t<MoreMenu\n\t\t\t\t\t\t\tsettings={ settings }\n\t\t\t\t\t\t\tonClick={ () => closeGeneralSidebar() }\n\t\t\t\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport default BlockEditorToolbar;\n"],"mappings":"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"}