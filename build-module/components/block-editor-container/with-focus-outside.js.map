{"version":3,"file":"with-focus-outside.js","names":["includes","Component","createHigherOrderComponent","INPUT_BUTTON_TYPES","isFocusNormalizedButton","element","nodeName","type","WrappedComponent","constructor","arguments","bindNode","bind","cancelBlurCheck","queueBlurCheck","normalizeButtonFocus","componentWillUnmount","clearTimeout","blurCheckTimeout","node","event","persist","preventBlurCheck","setTimeout","document","hasFocus","preventDefault","handleFocusOutside","handleFocus","target","isInteractionEnd","render","createElement","onFocus","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onBlur","_extends","ref","props"],"sources":["../../../src/components/block-editor-container/with-focus-outside.js"],"sourcesContent":["// @ts-nocheck\n/**\n * External dependencies\n */\nimport { includes } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { createHigherOrderComponent } from '@wordpress/compose';\n\n/**\n * Input types which are classified as button types, for use in considering\n * whether element is a (focus-normalized) button.\n *\n * @type {string[]}\n */\nconst INPUT_BUTTON_TYPES = [ 'button', 'submit' ];\n\n/**\n * Returns true if the given element is a button element subject to focus\n * normalization, or false otherwise.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n *\n * @param {Element} element Element to test.\n *\n * @return {boolean} Whether element is a button.\n */\nfunction isFocusNormalizedButton( element ) {\n\tswitch ( element.nodeName ) {\n\t\tcase 'A':\n\t\tcase 'BUTTON':\n\t\t\treturn true;\n\n\t\tcase 'INPUT':\n\t\t\treturn includes( INPUT_BUTTON_TYPES, element.type );\n\t}\n\n\treturn false;\n}\n\nexport default createHigherOrderComponent( ( WrappedComponent ) => {\n\treturn class extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\n\t\t\tthis.bindNode = this.bindNode.bind( this );\n\t\t\tthis.cancelBlurCheck = this.cancelBlurCheck.bind( this );\n\t\t\tthis.queueBlurCheck = this.queueBlurCheck.bind( this );\n\t\t\tthis.normalizeButtonFocus = this.normalizeButtonFocus.bind( this );\n\t\t}\n\n\t\tcomponentWillUnmount() {\n\t\t\tclearTimeout( this.blurCheckTimeout );\n\t\t}\n\n\t\tbindNode( node ) {\n\t\t\tif ( node ) {\n\t\t\t\tthis.node = node;\n\t\t\t} else {\n\t\t\t\tdelete this.node;\n\t\t\t\tthis.cancelBlurCheck();\n\t\t\t}\n\t\t}\n\n\t\tqueueBlurCheck( event ) {\n\t\t\t// React does not allow using an event reference asynchronously\n\t\t\t// due to recycling behavior, except when explicitly persisted.\n\t\t\tevent.persist();\n\n\t\t\t// Skip blur check if clicking button. See `normalizeButtonFocus`.\n\t\t\tif ( this.preventBlurCheck ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.blurCheckTimeout = setTimeout( () => {\n\t\t\t\t// If document is not focused then focus should remain\n\t\t\t\t// inside the wrapped component and therefore we cancel\n\t\t\t\t// this blur event thereby leaving focus in place.\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Document/hasFocus.\n\t\t\t\tif ( ! document.hasFocus() ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( 'function' === typeof this.node.handleFocusOutside ) {\n\t\t\t\t\tthis.node.handleFocusOutside( event );\n\t\t\t\t}\n\t\t\t}, 0 );\n\t\t}\n\n\t\tcancelBlurCheck() {\n\t\t\tclearTimeout( this.blurCheckTimeout );\n\t\t\tif ( typeof this.node !== 'undefined' && 'function' === typeof this.node.handleFocus ) {\n\t\t\t\tthis.node.handleFocus( event );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handles a mousedown or mouseup event to respectively assign and\n\t\t * unassign a flag for preventing blur check on button elements. Some\n\t\t * browsers, namely Firefox and Safari, do not emit a focus event on\n\t\t * button elements when clicked, while others do. The logic here\n\t\t * intends to normalize this as treating click on buttons as focus.\n\t\t *\n\t\t * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t *\n\t\t * @param {MouseEvent} event Event for mousedown or mouseup.\n\t\t */\n\t\tnormalizeButtonFocus( event ) {\n\t\t\tconst { type, target } = event;\n\n\t\t\tconst isInteractionEnd = includes( [ 'mouseup', 'touchend' ], type );\n\n\t\t\tif ( isInteractionEnd ) {\n\t\t\t\tthis.preventBlurCheck = false;\n\t\t\t} else if ( isFocusNormalizedButton( target ) ) {\n\t\t\t\tthis.preventBlurCheck = true;\n\t\t\t}\n\t\t}\n\n\t\trender() {\n\t\t\t// Disable reason: See `normalizeButtonFocus` for browser-specific\n\t\t\t// focus event normalization.\n\n\t\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tonFocus={ this.cancelBlurCheck }\n\t\t\t\t\tonMouseDown={ this.normalizeButtonFocus }\n\t\t\t\t\tonMouseUp={ this.normalizeButtonFocus }\n\t\t\t\t\tonTouchStart={ this.normalizeButtonFocus }\n\t\t\t\t\tonTouchEnd={ this.normalizeButtonFocus }\n\t\t\t\t\tonBlur={ this.queueBlurCheck }\n\t\t\t\t>\n\t\t\t\t\t<WrappedComponent ref={ this.bindNode } { ...this.props } />\n\t\t\t\t</div>\n\t\t\t);\n\t\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t\t}\n\t};\n}, 'withFocusOutside' );\n"],"mappings":"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"}