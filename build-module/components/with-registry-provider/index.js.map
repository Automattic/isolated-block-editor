{"version":3,"file":"index.js","names":["useState","useEffect","withRegistry","createRegistry","RegistryProvider","plugins","createHigherOrderComponent","storeConfig","blockEditorStoreConfig","coreEditorStoreConfig","reusableStore","applyDefaultSettings","decoratedEditor","interfaceStore","registries","STORE_NAME","withRegistryProvider","WrappedComponent","props","registry","settings","additionalProps","defaultSettings","persistenceKey","preferencesKey","defaultPreferences","customStores","iso","subRegistry","setSubRegistry","newRegistry","use","persistence","store","registerStore","blockEditorStore","persist","editorStore","selectors","select","map","push","name","config","cleanup","filter","item","createElement","value","_extends"],"sources":["../../../src/components/with-registry-provider/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useEffect } from '@wordpress/element';\nimport { withRegistry, createRegistry, RegistryProvider, plugins } from '@wordpress/data';\nimport { createHigherOrderComponent } from '@wordpress/compose';\nimport { storeConfig as blockEditorStoreConfig } from '@wordpress/block-editor';\nimport { storeConfig as coreEditorStoreConfig } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport storeConfig from '../../store';\nimport reusableStore from './reusable-store';\nimport applyDefaultSettings from '../default-settings';\nimport decoratedEditor from '../../store/core-editor';\nimport interfaceStore from './interface-store';\n\n// Keep track of the registries we create so we can release them after the editor instance is removed\nlet registries = [];\n\nconst STORE_NAME = 'isolated/editor';\n\n/**\n * This is the core of having a multi-editor Gutenberg experience.\n *\n * We create a sub registry that contains copies of `core/block-editor`, `core/editor`, and STORE_NAME. These are specific to the editor instance and\n * provide the content for each editor, as well as overriding some core functions\n *\n * The key `persistenceKey` from the settings is used as the `localStorage` key to save Gutenberg preferences\n */\nconst withRegistryProvider = createHigherOrderComponent(\n\t/**\n\t *\n\t * @param {import(\"react\").FC } WrappedComponent\n\t */\n\t( WrappedComponent ) =>\n\t\twithRegistry( ( props ) => {\n\t\t\tconst { registry, settings, ...additionalProps } = props;\n\t\t\tconst defaultSettings = applyDefaultSettings( settings );\n\t\t\tconst { persistenceKey, preferencesKey, defaultPreferences, customStores = [] } = defaultSettings.iso || {};\n\t\t\tconst [ subRegistry, setSubRegistry ] = useState( null );\n\n\t\t\tuseEffect( () => {\n\t\t\t\t// Create a new registry for this editor. We have the STORE_NAME for storing blocks and other data\n\t\t\t\t// and a duplicate of `core/block-editor` for storing block selections\n\t\t\t\tconst newRegistry = createRegistry(\n\t\t\t\t\t{\n\t\t\t\t\t\t'core/reusable-blocks': reusableStore,\n\t\t\t\t\t\t'core/interface': interfaceStore,\n\t\t\t\t\t},\n\t\t\t\t\tregistry\n\t\t\t\t);\n\n\t\t\t\t// Enable the persistence plugin so we use settings in `localStorage`\n\t\t\t\tif ( persistenceKey ) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tnewRegistry.use( plugins.persistence, {\n\t\t\t\t\t\tpersistenceKey,\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Create our custom store\n\t\t\t\tconst store = newRegistry.registerStore(\n\t\t\t\t\tSTORE_NAME,\n\t\t\t\t\tstoreConfig( preferencesKey, defaultPreferences )\n\t\t\t\t);\n\n\t\t\t\t// Create the core/block-editor store separatley as we need the persistence plugin to be active\n\t\t\t\tconst blockEditorStore = newRegistry.registerStore( 'core/block-editor', {\n\t\t\t\t\t...blockEditorStoreConfig,\n\t\t\t\t\tpersist: [ 'preferences' ],\n\t\t\t\t} );\n\n\t\t\t\t// Duplicate the core/editor store so we can decorate it\n\t\t\t\tconst editorStore = newRegistry.registerStore( 'core/editor', {\n\t\t\t\t\t...coreEditorStoreConfig,\n\t\t\t\t\tselectors: {\n\t\t\t\t\t\t...coreEditorStoreConfig.selectors,\n\t\t\t\t\t\t...decoratedEditor( coreEditorStoreConfig.selectors, newRegistry.select ),\n\t\t\t\t\t},\n\t\t\t\t\tpersist: [ 'preferences' ],\n\t\t\t\t} );\n\n\t\t\t\t// Create any custom stores inside our registry\n\t\t\t\tcustomStores.map( ( store ) => {\n\t\t\t\t\tregistries.push( newRegistry.registerStore( store.name, store.config ) );\n\t\t\t\t} );\n\n\t\t\t\tregistries.push( store );\n\t\t\t\tregistries.push( blockEditorStore );\n\t\t\t\tregistries.push( editorStore );\n\n\t\t\t\t// @ts-ignore\n\t\t\t\tsetSubRegistry( newRegistry );\n\n\t\t\t\treturn function cleanup() {\n\t\t\t\t\tregistries = registries.filter( ( item ) => item !== store );\n\t\t\t\t};\n\t\t\t}, [ registry ] );\n\n\t\t\tif ( ! subRegistry ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<RegistryProvider value={ subRegistry }>\n\t\t\t\t\t{ /* @ts-ignore */ }\n\t\t\t\t\t<WrappedComponent { ...additionalProps } settings={ defaultSettings } />\n\t\t\t\t</RegistryProvider>\n\t\t\t);\n\t\t} ),\n\t'withRegistryProvider'\n);\n\nexport default withRegistryProvider;\n"],"mappings":";;AAAA;AACA;AACA;AACA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,oBAAoB;AACxD,SAASC,YAAY,EAAEC,cAAc,EAAEC,gBAAgB,EAAEC,OAAO,QAAQ,iBAAiB;AACzF,SAASC,0BAA0B,QAAQ,oBAAoB;AAC/D,SAASC,WAAW,IAAIC,sBAAsB,QAAQ,yBAAyB;AAC/E,SAASD,WAAW,IAAIE,qBAAqB,QAAQ,mBAAmB;;AAExE;AACA;AACA;AACA,OAAOF,WAAW,MAAM,aAAa;AACrC,OAAOG,aAAa,MAAM,kBAAkB;AAC5C,OAAOC,oBAAoB,MAAM,qBAAqB;AACtD,OAAOC,eAAe,MAAM,yBAAyB;AACrD,OAAOC,cAAc,MAAM,mBAAmB;;AAE9C;AACA,IAAIC,UAAU,GAAG,EAAE;AAEnB,MAAMC,UAAU,GAAG,iBAAiB;;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,oBAAoB,GAAGV,0BAA0B;AACtD;AACD;AACA;AACA;AACGW,gBAAgB,IACjBf,YAAY,CAAIgB,KAAK,IAAM;EAC1B,MAAM;IAAEC,QAAQ;IAAEC,QAAQ;IAAE,GAAGC;EAAgB,CAAC,GAAGH,KAAK;EACxD,MAAMI,eAAe,GAAGX,oBAAoB,CAAES,QAAQ,CAAE;EACxD,MAAM;IAAEG,cAAc;IAAEC,cAAc;IAAEC,kBAAkB;IAAEC,YAAY,GAAG;EAAG,CAAC,GAAGJ,eAAe,CAACK,GAAG,IAAI,CAAC,CAAC;EAC3G,MAAM,CAAEC,WAAW,EAAEC,cAAc,CAAE,GAAG7B,QAAQ,CAAE,IAAI,CAAE;EAExDC,SAAS,CAAE,MAAM;IAChB;IACA;IACA,MAAM6B,WAAW,GAAG3B,cAAc,CACjC;MACC,sBAAsB,EAAEO,aAAa;MACrC,gBAAgB,EAAEG;IACnB,CAAC,EACDM,QAAQ,CACR;;IAED;IACA,IAAKI,cAAc,EAAG;MACrB;MACAO,WAAW,CAACC,GAAG,CAAE1B,OAAO,CAAC2B,WAAW,EAAE;QACrCT;MACD,CAAC,CAAE;IACJ;;IAEA;IACA,MAAMU,KAAK,GAAGH,WAAW,CAACI,aAAa,CACtCnB,UAAU,EACVR,WAAW,CAAEiB,cAAc,EAAEC,kBAAkB,CAAE,CACjD;;IAED;IACA,MAAMU,gBAAgB,GAAGL,WAAW,CAACI,aAAa,CAAE,mBAAmB,EAAE;MACxE,GAAG1B,sBAAsB;MACzB4B,OAAO,EAAE,CAAE,aAAa;IACzB,CAAC,CAAE;;IAEH;IACA,MAAMC,WAAW,GAAGP,WAAW,CAACI,aAAa,CAAE,aAAa,EAAE;MAC7D,GAAGzB,qBAAqB;MACxB6B,SAAS,EAAE;QACV,GAAG7B,qBAAqB,CAAC6B,SAAS;QAClC,GAAG1B,eAAe,CAAEH,qBAAqB,CAAC6B,SAAS,EAAER,WAAW,CAACS,MAAM;MACxE,CAAC;MACDH,OAAO,EAAE,CAAE,aAAa;IACzB,CAAC,CAAE;;IAEH;IACAV,YAAY,CAACc,GAAG,CAAIP,KAAK,IAAM;MAC9BnB,UAAU,CAAC2B,IAAI,CAAEX,WAAW,CAACI,aAAa,CAAED,KAAK,CAACS,IAAI,EAAET,KAAK,CAACU,MAAM,CAAE,CAAE;IACzE,CAAC,CAAE;IAEH7B,UAAU,CAAC2B,IAAI,CAAER,KAAK,CAAE;IACxBnB,UAAU,CAAC2B,IAAI,CAAEN,gBAAgB,CAAE;IACnCrB,UAAU,CAAC2B,IAAI,CAAEJ,WAAW,CAAE;;IAE9B;IACAR,cAAc,CAAEC,WAAW,CAAE;IAE7B,OAAO,SAASc,OAAOA,CAAA,EAAG;MACzB9B,UAAU,GAAGA,UAAU,CAAC+B,MAAM,CAAIC,IAAI,IAAMA,IAAI,KAAKb,KAAK,CAAE;IAC7D,CAAC;EACF,CAAC,EAAE,CAAEd,QAAQ,CAAE,CAAE;EAEjB,IAAK,CAAES,WAAW,EAAG;IACpB,OAAO,IAAI;EACZ;EAEA,OACCmB,aAAA,CAAC3C,gBAAgB;IAAC4C,KAAK,EAAGpB;EAAa,GAEtCmB,aAAA,CAAC9B,gBAAgB,EAAAgC,QAAA,KAAM5B,eAAe;IAAGD,QAAQ,EAAGE;EAAiB,GAAG,CACtD;AAErB,CAAC,CAAE,EACJ,sBAAsB,CACtB;AAED,eAAeN,oBAAoB"}