{"version":3,"file":"block-canvas.js","names":["useRefEffect","useMergeRefs","useSelect","useDispatch","store","blockEditorStore","BlockList","EditorStyles","Iframe","WritingFlow","useBlockSelectionClearer","getSettings","hasSelectedBlock","hasMultiSelection","clearSelectedBlock","clearBlockSelection","isEnabled","node","onMouseDown","event","target","addEventListener","removeEventListener","useMouseMoveTypingReset","isTyping","select","stopTyping","ownerDocument","lastClientX","lastClientY","stopTypingOnMouseMove","clientX","clientY","BlockCanvas","shouldIframe","height","children","createElement","styles","contentRef","contentRefProp","iframeProps","resetTypingRef","clearerRef","console","log","Fragment","scope","ref","className","tabIndex","style","width","name"],"sources":["../../../src/components/block-editor/block-canvas.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRefEffect, useMergeRefs } from '@wordpress/compose';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\n\nimport { BlockList, EditorStyles, Iframe, WritingFlow } from '@wordpress/block-editor';\n\nexport function useBlockSelectionClearer() {\n\tconst { getSettings, hasSelectedBlock, hasMultiSelection } =\n\t\tuseSelect( blockEditorStore, [] );\n\tconst { clearSelectedBlock } = useDispatch( blockEditorStore );\n\tconst { clearBlockSelection: isEnabled } = getSettings();\n\n\treturn useRefEffect(\n\t\t( node ) => {\n\t\t\tif ( !isEnabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfunction onMouseDown( event ) {\n\t\t\t\tif ( !hasSelectedBlock() && !hasMultiSelection() ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Only handle clicks on the element, not the children.\n\t\t\t\tif ( event.target !== node ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclearSelectedBlock();\n\t\t\t}\n\n\t\t\tnode.addEventListener( 'mousedown', onMouseDown );\n\n\t\t\treturn () => {\n\t\t\t\tnode.removeEventListener( 'mousedown', onMouseDown );\n\t\t\t};\n\t\t},\n\t\t[ hasSelectedBlock, hasMultiSelection, clearSelectedBlock, isEnabled ]\n\t);\n}\n\nfunction useMouseMoveTypingReset() {\n\tconst isTyping = useSelect(\n\t\t( select ) => select( blockEditorStore ).isTyping(),\n\t\t[]\n\t);\n\tconst { stopTyping } = useDispatch( blockEditorStore );\n\n\treturn useRefEffect(\n\t\t( node ) => {\n\t\t\tif ( !isTyping ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { ownerDocument } = node;\n\t\t\tlet lastClientX;\n\t\t\tlet lastClientY;\n\n\t\t\t/**\n\t\t\t * On mouse move, unset typing flag if user has moved cursor.\n\t\t\t *\n\t\t\t * @param {MouseEvent} event Mousemove event.\n\t\t\t */\n\t\t\tfunction stopTypingOnMouseMove( event ) {\n\t\t\t\tconst { clientX, clientY } = event;\n\n\t\t\t\t// We need to check that the mouse really moved because Safari\n\t\t\t\t// triggers mousemove events when shift or ctrl are pressed.\n\t\t\t\tif (\n\t\t\t\t\tlastClientX &&\n\t\t\t\t\tlastClientY &&\n\t\t\t\t\t( lastClientX !== clientX || lastClientY !== clientY )\n\t\t\t\t) {\n\t\t\t\t\tstopTyping();\n\t\t\t\t}\n\n\t\t\t\tlastClientX = clientX;\n\t\t\t\tlastClientY = clientY;\n\t\t\t}\n\n\t\t\townerDocument.addEventListener(\n\t\t\t\t'mousemove',\n\t\t\t\tstopTypingOnMouseMove\n\t\t\t);\n\n\t\t\treturn () => {\n\t\t\t\townerDocument.removeEventListener(\n\t\t\t\t\t'mousemove',\n\t\t\t\t\tstopTypingOnMouseMove\n\t\t\t\t);\n\t\t\t};\n\t\t},\n\t\t[ isTyping, stopTyping ]\n\t);\n}\n\nexport default function BlockCanvas( {\n\tshouldIframe = true,\n\theight = '300px',\n\tchildren = <BlockList />,\n\tstyles,\n\tcontentRef: contentRefProp,\n\tiframeProps,\n} ) {\n\tconst resetTypingRef = useMouseMoveTypingReset();\n\tconst clearerRef = useBlockSelectionClearer();\n\tconst contentRef = useMergeRefs( [ contentRefProp, clearerRef ] );\n\n\tif ( !shouldIframe ) {\n\t\tconsole.log( styles );\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorStyles\n\t\t\t\t\tstyles={ styles }\n\t\t\t\t\tscope=\".editor-styles-wrapper\"\n\t\t\t\t/>\n\t\t\t\t<WritingFlow\n\t\t\t\t\tref={ contentRef }\n\t\t\t\t\tclassName=\"editor-styles-wrapper\"\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t\tstyle={ { height } }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</WritingFlow>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Iframe\n\t\t\t{ ...iframeProps }\n\t\t\tref={ resetTypingRef }\n\t\t\tcontentRef={ contentRef }\n\t\t\tstyle={ {\n\t\t\t\twidth: '100%',\n\t\t\t\theight,\n\t\t\t\t...iframeProps?.style,\n\t\t\t} }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t<EditorStyles styles={ styles } />\n\t\t\t{ children }\n\t\t</Iframe>\n\t);\n}\n"],"mappings":"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"}