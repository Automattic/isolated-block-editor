{"version":3,"sources":["../../../src/components/block-editor/visual-editor.js"],"names":["React","BlockList","WritingFlow","store","blockEditorStore","useSetting","__unstableEditorStyles","EditorStyles","__experimentalLayoutStyle","LayoutStyle","__unstableUseBlockSelectionClearer","useBlockSelectionClearer","__unstableUseTypewriter","useTypewriter","__unstableUseClipboardHandler","useClipboardHandler","__unstableUseTypingObserver","useTypingObserver","__experimentalBlockSettingsMenuFirstItem","__experimentalUseResizeCanvas","useResizeCanvas","__unstableUseMouseMoveTypingReset","useMouseMoveTypingReset","__unstableIframe","Iframe","BlockTools","useSelect","__unstableMotion","motion","useRef","useMemo","useMergeRefs","MaybeIframe","children","contentRef","shouldIframe","styles","style","ref","flex","width","height","display","VisualEditor","themeSupportsLayout","select","getSettings","supportsLayout","deviceType","getPreviewDeviceType","resizedCanvasStyles","defaultLayout","previewMode","toLowerCase","desktopCanvasStyles","margin","flexFlow","background","animatedStyles","blockSelectionClearerRef","layout","undefined","padding"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tBlockList,\n\tWritingFlow,\n\tstore as blockEditorStore,\n\tuseSetting,\n\t__unstableEditorStyles as EditorStyles,\n\t__experimentalLayoutStyle as LayoutStyle,\n\t__unstableUseBlockSelectionClearer as useBlockSelectionClearer,\n\t__unstableUseTypewriter as useTypewriter,\n\t__unstableUseClipboardHandler as useClipboardHandler,\n\t__unstableUseTypingObserver as useTypingObserver,\n\t__experimentalBlockSettingsMenuFirstItem,\n\t__experimentalUseResizeCanvas as useResizeCanvas,\n\t__unstableUseMouseMoveTypingReset as useMouseMoveTypingReset,\n\t__unstableIframe as Iframe,\n\tBlockTools,\n} from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useRef, useMemo } from '@wordpress/element';\nimport { useMergeRefs } from '@wordpress/compose';\n\nfunction MaybeIframe( { children, contentRef, shouldIframe, styles, style } ) {\n\tconst ref = useMouseMoveTypingReset();\n\n\tif ( ! shouldIframe ) {\n\t\t// TODO: this will add an EditorStyles for each editor on the page, which includes adding a <style> element. probably harmless but something to keep an eye on\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorStyles styles={ styles } />\n\t\t\t\t<WritingFlow\n\t\t\t\t\tref={ contentRef }\n\t\t\t\t\tclassName=\"editor-styles-wrapper\"\n\t\t\t\t\tstyle={ { flex: '1', ...style } }\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</WritingFlow>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Iframe\n\t\t\thead={ <EditorStyles styles={ styles } /> }\n\t\t\tref={ ref }\n\t\t\tcontentRef={ contentRef }\n\t\t\tstyle={ { width: '100%', height: '100%', display: 'block' } }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t{ children }\n\t\t</Iframe>\n\t);\n}\n\n/**\n * This is a copy of packages/edit-post/src/components/visual-editor/index.js\n *\n * The original is not exported, and contains code for post titles\n */\nconst VisualEditor = ( { styles } ) => {\n\tconst themeSupportsLayout = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().supportsLayout;\n\t}, [] );\n\tconst { deviceType } = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tdeviceType: select( 'isolated/editor' ).getPreviewDeviceType(),\n\t\t};\n\t} );\n\tconst resizedCanvasStyles = useResizeCanvas( deviceType, false );\n\tconst defaultLayout = useSetting( 'layout' );\n\tconst previewMode = 'is-' + deviceType.toLowerCase() + '-preview';\n\n\tconst desktopCanvasStyles = {\n\t\t// We intentionally omit a 100% height here. The container is a flex item, so the 100% height is granted by default.\n\t\t// If a percentage height is present, older browsers such as Safari 13 apply that, but do so incorrectly as the inheritance is buggy.\n\t\twidth: '100%',\n\t\tmargin: 0,\n\t\tdisplay: 'flex',\n\t\tflexFlow: 'column',\n\t\t// Default background color so that grey\n\t\t// .edit-post-editor-regions__content color doesn't show through.\n\t\tbackground: 'white',\n\t};\n\tlet animatedStyles = desktopCanvasStyles;\n\tif ( resizedCanvasStyles ) {\n\t\tanimatedStyles = resizedCanvasStyles;\n\t}\n\n\tconst blockSelectionClearerRef = useBlockSelectionClearer();\n\tconst ref = useRef();\n\tconst contentRef = useMergeRefs( [\n\t\tref,\n\t\tuseClipboardHandler(),\n\t\tuseTypewriter(),\n\t\tuseBlockSelectionClearer(),\n\t\tuseTypingObserver(),\n\t] );\n\n\tconst layout = useMemo( () => {\n\t\tif ( themeSupportsLayout ) {\n\t\t\treturn defaultLayout;\n\t\t}\n\n\t\treturn undefined;\n\t}, [ themeSupportsLayout, defaultLayout ] );\n\n\treturn (\n\t\t<BlockTools __unstableContentRef={ ref } className=\"edit-post-visual-editor\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"edit-post-visual-editor__content-area\"\n\t\t\t\tanimate={ {\n\t\t\t\t\tpadding: '0',\n\t\t\t\t} }\n\t\t\t\tref={ blockSelectionClearerRef }\n\t\t\t>\n\t\t\t\t<motion.div animate={ animatedStyles } initial={ desktopCanvasStyles } className={ previewMode }>\n\t\t\t\t\t<MaybeIframe\n\t\t\t\t\t\tshouldIframe={ deviceType === 'Tablet' || deviceType === 'Mobile' }\n\t\t\t\t\t\tcontentRef={ contentRef }\n\t\t\t\t\t\tstyles={ styles }\n\t\t\t\t\t\tstyle={ {} }\n\t\t\t\t\t>\n\t\t\t\t\t\t<LayoutStyle\n\t\t\t\t\t\t\tselector=\".edit-post-visual-editor__post-title-wrapper, .block-editor-block-list__layout.is-root-container\"\n\t\t\t\t\t\t\tlayout={ defaultLayout }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BlockList className={ undefined } __experimentalLayout={ layout } />\n\t\t\t\t\t</MaybeIframe>\n\t\t\t\t</motion.div>\n\t\t\t</motion.div>\n\t\t</BlockTools>\n\t);\n};\n\nexport default VisualEditor;\n"],"file":"visual-editor.js"}