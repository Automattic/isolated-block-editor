{"version":3,"file":"visual-editor.js","names":["React","BlockList","WritingFlow","store","blockEditorStore","useSetting","__unstableEditorStyles","EditorStyles","__experimentalLayoutStyle","LayoutStyle","__unstableUseBlockSelectionClearer","useBlockSelectionClearer","__unstableUseTypewriter","useTypewriter","__unstableUseClipboardHandler","useClipboardHandler","__unstableUseTypingObserver","useTypingObserver","__experimentalBlockSettingsMenuFirstItem","__experimentalUseResizeCanvas","useResizeCanvas","__unstableUseMouseMoveTypingReset","useMouseMoveTypingReset","__unstableIframe","Iframe","BlockTools","useSelect","__unstableMotion","motion","useRef","useMemo","useMergeRefs","EditorHeading","MaybeIframe","children","contentRef","shouldIframe","styles","style","ref","flex","width","height","display","VisualEditor","themeSupportsLayout","select","getSettings","supportsLayout","deviceType","getPreviewDeviceType","resizedCanvasStyles","defaultLayout","previewMode","toLowerCase","desktopCanvasStyles","margin","flexFlow","background","animatedStyles","blockSelectionClearerRef","layout","undefined","padding"],"sources":["../../../src/components/block-editor/visual-editor.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tBlockList,\n\tWritingFlow,\n\tstore as blockEditorStore,\n\tuseSetting,\n\t__unstableEditorStyles as EditorStyles,\n\t__experimentalLayoutStyle as LayoutStyle,\n\t__unstableUseBlockSelectionClearer as useBlockSelectionClearer,\n\t__unstableUseTypewriter as useTypewriter,\n\t__unstableUseClipboardHandler as useClipboardHandler,\n\t__unstableUseTypingObserver as useTypingObserver,\n\t__experimentalBlockSettingsMenuFirstItem,\n\t__experimentalUseResizeCanvas as useResizeCanvas,\n\t__unstableUseMouseMoveTypingReset as useMouseMoveTypingReset,\n\t__unstableIframe as Iframe,\n\tBlockTools,\n} from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { __unstableMotion as motion } from '@wordpress/components';\nimport { useRef, useMemo } from '@wordpress/element';\nimport { useMergeRefs } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport EditorHeading from '../editor-heading-slot';\n\nfunction MaybeIframe( { children, contentRef, shouldIframe, styles, style } ) {\n\tconst ref = useMouseMoveTypingReset();\n\n\tif ( ! shouldIframe ) {\n\t\t// TODO: this will add an EditorStyles for each editor on the page, which includes adding a <style> element. probably harmless but something to keep an eye on\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorStyles styles={ styles } />\n\t\t\t\t<WritingFlow\n\t\t\t\t\tref={ contentRef }\n\t\t\t\t\tclassName=\"editor-styles-wrapper\"\n\t\t\t\t\tstyle={ { flex: '1', ...style } }\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t>\n\t\t\t\t\t{ children }\n\t\t\t\t</WritingFlow>\n\t\t\t</>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Iframe\n\t\t\thead={ <EditorStyles styles={ styles } /> }\n\t\t\tref={ ref }\n\t\t\tcontentRef={ contentRef }\n\t\t\tstyle={ { width: '100%', height: '100%', display: 'block' } }\n\t\t\tname=\"editor-canvas\"\n\t\t>\n\t\t\t{ children }\n\t\t</Iframe>\n\t);\n}\n\n/**\n * This is a copy of packages/edit-post/src/components/visual-editor/index.js\n *\n * The original is not exported, and contains code for post titles\n *\n * @param {Object} args\n * @param args.styles\n */\nconst VisualEditor = ( { styles } ) => {\n\tconst themeSupportsLayout = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn getSettings().supportsLayout;\n\t}, [] );\n\tconst { deviceType } = useSelect( ( select ) => {\n\t\treturn {\n\t\t\tdeviceType: select( 'isolated/editor' ).getPreviewDeviceType(),\n\t\t};\n\t} );\n\tconst resizedCanvasStyles = useResizeCanvas( deviceType, false );\n\tconst defaultLayout = useSetting( 'layout' );\n\tconst previewMode = 'is-' + deviceType.toLowerCase() + '-preview';\n\n\tconst desktopCanvasStyles = {\n\t\t// We intentionally omit a 100% height here. The container is a flex item, so the 100% height is granted by default.\n\t\t// If a percentage height is present, older browsers such as Safari 13 apply that, but do so incorrectly as the inheritance is buggy.\n\t\twidth: '100%',\n\t\tmargin: 0,\n\t\tdisplay: 'flex',\n\t\tflexFlow: 'column',\n\t\t// Default background color so that grey\n\t\t// .edit-post-editor-regions__content color doesn't show through.\n\t\tbackground: 'white',\n\t};\n\tlet animatedStyles = desktopCanvasStyles;\n\tif ( resizedCanvasStyles ) {\n\t\tanimatedStyles = resizedCanvasStyles;\n\t}\n\n\tconst blockSelectionClearerRef = useBlockSelectionClearer();\n\tconst ref = useRef();\n\tconst contentRef = useMergeRefs( [\n\t\tref,\n\t\tuseClipboardHandler(),\n\t\tuseTypewriter(),\n\t\tuseBlockSelectionClearer(),\n\t\tuseTypingObserver(),\n\t] );\n\n\tconst layout = useMemo( () => {\n\t\tif ( themeSupportsLayout ) {\n\t\t\treturn defaultLayout;\n\t\t}\n\n\t\treturn undefined;\n\t}, [ themeSupportsLayout, defaultLayout ] );\n\n\treturn (\n\t\t<BlockTools __unstableContentRef={ ref } className=\"edit-post-visual-editor\">\n\t\t\t<motion.div\n\t\t\t\tclassName=\"edit-post-visual-editor__content-area\"\n\t\t\t\tanimate={ {\n\t\t\t\t\tpadding: '0',\n\t\t\t\t} }\n\t\t\t\tref={ blockSelectionClearerRef }\n\t\t\t>\n\t\t\t\t<motion.div animate={ animatedStyles } initial={ desktopCanvasStyles } className={ previewMode }>\n\t\t\t\t\t<MaybeIframe\n\t\t\t\t\t\tshouldIframe={ deviceType === 'Tablet' || deviceType === 'Mobile' }\n\t\t\t\t\t\tcontentRef={ contentRef }\n\t\t\t\t\t\tstyles={ styles }\n\t\t\t\t\t\tstyle={ {} }\n\t\t\t\t\t>\n\t\t\t\t\t\t<LayoutStyle\n\t\t\t\t\t\t\tselector=\".edit-post-visual-editor__post-title-wrapper, .block-editor-block-list__layout.is-root-container\"\n\t\t\t\t\t\t\tlayout={ defaultLayout }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<EditorHeading.Slot mode=\"visual\" />\n\t\t\t\t\t\t<BlockList className={ undefined } __experimentalLayout={ layout } />\n\t\t\t\t\t</MaybeIframe>\n\t\t\t\t</motion.div>\n\t\t\t</motion.div>\n\t\t</BlockTools>\n\t);\n};\n\nexport default VisualEditor;\n"],"mappings":"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"}