{"version":3,"file":"unlock.js","names":["CORE_MODULES_USING_PRIVATE_APIS","registeredPrivateApis","requiredConsent","allowReRegistration","process","env","IS_WORDPRESS_CORE","error","__dangerousOptInToUnstableAPIsOnlyForCoreModules","consent","moduleName","includes","Error","console","log","push","lock","unlock","object","privateData","__private","lockedData","set","get","WeakMap","Symbol","allowCoreModule","name","resetAllowedCoreModules","length","pop","resetRegisteredPrivateApis"],"sources":["../../../src/components/block-editor/unlock.js"],"sourcesContent":["/**\n * wordpress/private-apis â€“ the utilities to enable private cross-package\n * exports of private APIs.\n *\n * This \"implementation.js\" file is needed for the sake of the unit tests. It\n * exports more than the public API of the package to aid in testing.\n */\n\n/**\n * The list of core modules allowed to opt-in to the private APIs.\n */\nconst CORE_MODULES_USING_PRIVATE_APIS = [\n\t'@wordpress/block-directory',\n\t'@wordpress/block-editor',\n\t'@wordpress/block-library',\n\t'@wordpress/blocks',\n\t'@wordpress/commands',\n\t'@wordpress/components',\n\t'@wordpress/core-commands',\n\t'@wordpress/core-data',\n\t'@wordpress/customize-widgets',\n\t'@wordpress/data',\n\t'@wordpress/edit-post',\n\t'@wordpress/edit-site',\n\t'@wordpress/edit-widgets',\n\t'@wordpress/editor',\n\t'@wordpress/patterns',\n\t'@wordpress/reusable-blocks',\n\t'@wordpress/router',\n];\n\n/**\n * A list of core modules that already opted-in to\n * the privateApis package.\n *\n * @type {string[]}\n */\nconst registeredPrivateApis = [];\n\n/*\n * Warning for theme and plugin developers.\n *\n * The use of private developer APIs is intended for use by WordPress Core\n * and the Gutenberg plugin exclusively.\n *\n * Dangerously opting in to using these APIs is NOT RECOMMENDED. Furthermore,\n * the WordPress Core philosophy to strive to maintain backward compatibility\n * for third-party developers DOES NOT APPLY to private APIs.\n *\n * THE CONSENT STRING FOR OPTING IN TO THESE APIS MAY CHANGE AT ANY TIME AND\n * WITHOUT NOTICE. THIS CHANGE WILL BREAK EXISTING THIRD-PARTY CODE. SUCH A\n * CHANGE MAY OCCUR IN EITHER A MAJOR OR MINOR RELEASE.\n */\nconst requiredConsent =\n\t'I know using unstable features means my theme or plugin will inevitably break in the next version of WordPress.';\n\n/** @type {boolean} */\nlet allowReRegistration;\n// The safety measure is meant for WordPress core where IS_WORDPRESS_CORE\n// is set to true.\n// For the general use-case, the re-registration should be allowed by default\n// Let's default to true, then. Try/catch will fall back to \"true\" even if the\n// environment variable is not explicitly defined.\ntry {\n\tallowReRegistration = process.env.IS_WORDPRESS_CORE ? false : true;\n} catch ( error ) {\n\tallowReRegistration = true;\n}\n\n/**\n * Called by a @wordpress package wishing to opt-in to accessing or exposing\n * private private APIs.\n *\n * @param {string} consent    The consent string.\n * @param {string} moduleName The name of the module that is opting in.\n * @return {{lock: typeof lock, unlock: typeof unlock}} An object containing the lock and unlock functions.\n */\nexport const __dangerousOptInToUnstableAPIsOnlyForCoreModules = (\n\tconsent,\n\tmoduleName\n) => {\n\tif (\n\t\t! allowReRegistration &&\n\t\tregisteredPrivateApis.includes( moduleName )\n\t) {\n\t\t// This check doesn't play well with Story Books / Hot Module Reloading\n\t\t// and isn't included in the Gutenberg plugin. It only matters in the\n\t\t// WordPress core release.\n\t\tthrow new Error(\n\t\t\t`You tried to opt-in to unstable APIs as module \"${ moduleName }\" which is already registered. ` +\n\t\t\t\t'This feature is only for JavaScript modules shipped with WordPress core. ' +\n\t\t\t\t'Please do not use it in plugins and themes as the unstable APIs will be removed ' +\n\t\t\t\t'without a warning. If you ignore this error and depend on unstable features, ' +\n\t\t\t\t'your product will inevitably break on one of the next WordPress releases.'\n\t\t);\n\t}\nconsole.log( moduleName );\n\tregisteredPrivateApis.push( moduleName );\n\n\treturn {\n\t\tlock,\n\t\tunlock,\n\t};\n};\n\n/**\n * Binds private data to an object.\n * It does not alter the passed object in any way, only\n * registers it in an internal map of private data.\n *\n * The private data can't be accessed by any other means\n * than the `unlock` function.\n *\n * @example\n * ```js\n * const object = {};\n * const privateData = { a: 1 };\n * lock( object, privateData );\n *\n * object\n * // {}\n *\n * unlock( object );\n * // { a: 1 }\n * ```\n *\n * @param {any} object      The object to bind the private data to.\n * @param {any} privateData The private data to bind to the object.\n */\nfunction lock( object, privateData ) {\n\tif ( ! object ) {\n\t\tthrow new Error( 'Cannot lock an undefined object.' );\n\t}\n\tif ( ! ( __private in object ) ) {\n\t\tobject[ __private ] = {};\n\t}\n\tlockedData.set( object[ __private ], privateData );\n}\n\n/**\n * Unlocks the private data bound to an object.\n *\n * It does not alter the passed object in any way, only\n * returns the private data paired with it using the `lock()`\n * function.\n *\n * @example\n * ```js\n * const object = {};\n * const privateData = { a: 1 };\n * lock( object, privateData );\n *\n * object\n * // {}\n *\n * unlock( object );\n * // { a: 1 }\n * ```\n *\n * @param {any} object The object to unlock the private data from.\n * @return {any} The private data bound to the object.\n */\nfunction unlock( object ) {\n\tif ( ! object ) {\n\t\tthrow new Error( 'Cannot unlock an undefined object.' );\n\t}\n\tif ( ! ( __private in object ) ) {\n\t\tthrow new Error(\n\t\t\t'Cannot unlock an object that was not locked before. '\n\t\t);\n\t}\n\n\treturn lockedData.get( object[ __private ] );\n}\n\nconst lockedData = new WeakMap();\n\n/**\n * Used by lock() and unlock() to uniquely identify the private data\n * related to a containing object.\n */\nconst __private = Symbol( 'Private API ID' );\n\n// Unit tests utilities:\n\n/**\n * Private function to allow the unit tests to allow\n * a mock module to access the private APIs.\n *\n * @param {string} name The name of the module.\n */\nexport function allowCoreModule( name ) {\n\tCORE_MODULES_USING_PRIVATE_APIS.push( name );\n}\n\n/**\n * Private function to allow the unit tests to set\n * a custom list of allowed modules.\n */\nexport function resetAllowedCoreModules() {\n\twhile ( CORE_MODULES_USING_PRIVATE_APIS.length ) {\n\t\tCORE_MODULES_USING_PRIVATE_APIS.pop();\n\t}\n}\n/**\n * Private function to allow the unit tests to reset\n * the list of registered private apis.\n */\nexport function resetRegisteredPrivateApis() {\n\twhile ( registeredPrivateApis.length ) {\n\t\tregisteredPrivateApis.pop();\n\t}\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAMA,+BAA+B,GAAG,CACvC,4BAA4B,EAC5B,yBAAyB,EACzB,0BAA0B,EAC1B,mBAAmB,EACnB,qBAAqB,EACrB,uBAAuB,EACvB,0BAA0B,EAC1B,sBAAsB,EACtB,8BAA8B,EAC9B,iBAAiB,EACjB,sBAAsB,EACtB,sBAAsB,EACtB,yBAAyB,EACzB,mBAAmB,EACnB,qBAAqB,EACrB,4BAA4B,EAC5B,mBAAmB,CACnB;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,qBAAqB,GAAG,EAAE;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,eAAe,GACpB,iHAAiH;;AAElH;AACA,IAAIC,mBAAmB;AACvB;AACA;AACA;AACA;AACA;AACA,IAAI;EACHA,mBAAmB,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,GAAG,KAAK,GAAG,IAAI;AACnE,CAAC,CAAC,OAAQC,KAAK,EAAG;EACjBJ,mBAAmB,GAAG,IAAI;AAC3B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMK,gDAAgD,GAAGA,CAC/DC,OAAO,EACPC,UAAU,KACN;EACJ,IACC,CAAEP,mBAAmB,IACrBF,qBAAqB,CAACU,QAAQ,CAAED,UAAW,CAAC,EAC3C;IACD;IACA;IACA;IACA,MAAM,IAAIE,KAAK,CACb,mDAAmDF,UAAY,iCAAgC,GAC/F,2EAA2E,GAC3E,kFAAkF,GAClF,+EAA+E,GAC/E,2EACF,CAAC;EACF;EACDG,OAAO,CAACC,GAAG,CAAEJ,UAAW,CAAC;EACxBT,qBAAqB,CAACc,IAAI,CAAEL,UAAW,CAAC;EAExC,OAAO;IACNM,IAAI;IACJC;EACD,CAAC;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASD,IAAIA,CAAEE,MAAM,EAAEC,WAAW,EAAG;EACpC,IAAK,CAAED,MAAM,EAAG;IACf,MAAM,IAAIN,KAAK,CAAE,kCAAmC,CAAC;EACtD;EACA,IAAK,EAAIQ,SAAS,IAAIF,MAAM,CAAE,EAAG;IAChCA,MAAM,CAAEE,SAAS,CAAE,GAAG,CAAC,CAAC;EACzB;EACAC,UAAU,CAACC,GAAG,CAAEJ,MAAM,CAAEE,SAAS,CAAE,EAAED,WAAY,CAAC;AACnD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASF,MAAMA,CAAEC,MAAM,EAAG;EACzB,IAAK,CAAEA,MAAM,EAAG;IACf,MAAM,IAAIN,KAAK,CAAE,oCAAqC,CAAC;EACxD;EACA,IAAK,EAAIQ,SAAS,IAAIF,MAAM,CAAE,EAAG;IAChC,MAAM,IAAIN,KAAK,CACd,sDACD,CAAC;EACF;EAEA,OAAOS,UAAU,CAACE,GAAG,CAAEL,MAAM,CAAEE,SAAS,CAAG,CAAC;AAC7C;AAEA,MAAMC,UAAU,GAAG,IAAIG,OAAO,CAAC,CAAC;;AAEhC;AACA;AACA;AACA;AACA,MAAMJ,SAAS,GAAGK,MAAM,CAAE,gBAAiB,CAAC;;AAE5C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,eAAeA,CAAEC,IAAI,EAAG;EACvC3B,+BAA+B,CAACe,IAAI,CAAEY,IAAK,CAAC;AAC7C;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASC,uBAAuBA,CAAA,EAAG;EACzC,OAAQ5B,+BAA+B,CAAC6B,MAAM,EAAG;IAChD7B,+BAA+B,CAAC8B,GAAG,CAAC,CAAC;EACtC;AACD;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,0BAA0BA,CAAA,EAAG;EAC5C,OAAQ9B,qBAAqB,CAAC4B,MAAM,EAAG;IACtC5B,qBAAqB,CAAC6B,GAAG,CAAC,CAAC;EAC5B;AACD"}