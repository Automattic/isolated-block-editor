{"version":3,"file":"listview-sidebar.js","names":["classnames","__experimentalListView","ListView","Button","useFocusOnMount","useFocusReturn","useMergeRefs","useDispatch","focus","useRef","useState","__","closeSmall","useShortcut","ESCAPE","ListViewOutline","ListViewSidebar","canClose","setIsListViewOpened","focusOnMountRef","headerFocusReturnRef","contentFocusReturnRef","closeOnEscape","event","keyCode","defaultPrevented","preventDefault","tab","setTab","sidebarRef","listViewTabRef","outlineTabRef","listViewRef","handleSidebarFocus","currentTab","listViewApplicationFocus","tabbable","find","current","listViewFocusArea","contains","ownerDocument","activeElement","createElement","className","onKeyDown","ref","icon","label","onClick"],"sources":["../../../src/components/block-editor/listview-sidebar.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __experimentalListView as ListView } from '@wordpress/block-editor';\nimport { Button } from '@wordpress/components';\nimport {\n\tuseFocusOnMount,\n\tuseFocusReturn,\n\tuseMergeRefs,\n} from '@wordpress/compose';\nimport { useDispatch } from '@wordpress/data';\nimport { focus } from '@wordpress/dom';\nimport { useRef, useState } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { closeSmall } from '@wordpress/icons';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\nimport { ESCAPE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport ListViewOutline from './list-view-outline';\n\nexport default function ListViewSidebar( { canClose = true } ) {\n\tconst { setIsListViewOpened } = useDispatch( 'isolated/editor' );\n\n\tconst focusOnMountRef = useFocusOnMount( 'firstElement' );\n\tconst headerFocusReturnRef = useFocusReturn();\n\tconst contentFocusReturnRef = useFocusReturn();\n\n\tfunction closeOnEscape( event ) {\n\t\tif ( event.keyCode === ESCAPE && !event.defaultPrevented ) {\n\t\t\tevent.preventDefault();\n\t\t\tsetIsListViewOpened( false );\n\t\t}\n\t}\n\n\tconst [ tab, setTab ] = useState( 'list-view' );\n\n\t// This ref refers to the sidebar as a whole.\n\tconst sidebarRef = useRef();\n\t// This ref refers to the list view tab button.\n\tconst listViewTabRef = useRef();\n\t// This ref refers to the outline tab button.\n\tconst outlineTabRef = useRef();\n\t// This ref refers to the list view application area.\n\tconst listViewRef = useRef();\n\n\t/*\n\t * Callback function to handle list view or outline focus.\n\t *\n\t * @param {string} currentTab The current tab. Either list view or outline.\n\t *\n\t * @return void\n\t */\n\tfunction handleSidebarFocus( currentTab ) {\n\t\t// List view tab is selected.\n\t\tif ( currentTab === 'list-view' ) {\n\t\t\t// Either focus the list view or the list view tab button. Must have a fallback because the list view does not render when there are no blocks.\n\t\t\t// @ts-ignore\n\t\t\tconst listViewApplicationFocus = focus.tabbable.find( listViewRef.current )[ 0 ];\n\t\t\t// @ts-ignore\n\t\t\tconst listViewFocusArea = sidebarRef.current.contains(\n\t\t\t\tlistViewApplicationFocus\n\t\t\t)\n\t\t\t\t? listViewApplicationFocus\n\t\t\t\t: listViewTabRef.current;\n\t\t\t// @ts-ignore\n\t\t\tlistViewFocusArea.focus();\n\t\t\t// Outline tab is selected.\n\t\t} else {\n\t\t\t// @ts-ignore\n\t\t\toutlineTabRef.current.focus();\n\t\t}\n\t}\n\n\t// This only fires when the sidebar is open because of the conditional rendering. It is the same shortcut to open but that is defined as a global shortcut and only fires when the sidebar is closed.\n\tuseShortcut( 'core/edit-post/toggle-list-view', () => {\n\t\t// If the sidebar has focus, it is safe to close.\n\t\t// @ts-ignore\n\t\tif ( sidebarRef.current.contains( sidebarRef.current.ownerDocument.activeElement ) ) {\n\t\t\tsetIsListViewOpened( false );\n\t\t\t// If the list view or outline does not have focus, focus should be moved to it.\n\t\t} else {\n\t\t\thandleSidebarFocus( tab );\n\t\t}\n\t} );\n\n\treturn (\n\t\t// eslint-disable-next-line jsx-a11y/no-static-element-interactions\n\t\t<div\n\t\t\taria-label={ __( 'Document Overview' ) }\n\t\t\tclassName=\"edit-post-editor__document-overview-panel\"\n\t\t\tonKeyDown={ closeOnEscape }\n\t\t\t// @ts-ignore\n\t\t\tref={ sidebarRef }\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"edit-post-editor__document-overview-panel-header components-panel__header edit-post-sidebar__panel-tabs\"\n\t\t\t\tref={ headerFocusReturnRef }\n\t\t\t>\n\t\t\t\t{ canClose && <Button\n\t\t\t\t\ticon={ closeSmall }\n\t\t\t\t\tlabel={ __( 'Close Document Overview Sidebar' ) }\n\t\t\t\t\tonClick={ () => setIsListViewOpened( false ) }\n\t\t\t\t/> }\n\t\t\t\t<ul>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tref={ listViewTabRef }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tsetTab( 'list-view' );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'edit-post-sidebar__panel-tab',\n\t\t\t\t\t\t\t\t{ 'is-active': tab === 'list-view' }\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\taria-current={ tab === 'list-view' }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'List View' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tref={ outlineTabRef }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tsetTab( 'outline' );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'edit-post-sidebar__panel-tab',\n\t\t\t\t\t\t\t\t{ 'is-active': tab === 'outline' }\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\taria-current={ tab === 'outline' }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Outline' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tref={ useMergeRefs( [\n\t\t\t\t\tcontentFocusReturnRef,\n\t\t\t\t\tfocusOnMountRef,\n\t\t\t\t\tlistViewRef,\n\t\t\t\t] ) }\n\t\t\t\tclassName=\"edit-post-editor__list-view-container\"\n\t\t\t>\n\t\t\t\t{ tab === 'list-view' && (\n\t\t\t\t\t<div className=\"edit-post-editor__list-view-panel-content\">\n\t\t\t\t\t\t<ListView />\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t\t{ tab === 'outline' && <ListViewOutline /> }\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"mappings":"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"}