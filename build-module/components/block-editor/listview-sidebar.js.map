{"version":3,"file":"listview-sidebar.js","names":["classnames","__experimentalListView","ListView","Button","useFocusOnMount","useFocusReturn","useMergeRefs","useDispatch","focus","useRef","useState","__","closeSmall","useShortcut","ESCAPE","ListViewOutline","ListViewSidebar","_ref","canClose","setIsListViewOpened","focusOnMountRef","headerFocusReturnRef","contentFocusReturnRef","closeOnEscape","event","keyCode","defaultPrevented","preventDefault","tab","setTab","sidebarRef","listViewTabRef","outlineTabRef","listViewRef","handleSidebarFocus","currentTab","listViewApplicationFocus","tabbable","find","current","listViewFocusArea","contains","ownerDocument","activeElement","createElement","className","onKeyDown","ref","icon","label","onClick"],"sources":["../../../src/components/block-editor/listview-sidebar.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __experimentalListView as ListView } from '@wordpress/block-editor';\nimport { Button } from '@wordpress/components';\nimport {\n\tuseFocusOnMount,\n\tuseFocusReturn,\n\tuseMergeRefs,\n} from '@wordpress/compose';\nimport { useDispatch } from '@wordpress/data';\nimport { focus } from '@wordpress/dom';\nimport { useRef, useState } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { closeSmall } from '@wordpress/icons';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\nimport { ESCAPE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport ListViewOutline from './list-view-outline';\n\nexport default function ListViewSidebar( { canClose = true } ) {\n\tconst { setIsListViewOpened } = useDispatch( 'isolated/editor' );\n\n\tconst focusOnMountRef = useFocusOnMount( 'firstElement' );\n\tconst headerFocusReturnRef = useFocusReturn();\n\tconst contentFocusReturnRef = useFocusReturn();\n\n\tfunction closeOnEscape( event ) {\n\t\tif ( event.keyCode === ESCAPE && !event.defaultPrevented ) {\n\t\t\tevent.preventDefault();\n\t\t\tsetIsListViewOpened( false );\n\t\t}\n\t}\n\n\tconst [ tab, setTab ] = useState( 'list-view' );\n\n\t// This ref refers to the sidebar as a whole.\n\tconst sidebarRef = useRef();\n\t// This ref refers to the list view tab button.\n\tconst listViewTabRef = useRef();\n\t// This ref refers to the outline tab button.\n\tconst outlineTabRef = useRef();\n\t// This ref refers to the list view application area.\n\tconst listViewRef = useRef();\n\n\t/*\n\t * Callback function to handle list view or outline focus.\n\t *\n\t * @param {string} currentTab The current tab. Either list view or outline.\n\t *\n\t * @return void\n\t */\n\tfunction handleSidebarFocus( currentTab ) {\n\t\t// List view tab is selected.\n\t\tif ( currentTab === 'list-view' ) {\n\t\t\t// Either focus the list view or the list view tab button. Must have a fallback because the list view does not render when there are no blocks.\n\t\t\t// @ts-ignore\n\t\t\tconst listViewApplicationFocus = focus.tabbable.find( listViewRef.current )[ 0 ];\n\t\t\t// @ts-ignore\n\t\t\tconst listViewFocusArea = sidebarRef.current.contains(\n\t\t\t\tlistViewApplicationFocus\n\t\t\t)\n\t\t\t\t? listViewApplicationFocus\n\t\t\t\t: listViewTabRef.current;\n\t\t\t// @ts-ignore\n\t\t\tlistViewFocusArea.focus();\n\t\t\t// Outline tab is selected.\n\t\t} else {\n\t\t\t// @ts-ignore\n\t\t\toutlineTabRef.current.focus();\n\t\t}\n\t}\n\n\t// This only fires when the sidebar is open because of the conditional rendering. It is the same shortcut to open but that is defined as a global shortcut and only fires when the sidebar is closed.\n\tuseShortcut( 'core/edit-post/toggle-list-view', () => {\n\t\t// If the sidebar has focus, it is safe to close.\n\t\t// @ts-ignore\n\t\tif ( sidebarRef.current.contains( sidebarRef.current.ownerDocument.activeElement ) ) {\n\t\t\tsetIsListViewOpened( false );\n\t\t\t// If the list view or outline does not have focus, focus should be moved to it.\n\t\t} else {\n\t\t\thandleSidebarFocus( tab );\n\t\t}\n\t} );\n\n\treturn (\n\t\t// eslint-disable-next-line jsx-a11y/no-static-element-interactions\n\t\t<div\n\t\t\taria-label={ __( 'Document Overview' ) }\n\t\t\tclassName=\"edit-post-editor__document-overview-panel\"\n\t\t\tonKeyDown={ closeOnEscape }\n\t\t\t// @ts-ignore\n\t\t\tref={ sidebarRef }\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"edit-post-editor__document-overview-panel-header components-panel__header edit-post-sidebar__panel-tabs\"\n\t\t\t\tref={ headerFocusReturnRef }\n\t\t\t>\n\t\t\t\t{ canClose && <Button\n\t\t\t\t\ticon={ closeSmall }\n\t\t\t\t\tlabel={ __( 'Close Document Overview Sidebar' ) }\n\t\t\t\t\tonClick={ () => setIsListViewOpened( false ) }\n\t\t\t\t/> }\n\t\t\t\t<ul>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tref={ listViewTabRef }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tsetTab( 'list-view' );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'edit-post-sidebar__panel-tab',\n\t\t\t\t\t\t\t\t{ 'is-active': tab === 'list-view' }\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\taria-current={ tab === 'list-view' }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'List View' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tref={ outlineTabRef }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tsetTab( 'outline' );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'edit-post-sidebar__panel-tab',\n\t\t\t\t\t\t\t\t{ 'is-active': tab === 'outline' }\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\taria-current={ tab === 'outline' }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Outline' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tref={ useMergeRefs( [\n\t\t\t\t\tcontentFocusReturnRef,\n\t\t\t\t\tfocusOnMountRef,\n\t\t\t\t\tlistViewRef,\n\t\t\t\t] ) }\n\t\t\t\tclassName=\"edit-post-editor__list-view-container\"\n\t\t\t>\n\t\t\t\t{ tab === 'list-view' && (\n\t\t\t\t\t<div className=\"edit-post-editor__list-view-panel-content\">\n\t\t\t\t\t\t<ListView />\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t\t{ tab === 'outline' && <ListViewOutline /> }\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n"],"mappings":"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"}