{"version":3,"file":"index.js","names":["isPromise","Popover","withDispatch","withSelect","compose","useEffect","parse","rawHandler","BlockEditorProvider","BlockEditor","getInitialEditorContent","getInitialContent","settings","loader","contentLoader","Promise","resolve","then","content","iso","patterns","currentPattern","editor","template","BlockEditorContents","props","blocks","updateBlocksWithoutUndo","updateBlocksWithUndo","selection","isEditing","editorMode","children","renderMoreMenu","onLoad","loadData","initialContent","length","isInitialContent","select","getBlocks","getEditorSelection","getEditorMode","dispatch"],"sources":["../../../src/components/block-editor-contents/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport isPromise from 'is-promise';\n\n/**\n * WordPress dependencies\n */\nimport { Popover } from '@wordpress/components';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { useEffect } from '@wordpress/element';\nimport { parse, rawHandler } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { BlockEditorProvider } from '@wordpress/block-editor';\nimport BlockEditor from '../block-editor';\nimport getInitialEditorContent from './editor-content';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnLoad} OnLoad */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Get editor selection\n *\n * @callback OnSelection\n */\n\n/**\n * Update callback\n *\n * @callback OnUpdate\n * @param {object[]} blocks - Editor content to save\n * @param settings\n * @param [loader]\n * @param {Object} [options]\n */\nasync function getInitialContent( settings, loader ) {\n\tconst contentLoader = isPromise( loader )\n\t\t? loader\n\t\t: new Promise( ( resolve ) => {\n\t\t\t\tresolve( loader ? loader( parse, rawHandler ) : [] );\n\t\t  } );\n\n\treturn contentLoader.then( ( content ) => {\n\t\treturn getInitialEditorContent(\n\t\t\tsettings.iso.patterns,\n\t\t\tsettings.iso.currentPattern,\n\t\t\tsettings.editor.template,\n\t\t\tcontent\n\t\t);\n\t} );\n}\n\n/**\n * The editor itself, including toolbar\n *\n * @param {Object} props - Component props\n * @param {object[]} props.blocks\n * @param {OnUpdate} props.updateBlocksWithoutUndo - Callback to update blocks\n * @param {OnUpdate} props.updateBlocksWithUndo - Callback to update blocks\n * @param {boolean} props.isEditing - Are we editing in this editor?\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {Object} props.children - Child components\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n * @param {OnSelection} props.selection\n * @param {OnLoad} props.onLoad - Load initial blocks\n */\nfunction BlockEditorContents( props ) {\n\tconst { blocks, updateBlocksWithoutUndo, updateBlocksWithUndo, selection, isEditing, editorMode } = props;\n\tconst { children, settings, renderMoreMenu, onLoad } = props;\n\n\t// Set initial content, if we have any, but only if there is no existing data in the editor (from elsewhere)\n\tuseEffect( () => {\n\t\tconst loadData = async () => {\n\t\t\tconst initialContent = await getInitialContent( settings, onLoad );\n\n\t\t\tif ( initialContent.length > 0 && ( ! blocks || blocks.length === 0 ) ) {\n\t\t\t\tupdateBlocksWithoutUndo( initialContent, { isInitialContent: true } );\n\t\t\t}\n\t\t};\n\n\t\tloadData();\n\t}, [] );\n\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tvalue={ blocks || [] }\n\t\t\tonInput={ updateBlocksWithoutUndo }\n\t\t\tonChange={ updateBlocksWithUndo }\n\t\t\tuseSubRegistry={ false }\n\t\t\tselection={ selection }\n\t\t\tsettings={ settings.editor }\n\t\t>\n\t\t\t<BlockEditor\n\t\t\t\tisEditing={ isEditing }\n\t\t\t\teditorMode={ editorMode }\n\t\t\t\tsettings={ settings }\n\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</BlockEditor>\n\n\t\t\t<Popover.Slot />\n\t\t</BlockEditorProvider>\n\t);\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { getBlocks, getEditorSelection, getEditorMode, isEditing } = select( 'isolated/editor' );\n\n\t\treturn {\n\t\t\tblocks: getBlocks(),\n\t\t\tselection: getEditorSelection(),\n\t\t\tisEditing: isEditing(),\n\t\t\teditorMode: getEditorMode(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { updateBlocksWithUndo, updateBlocksWithoutUndo } = dispatch( 'isolated/editor' );\n\n\t\treturn {\n\t\t\tupdateBlocksWithUndo,\n\t\t\tupdateBlocksWithoutUndo,\n\t\t};\n\t} ),\n] )( BlockEditorContents );\n"],"mappings":"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"}