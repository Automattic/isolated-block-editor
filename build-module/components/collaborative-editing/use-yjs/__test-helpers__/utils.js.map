{"version":3,"file":"utils.js","names":["waitFor","getTransports","count","peers","getAvailablePeers","excludeId","Object","values","reduce","acc","p","user","id","mockTransport","transport","_identity","undefined","connect","jest","fn","onReceiveMessage","setAvailablePeers","identity","keys","forEach","Promise","resolve","isFirstInChannel","length","sendMessage","data","disconnect","Array","fill","map","pauseTyping","screen","getAllByRole","el","blur","setTimeout"],"sources":["../../../../../src/components/collaborative-editing/use-yjs/__test-helpers__/utils.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { waitFor } from '@testing-library/react';\n\n/**\n * Helper to generate mock transport modules for an isolated channel.\n *\n * @param {number} count - Number of transport modules to generate.\n * @return {Object[]} - Array of transport modules.\n */\nexport function getTransports( count ) {\n\tconst peers = {};\n\n\tconst getAvailablePeers = ( excludeId ) =>\n\t\tObject.values( peers ).reduce( ( acc, p ) => {\n\t\t\tif ( p.user.id === excludeId ) return acc;\n\t\t\treturn [ ...acc, p.user ];\n\t\t}, [] );\n\n\tconst mockTransport = () => {\n\t\tconst transport = {\n\t\t\t_identity: undefined,\n\t\t\tconnect: jest.fn( ( { onReceiveMessage, setAvailablePeers, user } ) => {\n\t\t\t\ttransport._identity = user.identity;\n\t\t\t\tpeers[ user.identity ] = { onReceiveMessage, setAvailablePeers, user: { ...user, id: user.identity } };\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tpeers[ identity ].setAvailablePeers( getAvailablePeers( identity ) );\n\t\t\t\t} );\n\t\t\t\treturn Promise.resolve( { isFirstInChannel: Object.keys( peers ).length === 1 } );\n\t\t\t} ),\n\t\t\tsendMessage: jest.fn( ( data ) => {\n\t\t\t\t// console.log( data.message.messageType, data.identity.substring( 0, 4 ) );\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tif ( identity !== data.identity ) {\n\t\t\t\t\t\tpeers[ identity ].onReceiveMessage( data );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} ),\n\t\t\tdisconnect: jest.fn( () => {\n\t\t\t\tdelete peers[ transport._identity ];\n\t\t\t\tObject.keys( peers ).forEach( ( identity ) => {\n\t\t\t\t\tpeers[ identity ].setAvailablePeers( getAvailablePeers( identity ) );\n\t\t\t\t} );\n\t\t\t} ),\n\t\t};\n\n\t\treturn transport;\n\t};\n\n\treturn Array( count )\n\t\t.fill( null )\n\t\t.map( () => mockTransport() );\n}\n\n/**\n * Emulate a pause between typing events for Yjs to make a new undo stack item.\n *\n * Requires jest.useRealTimers().\n *\n * @param {import('@testing-library/dom').Screen} screen\n */\nexport async function pauseTyping( screen ) {\n\tscreen.getAllByRole( 'document' ).forEach( ( el ) => el.blur() );\n\tawait waitFor( () => new Promise( ( resolve ) => setTimeout( resolve, 550 ) ) );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAO,QAAQ,wBAAwB;;AAEhD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,aAAa,CAAEC,KAAK,EAAG;EACtC,MAAMC,KAAK,GAAG,CAAC,CAAC;EAEhB,MAAMC,iBAAiB,GAAKC,SAAS,IACpCC,MAAM,CAACC,MAAM,CAAEJ,KAAK,CAAE,CAACK,MAAM,CAAE,CAAEC,GAAG,EAAEC,CAAC,KAAM;IAC5C,IAAKA,CAAC,CAACC,IAAI,CAACC,EAAE,KAAKP,SAAS,EAAG,OAAOI,GAAG;IACzC,OAAO,CAAE,GAAGA,GAAG,EAAEC,CAAC,CAACC,IAAI,CAAE;EAC1B,CAAC,EAAE,EAAE,CAAE;EAER,MAAME,aAAa,GAAG,MAAM;IAC3B,MAAMC,SAAS,GAAG;MACjBC,SAAS,EAAEC,SAAS;MACpBC,OAAO,EAAEC,IAAI,CAACC,EAAE,CAAE,QAAqD;QAAA,IAAnD;UAAEC,gBAAgB;UAAEC,iBAAiB;UAAEV;QAAK,CAAC;QAChEG,SAAS,CAACC,SAAS,GAAGJ,IAAI,CAACW,QAAQ;QACnCnB,KAAK,CAAEQ,IAAI,CAACW,QAAQ,CAAE,GAAG;UAAEF,gBAAgB;UAAEC,iBAAiB;UAAEV,IAAI,EAAE;YAAE,GAAGA,IAAI;YAAEC,EAAE,EAAED,IAAI,CAACW;UAAS;QAAE,CAAC;QACtGhB,MAAM,CAACiB,IAAI,CAAEpB,KAAK,CAAE,CAACqB,OAAO,CAAIF,QAAQ,IAAM;UAC7CnB,KAAK,CAAEmB,QAAQ,CAAE,CAACD,iBAAiB,CAAEjB,iBAAiB,CAAEkB,QAAQ,CAAE,CAAE;QACrE,CAAC,CAAE;QACH,OAAOG,OAAO,CAACC,OAAO,CAAE;UAAEC,gBAAgB,EAAErB,MAAM,CAACiB,IAAI,CAAEpB,KAAK,CAAE,CAACyB,MAAM,KAAK;QAAE,CAAC,CAAE;MAClF,CAAC,CAAE;MACHC,WAAW,EAAEX,IAAI,CAACC,EAAE,CAAIW,IAAI,IAAM;QACjC;QACAxB,MAAM,CAACiB,IAAI,CAAEpB,KAAK,CAAE,CAACqB,OAAO,CAAIF,QAAQ,IAAM;UAC7C,IAAKA,QAAQ,KAAKQ,IAAI,CAACR,QAAQ,EAAG;YACjCnB,KAAK,CAAEmB,QAAQ,CAAE,CAACF,gBAAgB,CAAEU,IAAI,CAAE;UAC3C;QACD,CAAC,CAAE;MACJ,CAAC,CAAE;MACHC,UAAU,EAAEb,IAAI,CAACC,EAAE,CAAE,MAAM;QAC1B,OAAOhB,KAAK,CAAEW,SAAS,CAACC,SAAS,CAAE;QACnCT,MAAM,CAACiB,IAAI,CAAEpB,KAAK,CAAE,CAACqB,OAAO,CAAIF,QAAQ,IAAM;UAC7CnB,KAAK,CAAEmB,QAAQ,CAAE,CAACD,iBAAiB,CAAEjB,iBAAiB,CAAEkB,QAAQ,CAAE,CAAE;QACrE,CAAC,CAAE;MACJ,CAAC;IACF,CAAC;IAED,OAAOR,SAAS;EACjB,CAAC;EAED,OAAOkB,KAAK,CAAE9B,KAAK,CAAE,CACnB+B,IAAI,CAAE,IAAI,CAAE,CACZC,GAAG,CAAE,MAAMrB,aAAa,EAAE,CAAE;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAesB,WAAW,CAAEC,MAAM,EAAG;EAC3CA,MAAM,CAACC,YAAY,CAAE,UAAU,CAAE,CAACb,OAAO,CAAIc,EAAE,IAAMA,EAAE,CAACC,IAAI,EAAE,CAAE;EAChE,MAAMvC,OAAO,CAAE,MAAM,IAAIyB,OAAO,CAAIC,OAAO,IAAMc,UAAU,CAAEd,OAAO,EAAE,GAAG,CAAE,CAAE,CAAE;AAChF"}