{"version":3,"file":"index.js","names":["useEffect","useRef","useSelect","useDispatch","serialize","ContentSaver","props","onSaveBlocks","onSaveContent","firstTime","setReady","blocks","ignoredContent","select","getBlocks","getIgnoredContent","saveBlocks","current","length"],"sources":["../../../src/components/content-saver/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { useEffect, useRef } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { serialize } from '@wordpress/blocks';\n\n/** @typedef {import('../../index').OnSaveBlocks} OnSaveBlocks */\n/** @typedef {import('../../index').OnSaveContent} OnSaveContent */\n\n/**\n * Content saver\n *\n * @param {Object} props - Component props\n * @param {OnSaveBlocks} [props.onSaveBlocks] - Save blocks callback\n * @param {OnSaveContent} [props.onSaveContent] - Save content callback\n */\nfunction ContentSaver( props ) {\n\tconst { onSaveBlocks, onSaveContent } = props;\n\tconst firstTime = useRef( true );\n\tconst { setReady } = useDispatch( 'isolated/editor' );\n\tconst { blocks, ignoredContent } = useSelect(\n\t\t( select ) => ( {\n\t\t\t// @ts-ignore\n\t\t\tblocks: select( 'isolated/editor' ).getBlocks(),\n\t\t\t// @ts-ignore\n\t\t\tignoredContent: select( 'isolated/editor' ).getIgnoredContent(),\n\t\t} ),\n\t\t[]\n\t);\n\n\tfunction saveBlocks() {\n\t\t// Save the content in the format wanted by the user\n\t\tonSaveBlocks?.( blocks, ignoredContent );\n\t\tonSaveContent?.( serialize( blocks ) );\n\t}\n\n\tuseEffect( () => {\n\t\tif ( ! blocks ) {\n\t\t\tsetReady( true );\n\t\t\treturn;\n\t\t}\n\n\t\t// Try and avoid an initial first save if no content\n\t\tif ( firstTime.current ) {\n\t\t\tfirstTime.current = false;\n\t\t\tsetReady( true );\n\n\t\t\t// The editor has initial content - save it\n\t\t\tif ( blocks && blocks.length > 1 ) {\n\t\t\t\tsaveBlocks();\n\t\t\t}\n\t\t} else {\n\t\t\tsaveBlocks();\n\t\t}\n\t}, [ blocks ] );\n\n\treturn null;\n}\n\nexport default ContentSaver;\n"],"mappings":"AAAA;AACA;AACA;;AAEA,SAASA,SAAS,EAAEC,MAAM,QAAQ,oBAAoB;AACtD,SAASC,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,SAAS,QAAQ,mBAAmB;;AAE7C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,YAAY,CAAEC,KAAK,EAAG;EAC9B,MAAM;IAAEC,YAAY;IAAEC;EAAc,CAAC,GAAGF,KAAK;EAC7C,MAAMG,SAAS,GAAGR,MAAM,CAAE,IAAI,CAAE;EAChC,MAAM;IAAES;EAAS,CAAC,GAAGP,WAAW,CAAE,iBAAiB,CAAE;EACrD,MAAM;IAAEQ,MAAM;IAAEC;EAAe,CAAC,GAAGV,SAAS,CACzCW,MAAM,KAAQ;IACf;IACAF,MAAM,EAAEE,MAAM,CAAE,iBAAiB,CAAE,CAACC,SAAS,EAAE;IAC/C;IACAF,cAAc,EAAEC,MAAM,CAAE,iBAAiB,CAAE,CAACE,iBAAiB;EAC9D,CAAC,CAAE,EACH,EAAE,CACF;EAED,SAASC,UAAU,GAAG;IACrB;IACAT,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAII,MAAM,EAAEC,cAAc,CAAE;IACxCJ,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAIJ,SAAS,CAAEO,MAAM,CAAE,CAAE;EACvC;EAEAX,SAAS,CAAE,MAAM;IAChB,IAAK,CAAEW,MAAM,EAAG;MACfD,QAAQ,CAAE,IAAI,CAAE;MAChB;IACD;;IAEA;IACA,IAAKD,SAAS,CAACQ,OAAO,EAAG;MACxBR,SAAS,CAACQ,OAAO,GAAG,KAAK;MACzBP,QAAQ,CAAE,IAAI,CAAE;;MAEhB;MACA,IAAKC,MAAM,IAAIA,MAAM,CAACO,MAAM,GAAG,CAAC,EAAG;QAClCF,UAAU,EAAE;MACb;IACD,CAAC,MAAM;MACNA,UAAU,EAAE;IACb;EACD,CAAC,EAAE,CAAEL,MAAM,CAAE,CAAE;EAEf,OAAO,IAAI;AACZ;AAEA,eAAeN,YAAY"}