{"version":3,"file":"index.js","names":["__","useEffect","useRef","withDispatch","withSelect","compose","parse","PatternMonitor","props","currentPattern","updateBlocksWithoutUndo","previous","current","name","setTimeout","content","select","getCurrentPattern","dispatch"],"sources":["../../../src/components/pattern-monitor/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\n\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useRef } from '@wordpress/element';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { parse } from '@wordpress/blocks';\n\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../store/editor/reducer').Pattern} Pattern */\n\n/**\n * Update callback\n *\n * @callback OnUpdate\n * @param {object[]} blocks - Editor content to save\n */\n\n/**\n * Sets up Gutenberg and the Isolated Block Editor\n *\n * An initial setup is performed, and is then reset each time the editor is focussed. This ensures we are applying the right\n * settings for this particular editor.\n *\n * @param {Object} props - Component props\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {Pattern} props.currentPattern - Currently selected pattern\n * @param {OnUpdate} props.updateBlocksWithoutUndo - Callback to update blocks\n */\nfunction PatternMonitor( props ) {\n\tconst { currentPattern, updateBlocksWithoutUndo } = props;\n\tconst previous = useRef( null );\n\n\t// Monitor the current pattern and update the editor content if it changes\n\tuseEffect( () => {\n\t\tif ( currentPattern === null || previous.current === currentPattern ) {\n\t\t\t// @ts-ignore\n\t\t\tprevious.current = currentPattern;\n\t\t\treturn;\n\t\t}\n\n\t\t// @ts-ignore\n\t\tprevious.current = currentPattern.name;\n\t\tsetTimeout( () => {\n\t\t\tupdateBlocksWithoutUndo( parse( currentPattern.content ) );\n\t\t}, 0 );\n\t}, [ currentPattern ] );\n\n\treturn null;\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { getCurrentPattern } = select( 'isolated/editor' );\n\n\t\treturn {\n\t\t\tcurrentPattern: getCurrentPattern(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { updateBlocksWithoutUndo } = dispatch( 'isolated/editor' );\n\n\t\treturn {\n\t\t\tupdateBlocksWithoutUndo,\n\t\t};\n\t} ),\n] )( PatternMonitor );\n"],"mappings":"AAAA;AACA;AACA;AAEA,SAASA,EAAT,QAAmB,iBAAnB;AACA,SAASC,SAAT,EAAoBC,MAApB,QAAkC,oBAAlC;AACA,SAASC,YAAT,EAAuBC,UAAvB,QAAyC,iBAAzC;AACA,SAASC,OAAT,QAAwB,oBAAxB;AACA,SAASC,KAAT,QAAsB,mBAAtB;AAEA;;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,cAAT,CAAyBC,KAAzB,EAAiC;EAChC,MAAM;IAAEC,cAAF;IAAkBC;EAAlB,IAA8CF,KAApD;EACA,MAAMG,QAAQ,GAAGT,MAAM,CAAE,IAAF,CAAvB,CAFgC,CAIhC;;EACAD,SAAS,CAAE,MAAM;IAChB,IAAKQ,cAAc,KAAK,IAAnB,IAA2BE,QAAQ,CAACC,OAAT,KAAqBH,cAArD,EAAsE;MACrE;MACAE,QAAQ,CAACC,OAAT,GAAmBH,cAAnB;MACA;IACA,CALe,CAOhB;;;IACAE,QAAQ,CAACC,OAAT,GAAmBH,cAAc,CAACI,IAAlC;IACAC,UAAU,CAAE,MAAM;MACjBJ,uBAAuB,CAAEJ,KAAK,CAAEG,cAAc,CAACM,OAAjB,CAAP,CAAvB;IACA,CAFS,EAEP,CAFO,CAAV;EAGA,CAZQ,EAYN,CAAEN,cAAF,CAZM,CAAT;EAcA,OAAO,IAAP;AACA;;AAED,eAAeJ,OAAO,CAAE,CACvBD,UAAU,CAAIY,MAAF,IAAc;EACzB,MAAM;IAAEC;EAAF,IAAwBD,MAAM,CAAE,iBAAF,CAApC;EAEA,OAAO;IACNP,cAAc,EAAEQ,iBAAiB;EAD3B,CAAP;AAGA,CANS,CADa,EAQvBd,YAAY,CAAIe,QAAF,IAAgB;EAC7B,MAAM;IAAER;EAAF,IAA8BQ,QAAQ,CAAE,iBAAF,CAA5C;EAEA,OAAO;IACNR;EADM,CAAP;AAGA,CANW,CARW,CAAF,CAAP,CAeVH,cAfU,CAAf"}